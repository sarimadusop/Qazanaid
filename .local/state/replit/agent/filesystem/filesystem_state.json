{"file_contents":{"server/replit_integrations/object_storage/objectAcl.ts":{"content":"import { File } from \"@google-cloud/storage\";\n\nconst ACL_POLICY_METADATA_KEY = \"custom:aclPolicy\";\n\n// The type of the access group.\n//\n// Can be flexibly defined according to the use case.\n//\n// Examples:\n// - USER_LIST: the users from a list stored in the database;\n// - EMAIL_DOMAIN: the users whose email is in a specific domain;\n// - GROUP_MEMBER: the users who are members of a specific group;\n// - SUBSCRIBER: the users who are subscribers of a specific service / content\n//   creator.\nexport enum ObjectAccessGroupType {}\n\n// The logic user group that can access the object.\nexport interface ObjectAccessGroup {\n  // The type of the access group.\n  type: ObjectAccessGroupType;\n  // The logic id that is enough to identify the qualified group members.\n  //\n  // It may have different format for different types. For example:\n  // - for USER_LIST, the id could be the user list db entity id, and the\n  //   user list db entity could contain a bunch of user ids. User needs\n  //   to be a member of the user list to be able to access the object.\n  // - for EMAIL_DOMAIN, the id could be the email domain, and the user needs\n  //   to have an email with the domain to be able to access the object.\n  // - for GROUP_MEMBER, the id could be the group db entity id, and the\n  //   group db entity could contain a bunch of user ids. User needs to be\n  //   a member of the group to be able to access the object.\n  // - for SUBSCRIBER, the id could be the subscriber db entity id, and the\n  //   subscriber db entity could contain a bunch of user ids. User needs to\n  //   be a subscriber to be able to access the object.\n  id: string;\n}\n\nexport enum ObjectPermission {\n  READ = \"read\",\n  WRITE = \"write\",\n}\n\nexport interface ObjectAclRule {\n  group: ObjectAccessGroup;\n  permission: ObjectPermission;\n}\n\n// The ACL policy of the object.\n// This would be set as part of the object custom metadata:\n// - key: \"custom:aclPolicy\"\n// - value: JSON string of the ObjectAclPolicy object.\nexport interface ObjectAclPolicy {\n  owner: string;\n  visibility: \"public\" | \"private\";\n  aclRules?: Array<ObjectAclRule>;\n}\n\n// Check if the requested permission is allowed based on the granted permission.\nfunction isPermissionAllowed(\n  requested: ObjectPermission,\n  granted: ObjectPermission,\n): boolean {\n  // Users granted with read or write permissions can read the object.\n  if (requested === ObjectPermission.READ) {\n    return [ObjectPermission.READ, ObjectPermission.WRITE].includes(granted);\n  }\n\n  // Only users granted with write permissions can write the object.\n  return granted === ObjectPermission.WRITE;\n}\n\n// The base class for all access groups.\n//\n// Different types of access groups can be implemented according to the use case.\nabstract class BaseObjectAccessGroup implements ObjectAccessGroup {\n  constructor(\n    public readonly type: ObjectAccessGroupType,\n    public readonly id: string,\n  ) {}\n\n  // Check if the user is a member of the group.\n  public abstract hasMember(userId: string): Promise<boolean>;\n}\n\nfunction createObjectAccessGroup(\n  group: ObjectAccessGroup,\n): BaseObjectAccessGroup {\n  switch (group.type) {\n    // Implement the case for each type of access group to instantiate.\n    //\n    // For example:\n    // case \"USER_LIST\":\n    //   return new UserListAccessGroup(group.id);\n    // case \"EMAIL_DOMAIN\":\n    //   return new EmailDomainAccessGroup(group.id);\n    // case \"GROUP_MEMBER\":\n    //   return new GroupMemberAccessGroup(group.id);\n    // case \"SUBSCRIBER\":\n    //   return new SubscriberAccessGroup(group.id);\n    default:\n      throw new Error(`Unknown access group type: ${group.type}`);\n  }\n}\n\n// Sets the ACL policy to the object metadata.\nexport async function setObjectAclPolicy(\n  objectFile: File,\n  aclPolicy: ObjectAclPolicy,\n): Promise<void> {\n  const [exists] = await objectFile.exists();\n  if (!exists) {\n    throw new Error(`Object not found: ${objectFile.name}`);\n  }\n\n  await objectFile.setMetadata({\n    metadata: {\n      [ACL_POLICY_METADATA_KEY]: JSON.stringify(aclPolicy),\n    },\n  });\n}\n\n// Gets the ACL policy from the object metadata.\nexport async function getObjectAclPolicy(\n  objectFile: File,\n): Promise<ObjectAclPolicy | null> {\n  const [metadata] = await objectFile.getMetadata();\n  const aclPolicy = metadata?.metadata?.[ACL_POLICY_METADATA_KEY];\n  if (!aclPolicy) {\n    return null;\n  }\n  return JSON.parse(aclPolicy as string);\n}\n\n// Checks if the user can access the object.\nexport async function canAccessObject({\n  userId,\n  objectFile,\n  requestedPermission,\n}: {\n  userId?: string;\n  objectFile: File;\n  requestedPermission: ObjectPermission;\n}): Promise<boolean> {\n  // When this function is called, the acl policy is required.\n  const aclPolicy = await getObjectAclPolicy(objectFile);\n  if (!aclPolicy) {\n    return false;\n  }\n\n  // Public objects are always accessible for read.\n  if (\n    aclPolicy.visibility === \"public\" &&\n    requestedPermission === ObjectPermission.READ\n  ) {\n    return true;\n  }\n\n  // Access control requires the user id.\n  if (!userId) {\n    return false;\n  }\n\n  // The owner of the object can always access it.\n  if (aclPolicy.owner === userId) {\n    return true;\n  }\n\n  // Go through the ACL rules to check if the user has the required permission.\n  for (const rule of aclPolicy.aclRules || []) {\n    const accessGroup = createObjectAccessGroup(rule.group);\n    if (\n      (await accessGroup.hasMember(userId)) &&\n      isPermissionAllowed(requestedPermission, rule.permission)\n    ) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n","path":null,"size_bytes":5545,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\nimport path from \"path\";\nimport { registerObjectStorageRoutes } from \"./replit_integrations/object_storage\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\napp.use(\"/uploads\", express.static(path.join(process.cwd(), \"uploads\")));\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\nregisterObjectStorageRoutes(app);\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    console.error(\"Internal Server Error:\", err);\n\n    if (res.headersSent) {\n      return next(err);\n    }\n\n    return res.status(status).json({ message });\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":2879,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/hooks/use-motivation.ts":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { api, buildUrl } from \"@shared/routes\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport function useMotivation() {\n  return useQuery({\n    queryKey: [api.motivation.list.path],\n    queryFn: async () => {\n      const res = await fetch(api.motivation.list.path, { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch motivation\");\n      return res.json();\n    },\n  });\n}\n\nexport function useCreateMotivation() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async (data: { message: string }) => {\n      const res = await apiRequest(\"POST\", api.motivation.create.path, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [api.motivation.list.path] });\n      toast({ title: \"Motivation Created\", description: \"New motivation message has been added.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n\nexport function useUpdateMotivation() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async ({ id, ...data }: { id: number; message?: string; active?: number }) => {\n      const url = buildUrl(api.motivation.update.path, { id });\n      const res = await apiRequest(\"PUT\", url, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [api.motivation.list.path] });\n      toast({ title: \"Motivation Updated\", description: \"Motivation message has been updated.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n\nexport function useDeleteMotivation() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async (id: number) => {\n      const url = buildUrl(api.motivation.delete.path, { id });\n      await apiRequest(\"DELETE\", url);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [api.motivation.list.path] });\n      toast({ title: \"Motivation Deleted\", description: \"Motivation message has been removed.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n","path":null,"size_bytes":2512,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"server/routes.ts":{"content":"import type { Express, Request, Response } from \"express\";\nimport type { Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { api, buildUrl } from \"@shared/routes\";\nimport { z } from \"zod\";\nimport { setupAuth, registerAuthRoutes, isAuthenticated } from \"./replit_integrations/auth\";\nimport multer from \"multer\";\nimport path from \"path\";\nimport fs from \"fs\";\nimport * as XLSX from \"xlsx\";\nimport { authStorage } from \"./replit_integrations/auth/storage\";\nimport archiver from \"archiver\";\nimport { productPhotos, opnameRecordPhotos } from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { ObjectStorageService, ObjectNotFoundError } from \"./replit_integrations/object_storage\";\n\n\nconst upload = multer({ dest: \"/tmp/uploads\", limits: { fileSize: 10 * 1024 * 1024 } });\nconst objectStorage = new ObjectStorageService();\n\nasync function uploadToObjectStorage(file: Express.Multer.File): Promise<string> {\n  const fileBuffer = fs.readFileSync(file.path);\n  const url = await objectStorage.uploadFileFromServer(\n    fileBuffer,\n    file.originalname,\n    file.mimetype || \"application/octet-stream\"\n  );\n  fs.unlinkSync(file.path);\n  return url;\n}\n\nfunction getUserId(req: Request): string {\n  return (req.session as any)?.userId;\n}\n\nasync function getTeamAdminId(req: Request): Promise<string> {\n  const userId = getUserId(req);\n  const user = await authStorage.getUser(userId);\n  if (user?.adminId) {\n    return user.adminId;\n  }\n  return userId;\n}\n\nasync function getUserRole(req: Request) {\n  const userId = getUserId(req);\n  const roleRecord = await storage.getUserRole(userId);\n  return roleRecord?.role || \"stock_counter\";\n}\n\nfunction requireRole(...roles: string[]) {\n  return async (req: Request, res: Response, next: Function) => {\n    const role = await getUserRole(req);\n    if (roles.includes(role)) {\n      return next();\n    }\n    res.status(403).json({ message: \"Anda tidak memiliki akses untuk fitur ini\" });\n  };\n}\n\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n\n  await setupAuth(app);\n  registerAuthRoutes(app);\n\n  // === Roles ===\n  app.get(api.roles.me.path, isAuthenticated, async (req, res) => {\n    const userId = getUserId(req);\n    let roleRecord = await storage.getUserRole(userId);\n    if (!roleRecord) {\n      roleRecord = await storage.setUserRole({ userId, role: \"stock_counter\" });\n    }\n    res.json(roleRecord);\n  });\n\n  app.get(api.roles.list.path, isAuthenticated, requireRole(\"admin\"), async (req, res) => {\n    const adminId = getUserId(req);\n    const roles = await storage.getAllUserRoles();\n    const { users } = await import(\"@shared/models/auth\");\n    const { db } = await import(\"./db\");\n    const { eq, or } = await import(\"drizzle-orm\");\n    const allUsers = await db.select().from(users).where(\n      or(eq(users.id, adminId), eq(users.adminId, adminId))\n    );\n    \n    const teamUserIds = new Set(allUsers.map(u => u.id));\n    const teamRoles = roles.filter(r => teamUserIds.has(r.userId));\n    \n    const enriched = teamRoles.map(r => {\n      const user = allUsers.find(u => u.id === r.userId);\n      return {\n        ...r,\n        username: user?.username,\n        email: user?.email,\n        firstName: user?.firstName,\n        lastName: user?.lastName,\n        adminId: user?.adminId,\n      };\n    });\n    res.json(enriched);\n  });\n\n  app.post(api.roles.set.path, isAuthenticated, requireRole(\"admin\"), async (req, res) => {\n    try {\n      const input = api.roles.set.input.parse(req.body);\n      const adminId = getUserId(req);\n      \n      const { users } = await import(\"@shared/models/auth\");\n      const { db } = await import(\"./db\");\n      const { eq } = await import(\"drizzle-orm\");\n      const [targetUser] = await db.select().from(users).where(eq(users.id, input.userId));\n      \n      if (!targetUser || (targetUser.id !== adminId && targetUser.adminId !== adminId)) {\n        return res.status(403).json({ message: \"Anda tidak bisa mengubah role user ini\" });\n      }\n      \n      if (targetUser.id === adminId) {\n        return res.status(400).json({ message: \"Tidak bisa mengubah role sendiri\" });\n      }\n      \n      const role = await storage.setUserRole(input);\n      res.json(role);\n    } catch (err) {\n      if (err instanceof z.ZodError) {\n        return res.status(400).json({ message: err.errors[0].message });\n      }\n      throw err;\n    }\n  });\n\n  // === Products ===\n  app.get(api.products.categories.path, isAuthenticated, async (req, res) => {\n    const adminId = await getTeamAdminId(req);\n    const prods = await storage.getProducts(adminId);\n    const cats = Array.from(new Set(prods.map(p => p.category).filter(Boolean))) as string[];\n    res.json(cats);\n  });\n\n  app.get(api.products.withDetails.path, isAuthenticated, async (req, res) => {\n    const adminId = await getTeamAdminId(req);\n    const result = await storage.getProductsWithPhotosAndUnits(adminId);\n    res.json(result);\n  });\n\n  app.get(api.products.list.path, isAuthenticated, async (req, res) => {\n    const adminId = await getTeamAdminId(req);\n    const locationType = req.query.locationType as string | undefined;\n    const role = await getUserRole(req);\n\n    let effectiveLocationType = locationType;\n    if (role === \"stock_counter_toko\") effectiveLocationType = \"toko\";\n    if (role === \"stock_counter_gudang\") effectiveLocationType = \"gudang\";\n\n    const prods = await storage.getProducts(adminId, effectiveLocationType);\n    res.json(prods);\n  });\n\n  app.post(api.products.create.path, isAuthenticated, requireRole(\"admin\", \"sku_manager\"), async (req, res) => {\n    try {\n      const input = api.products.create.input.parse(req.body);\n      const adminId = await getTeamAdminId(req);\n      const product = await storage.createProduct({ ...input, userId: adminId });\n      res.status(201).json(product);\n    } catch (err) {\n      if (err instanceof z.ZodError) {\n        return res.status(400).json({\n          message: err.errors[0].message,\n          field: err.errors[0].path.join('.'),\n        });\n      }\n      throw err;\n    }\n  });\n\n  app.put(api.products.update.path, isAuthenticated, requireRole(\"admin\", \"sku_manager\"), async (req, res) => {\n    try {\n      const id = Number(req.params.id);\n      const adminId = await getTeamAdminId(req);\n      const existing = await storage.getProduct(id);\n      if (!existing || existing.userId !== adminId) {\n        return res.status(404).json({ message: \"Product not found\" });\n      }\n      const input = api.products.update.input.parse(req.body);\n      const product = await storage.updateProduct(id, input);\n      res.json(product);\n    } catch (err) {\n      res.status(500).json({ message: \"Failed to update product\" });\n    }\n  });\n\n  app.delete(api.products.delete.path, isAuthenticated, requireRole(\"admin\", \"sku_manager\"), async (req, res) => {\n    const adminId = await getTeamAdminId(req);\n    const existing = await storage.getProduct(Number(req.params.id));\n    if (!existing || existing.userId !== adminId) {\n      return res.status(404).json({ message: \"Product not found\" });\n    }\n    await storage.deleteProduct(Number(req.params.id));\n    res.sendStatus(204);\n  });\n\n  app.post(api.products.bulkDelete.path, isAuthenticated, requireRole(\"admin\", \"sku_manager\"), async (req, res) => {\n    const adminId = await getTeamAdminId(req);\n    const { ids } = req.body as { ids: number[] };\n    if (!ids || !Array.isArray(ids) || ids.length === 0) {\n      return res.status(400).json({ message: \"No product IDs provided\" });\n    }\n    let deleted = 0;\n    for (const id of ids) {\n      const existing = await storage.getProduct(id);\n      if (existing && existing.userId === adminId) {\n        await storage.deleteProduct(id);\n        deleted++;\n      }\n    }\n    res.json({ deleted });\n  });\n\n  // === Product Photos (multi-photo support) ===\n  app.get(api.productPhotos.list.path, isAuthenticated, async (req, res) => {\n    const productId = Number(req.params.productId);\n    const photos = await storage.getProductPhotos(productId);\n    res.json(photos);\n  });\n\n  app.post(api.productPhotos.upload.path, isAuthenticated, requireRole(\"admin\", \"sku_manager\"), upload.single(\"photo\"), async (req, res) => {\n    try {\n      const productId = Number(req.params.productId);\n      const adminId = await getTeamAdminId(req);\n      const product = await storage.getProduct(productId);\n      if (!product || product.userId !== adminId) {\n        return res.status(404).json({ message: \"Product not found\" });\n      }\n\n      if (!req.file) {\n        return res.status(400).json({ message: \"No file uploaded\" });\n      }\n\n      const url = await uploadToObjectStorage(req.file);\n      const photo = await storage.addProductPhoto({ productId, url });\n\n      res.status(201).json(photo);\n    } catch (err) {\n      console.error(\"Product photo upload error:\", err);\n      res.status(500).json({ message: \"Upload failed\" });\n    }\n  });\n\n  app.delete(api.productPhotos.delete.path, isAuthenticated, requireRole(\"admin\", \"sku_manager\"), async (req, res) => {\n    try {\n      const photoId = Number(req.params.photoId);\n      const productId = Number(req.params.productId);\n      const adminId = await getTeamAdminId(req);\n      const product = await storage.getProduct(productId);\n      if (!product || product.userId !== adminId) {\n        return res.status(404).json({ message: \"Product not found\" });\n      }\n\n      await storage.deleteProductPhoto(photoId);\n      res.sendStatus(204);\n    } catch (err) {\n      console.error(\"Delete photo error:\", err);\n      res.status(500).json({ message: \"Failed to delete photo\" });\n    }\n  });\n\n  // === Product Units (unit beranak) ===\n  app.get(api.productUnits.list.path, isAuthenticated, async (req, res) => {\n    const productId = Number(req.params.productId);\n    const units = await storage.getProductUnits(productId);\n    res.json(units);\n  });\n\n  app.post(api.productUnits.create.path, isAuthenticated, requireRole(\"admin\", \"sku_manager\"), async (req, res) => {\n    try {\n      const productId = Number(req.params.productId);\n      const adminId = await getTeamAdminId(req);\n      const product = await storage.getProduct(productId);\n      if (!product || product.userId !== adminId) {\n        return res.status(404).json({ message: \"Product not found\" });\n      }\n\n      const { unitName, conversionToBase, baseUnit, sortOrder } = req.body;\n      if (!unitName || !baseUnit) {\n        return res.status(400).json({ message: \"unitName and baseUnit are required\" });\n      }\n\n      const unit = await storage.addProductUnit({\n        productId,\n        unitName,\n        conversionToBase: conversionToBase || 1,\n        baseUnit,\n        sortOrder: sortOrder || 0,\n      });\n      res.status(201).json(unit);\n    } catch (err) {\n      console.error(\"Create unit error:\", err);\n      res.status(500).json({ message: \"Failed to create unit\" });\n    }\n  });\n\n  app.put(api.productUnits.update.path, isAuthenticated, requireRole(\"admin\", \"sku_manager\"), async (req, res) => {\n    try {\n      const productId = Number(req.params.productId);\n      const unitId = Number(req.params.unitId);\n      const adminId = await getTeamAdminId(req);\n      const product = await storage.getProduct(productId);\n      if (!product || product.userId !== adminId) {\n        return res.status(404).json({ message: \"Product not found\" });\n      }\n\n      const { unitName, conversionToBase, baseUnit, sortOrder } = req.body;\n      const unit = await storage.updateProductUnit(unitId, {\n        unitName,\n        conversionToBase,\n        baseUnit,\n        sortOrder,\n      });\n      res.json(unit);\n    } catch (err) {\n      console.error(\"Update unit error:\", err);\n      res.status(500).json({ message: \"Failed to update unit\" });\n    }\n  });\n\n  app.delete(api.productUnits.delete.path, isAuthenticated, requireRole(\"admin\", \"sku_manager\"), async (req, res) => {\n    try {\n      const productId = Number(req.params.productId);\n      const unitId = Number(req.params.unitId);\n      const adminId = await getTeamAdminId(req);\n      const product = await storage.getProduct(productId);\n      if (!product || product.userId !== adminId) {\n        return res.status(404).json({ message: \"Product not found\" });\n      }\n\n      await storage.deleteProductUnit(unitId);\n      res.sendStatus(204);\n    } catch (err) {\n      console.error(\"Delete unit error:\", err);\n      res.status(500).json({ message: \"Failed to delete unit\" });\n    }\n  });\n\n  // === Photo Upload (legacy single photo) ===\n  app.post(api.upload.photo.path, isAuthenticated, requireRole(\"admin\", \"sku_manager\"), upload.single(\"photo\"), async (req, res) => {\n    try {\n      const productId = Number(req.params.productId);\n      const adminId = await getTeamAdminId(req);\n      const product = await storage.getProduct(productId);\n      if (!product || product.userId !== adminId) {\n        return res.status(404).json({ message: \"Product not found\" });\n      }\n\n      if (!req.file) {\n        return res.status(400).json({ message: \"No file uploaded\" });\n      }\n\n      const url = await uploadToObjectStorage(req.file);\n      await storage.updateProduct(productId, { photoUrl: url });\n\n      res.json({ url });\n    } catch (err) {\n      console.error(\"Upload error:\", err);\n      res.status(500).json({ message: \"Upload failed\" });\n    }\n  });\n\n  // === Opname Photo Upload (legacy single photo) ===\n  app.post(api.upload.opnamePhoto.path, isAuthenticated, upload.single(\"photo\"), async (req, res) => {\n    try {\n      const sessionId = Number(req.params.sessionId);\n      const productId = Number(req.params.productId);\n      const adminId = await getTeamAdminId(req);\n\n      const session = await storage.getSession(sessionId);\n      if (!session || session.userId !== adminId) {\n        return res.status(404).json({ message: \"Session not found\" });\n      }\n\n      const product = await storage.getProduct(productId);\n      if (!product || product.userId !== adminId) {\n        return res.status(404).json({ message: \"Product not found\" });\n      }\n\n      if (!req.file) {\n        return res.status(400).json({ message: \"No file uploaded\" });\n      }\n\n      const url = await uploadToObjectStorage(req.file);\n      await storage.updateRecordPhoto(sessionId, productId, url);\n\n      res.json({ url });\n    } catch (err) {\n      console.error(\"Opname photo upload error:\", err);\n      res.status(500).json({ message: \"Upload failed\" });\n    }\n  });\n\n  // === Opname Record Photos (multi-photo for SO) ===\n  app.post(api.recordPhotos.upload.path, isAuthenticated, upload.single(\"photo\"), async (req, res) => {\n    try {\n      const sessionId = Number(req.params.sessionId);\n      const productId = Number(req.params.productId);\n      const adminId = await getTeamAdminId(req);\n\n      const session = await storage.getSession(sessionId);\n      if (!session || session.userId !== adminId) {\n        return res.status(404).json({ message: \"Session not found\" });\n      }\n\n      const product = await storage.getProduct(productId);\n      if (!product || product.userId !== adminId) {\n        return res.status(404).json({ message: \"Product not found\" });\n      }\n\n      if (!req.file) {\n        return res.status(400).json({ message: \"No file uploaded\" });\n      }\n\n      const url = await uploadToObjectStorage(req.file);\n\n      const record = session.records.find(r => r.productId === productId);\n      if (record) {\n        const recordPhoto = await storage.addRecordPhoto({ recordId: record.id, url });\n        await storage.updateRecordPhoto(sessionId, productId, url);\n        res.status(201).json(recordPhoto);\n      } else {\n        await storage.updateRecordPhoto(sessionId, productId, url);\n        res.status(201).json({ url });\n      }\n    } catch (err) {\n      console.error(\"Record photo upload error:\", err);\n      res.status(500).json({ message: \"Upload failed\" });\n    }\n  });\n\n  app.delete(api.recordPhotos.delete.path, isAuthenticated, async (req, res) => {\n    try {\n      const sessionId = Number(req.params.sessionId);\n      const productId = Number(req.params.productId);\n      const photoId = Number(req.params.photoId);\n      const adminId = await getTeamAdminId(req);\n\n      const session = await storage.getSession(sessionId);\n      if (!session || session.userId !== adminId) {\n        return res.status(404).json({ message: \"Session not found\" });\n      }\n\n      await storage.deleteRecordPhoto(photoId);\n      res.sendStatus(204);\n    } catch (err) {\n      console.error(\"Delete record photo error:\", err);\n      res.status(500).json({ message: \"Failed to delete photo\" });\n    }\n  });\n\n  // === Download ZIP Photos ===\n  app.post(api.upload.downloadZip.path, isAuthenticated, async (req, res) => {\n    try {\n      const sessionId = Number(req.params.id);\n      const adminId = await getTeamAdminId(req);\n\n      const session = await storage.getSession(sessionId);\n      if (!session || session.userId !== adminId) {\n        return res.status(404).json({ message: \"Session not found\" });\n      }\n\n      const { productIds, date } = req.body as { productIds?: number[]; date?: string };\n\n      let recordsToDownload = session.records;\n\n      if (productIds && productIds.length > 0) {\n        recordsToDownload = recordsToDownload.filter(r => productIds.includes(r.productId));\n      }\n\n      if (date) {\n        const targetDate = new Date(date);\n        const targetDateStr = targetDate.toISOString().split(\"T\")[0];\n        recordsToDownload = recordsToDownload.filter(r => {\n          if (r.photos && r.photos.length > 0) {\n            return r.photos.some(p => {\n              const photoDate = new Date(p.createdAt).toISOString().split(\"T\")[0];\n              return photoDate === targetDateStr;\n            });\n          }\n          return false;\n        });\n      }\n\n      const recordsWithPhotos = recordsToDownload.filter(r => {\n        return (r.photos && r.photos.length > 0) || r.photoUrl;\n      });\n\n      if (recordsWithPhotos.length === 0) {\n        return res.status(404).json({ message: \"Tidak ada foto untuk didownload\" });\n      }\n\n      const safeTitle = session.title.replace(/[^a-zA-Z0-9]/g, \"_\");\n      res.setHeader(\"Content-Type\", \"application/zip\");\n      res.setHeader(\"Content-Disposition\", `attachment; filename=${safeTitle}_Photos.zip`);\n\n      const archive = archiver(\"zip\", { zlib: { level: 5 } });\n      archive.pipe(res);\n\n      for (const record of recordsWithPhotos) {\n        const safeName = record.product.name.replace(/[^a-zA-Z0-9]/g, \"_\");\n\n        const appendPhotoToArchive = async (photoUrl: string, zipFilename: string) => {\n          if (photoUrl.startsWith(\"/objects/\")) {\n            const result = await objectStorage.getObjectStream(photoUrl);\n            if (result) {\n              archive.append(result.stream as any, { name: zipFilename });\n            }\n          } else {\n            const relativePath = photoUrl.replace(/^\\//, \"\");\n            const filePath = path.join(process.cwd(), relativePath);\n            if (fs.existsSync(filePath)) {\n              archive.file(filePath, { name: zipFilename });\n            }\n          }\n        };\n\n        if (record.photos && record.photos.length > 0) {\n          for (let i = 0; i < record.photos.length; i++) {\n            const photo = record.photos[i];\n            const ext = path.extname(photo.url) || \".jpg\";\n            const photoDate = new Date(photo.createdAt);\n            const dateStr = `${photoDate.getFullYear()}${String(photoDate.getMonth() + 1).padStart(2, '0')}${String(photoDate.getDate()).padStart(2, '0')}`;\n            const suffix = record.photos.length > 1 ? `_${i + 1}` : \"\";\n            const zipFilename = `${safeTitle}/${safeName}_${dateStr}${suffix}${ext}`;\n            await appendPhotoToArchive(photo.url, zipFilename);\n          }\n        } else if (record.photoUrl) {\n          const ext = path.extname(record.photoUrl) || \".jpg\";\n          const startDate = new Date(session.startedAt);\n          const dateStr = `${startDate.getFullYear()}${String(startDate.getMonth() + 1).padStart(2, '0')}${String(startDate.getDate()).padStart(2, '0')}`;\n          const zipFilename = `${safeTitle}/${safeName}_${dateStr}${ext}`;\n          await appendPhotoToArchive(record.photoUrl, zipFilename);\n        }\n      }\n\n      await archive.finalize();\n    } catch (err) {\n      console.error(\"ZIP download error:\", err);\n      if (!res.headersSent) {\n        res.status(500).json({ message: \"Failed to create ZIP\" });\n      }\n    }\n  });\n\n  // === Sessions ===\n  app.get(api.sessions.list.path, isAuthenticated, async (req, res) => {\n    const adminId = await getTeamAdminId(req);\n    const locationType = req.query.locationType as string | undefined;\n    const role = await getUserRole(req);\n\n    let effectiveLocationType = locationType;\n    if (role === \"stock_counter_toko\") effectiveLocationType = \"toko\";\n    if (role === \"stock_counter_gudang\") effectiveLocationType = \"gudang\";\n\n    const sessions = await storage.getSessions(adminId, effectiveLocationType);\n    res.json(sessions);\n  });\n\n  app.post(api.sessions.create.path, isAuthenticated, requireRole(\"admin\", \"stock_counter\", \"stock_counter_toko\", \"stock_counter_gudang\"), async (req, res) => {\n    try {\n      const input = api.sessions.create.input.parse(req.body);\n      const adminId = await getTeamAdminId(req);\n      const session = await storage.createSession({ ...input, userId: adminId });\n      res.status(201).json(session);\n    } catch (err) {\n      if (err instanceof z.ZodError) {\n        return res.status(400).json({ message: err.errors[0].message });\n      }\n      throw err;\n    }\n  });\n\n  app.get(api.sessions.get.path, isAuthenticated, async (req, res) => {\n    const adminId = await getTeamAdminId(req);\n    const session = await storage.getSession(Number(req.params.id));\n    if (!session || session.userId !== adminId) {\n      return res.status(404).json({ message: 'Session not found' });\n    }\n    res.json(session);\n  });\n\n  app.post(api.sessions.complete.path, isAuthenticated, requireRole(\"admin\", \"stock_counter\", \"stock_counter_toko\", \"stock_counter_gudang\"), async (req, res) => {\n    const adminId = await getTeamAdminId(req);\n    const session = await storage.getSession(Number(req.params.id));\n    if (!session || session.userId !== adminId) {\n      return res.status(404).json({ message: 'Session not found' });\n    }\n    const completed = await storage.completeSession(Number(req.params.id));\n    res.json(completed);\n  });\n\n  // === Records ===\n  app.post(api.records.update.path, isAuthenticated, requireRole(\"admin\", \"stock_counter\", \"stock_counter_toko\", \"stock_counter_gudang\"), async (req, res) => {\n    const adminId = await getTeamAdminId(req);\n    const sessionId = Number(req.params.sessionId);\n    const session = await storage.getSession(sessionId);\n    if (!session || session.userId !== adminId) {\n      return res.status(404).json({ message: 'Session not found' });\n    }\n    const { productId, actualStock, notes, unitValues } = req.body;\n    \n    if (typeof productId !== 'number' || typeof actualStock !== 'number') {\n      return res.status(400).json({ message: \"Invalid input\" });\n    }\n\n    const record = await storage.updateRecord(sessionId, productId, actualStock, notes, unitValues);\n    res.json(record);\n  });\n\n  // === Staff Members ===\n  app.get(api.staff.list.path, isAuthenticated, async (req, res) => {\n    const adminId = await getTeamAdminId(req);\n    const members = await storage.getStaffMembers(adminId);\n    res.json(members);\n  });\n\n  app.post(api.staff.create.path, isAuthenticated, requireRole(\"admin\", \"sku_manager\"), async (req, res) => {\n    try {\n      const adminId = await getTeamAdminId(req);\n      const { name, locationType } = req.body;\n      if (!name) {\n        return res.status(400).json({ message: \"Name is required\" });\n      }\n      const member = await storage.createStaffMember({\n        name,\n        locationType: locationType || \"toko\",\n        userId: adminId,\n        active: 1,\n      });\n      res.status(201).json(member);\n    } catch (err) {\n      console.error(\"Create staff error:\", err);\n      res.status(500).json({ message: \"Failed to create staff member\" });\n    }\n  });\n\n  app.put(api.staff.update.path, isAuthenticated, requireRole(\"admin\", \"sku_manager\"), async (req, res) => {\n    try {\n      const id = Number(req.params.id);\n      const { name, locationType, active } = req.body;\n      const member = await storage.updateStaffMember(id, { name, locationType, active });\n      res.json(member);\n    } catch (err) {\n      console.error(\"Update staff error:\", err);\n      res.status(500).json({ message: \"Failed to update staff member\" });\n    }\n  });\n\n  app.delete(api.staff.delete.path, isAuthenticated, requireRole(\"admin\", \"sku_manager\"), async (req, res) => {\n    try {\n      await storage.deleteStaffMember(Number(req.params.id));\n      res.sendStatus(204);\n    } catch (err) {\n      console.error(\"Delete staff error:\", err);\n      res.status(500).json({ message: \"Failed to delete staff member\" });\n    }\n  });\n\n  // === Announcements ===\n  app.get(api.announcements.list.path, isAuthenticated, async (req, res) => {\n    const adminId = await getTeamAdminId(req);\n    const items = await storage.getAnnouncements(adminId);\n    res.json(items);\n  });\n\n  app.post(api.announcements.create.path, isAuthenticated, requireRole(\"admin\"), async (req, res) => {\n    try {\n      const adminId = await getTeamAdminId(req);\n      const { title, content, expiresAt } = req.body;\n      if (!title || !content) {\n        return res.status(400).json({ message: \"Title and content are required\" });\n      }\n      const announcement = await storage.createAnnouncement({\n        title,\n        content,\n        imageUrl: null,\n        userId: adminId,\n        expiresAt: expiresAt ? new Date(expiresAt) : null,\n      });\n      res.status(201).json(announcement);\n    } catch (err) {\n      console.error(\"Create announcement error:\", err);\n      res.status(500).json({ message: \"Failed to create announcement\" });\n    }\n  });\n\n  app.put(api.announcements.update.path, isAuthenticated, requireRole(\"admin\"), async (req, res) => {\n    try {\n      const id = Number(req.params.id);\n      const { title, content, expiresAt, imageUrl } = req.body;\n      const updates: Record<string, unknown> = {};\n      if (title !== undefined) updates.title = title;\n      if (content !== undefined) updates.content = content;\n      if (expiresAt !== undefined) updates.expiresAt = expiresAt ? new Date(expiresAt) : null;\n      if (imageUrl !== undefined) updates.imageUrl = imageUrl;\n      const announcement = await storage.updateAnnouncement(id, updates as any);\n      res.json(announcement);\n    } catch (err) {\n      console.error(\"Update announcement error:\", err);\n      res.status(500).json({ message: \"Failed to update announcement\" });\n    }\n  });\n\n  app.post(api.announcements.uploadImage.path, isAuthenticated, requireRole(\"admin\"), upload.single(\"image\"), async (req, res) => {\n    try {\n      const id = Number(req.params.id);\n      const file = req.file;\n      if (!file) {\n        return res.status(400).json({ message: \"No file uploaded\" });\n      }\n\n      const url = await uploadToObjectStorage(file);\n      const announcement = await storage.updateAnnouncement(id, { imageUrl: url });\n      res.json(announcement);\n    } catch (err) {\n      console.error(\"Announcement image upload error:\", err);\n      res.status(500).json({ message: \"Failed to upload image\" });\n    }\n  });\n\n  app.delete(api.announcements.delete.path, isAuthenticated, requireRole(\"admin\"), async (req, res) => {\n    try {\n      await storage.deleteAnnouncement(Number(req.params.id));\n      res.sendStatus(204);\n    } catch (err) {\n      console.error(\"Delete announcement error:\", err);\n      res.status(500).json({ message: \"Failed to delete announcement\" });\n    }\n  });\n\n  // === Feedback (Kritik & Saran) ===\n  app.get(api.feedback.list.path, isAuthenticated, async (req, res) => {\n    const role = await getUserRole(req);\n    if (role === \"admin\") {\n      const adminId = await getTeamAdminId(req);\n      const allFeedback = await storage.getFeedback(adminId);\n      res.json(allFeedback);\n    } else {\n      const userId = getUserId(req);\n      const userFeedback = await storage.getFeedback(userId);\n      res.json(userFeedback);\n    }\n  });\n\n  app.post(api.feedback.create.path, isAuthenticated, async (req, res) => {\n    try {\n      const userId = getUserId(req);\n      const adminId = await getTeamAdminId(req);\n      const { type, content } = req.body;\n      if (!content) {\n        return res.status(400).json({ message: \"Content is required\" });\n      }\n\n      const user = await authStorage.getUser(userId);\n      const fb = await storage.createFeedback({\n        userId: adminId,\n        userName: user?.username || user?.firstName || \"Unknown\",\n        type: type || \"saran\",\n        content,\n      });\n      res.status(201).json(fb);\n    } catch (err) {\n      console.error(\"Create feedback error:\", err);\n      res.status(500).json({ message: \"Failed to create feedback\" });\n    }\n  });\n\n  app.delete(api.feedback.delete.path, isAuthenticated, requireRole(\"admin\"), async (req, res) => {\n    try {\n      await storage.deleteFeedback(Number(req.params.id));\n      res.sendStatus(204);\n    } catch (err) {\n      console.error(\"Delete feedback error:\", err);\n      res.status(500).json({ message: \"Failed to delete feedback\" });\n    }\n  });\n\n  // === Motivation Messages ===\n  app.get(api.motivation.list.path, isAuthenticated, async (req, res) => {\n    const adminId = await getTeamAdminId(req);\n    const messages = await storage.getMotivationMessages(adminId);\n    res.json(messages);\n  });\n\n  app.post(api.motivation.create.path, isAuthenticated, requireRole(\"admin\"), async (req, res) => {\n    try {\n      const adminId = await getTeamAdminId(req);\n      const { message } = req.body;\n      if (!message) {\n        return res.status(400).json({ message: \"Message is required\" });\n      }\n      const msg = await storage.createMotivationMessage({\n        message,\n        userId: adminId,\n        active: 1,\n      });\n      res.status(201).json(msg);\n    } catch (err) {\n      console.error(\"Create motivation error:\", err);\n      res.status(500).json({ message: \"Failed to create motivation message\" });\n    }\n  });\n\n  app.put(api.motivation.update.path, isAuthenticated, requireRole(\"admin\"), async (req, res) => {\n    try {\n      const id = Number(req.params.id);\n      const { message, active } = req.body;\n      const msg = await storage.updateMotivationMessage(id, { message, active });\n      res.json(msg);\n    } catch (err) {\n      console.error(\"Update motivation error:\", err);\n      res.status(500).json({ message: \"Failed to update motivation message\" });\n    }\n  });\n\n  app.delete(api.motivation.delete.path, isAuthenticated, requireRole(\"admin\"), async (req, res) => {\n    try {\n      await storage.deleteMotivationMessage(Number(req.params.id));\n      res.sendStatus(204);\n    } catch (err) {\n      console.error(\"Delete motivation error:\", err);\n      res.status(500).json({ message: \"Failed to delete motivation message\" });\n    }\n  });\n\n  // === Category Priorities ===\n  app.get(api.categoryPriorities.list.path, isAuthenticated, async (req, res) => {\n    const userId = getUserId(req);\n    let priorities = await storage.getCategoryPriorities(userId);\n    if (priorities.length === 0) {\n      const adminId = await getTeamAdminId(req);\n      if (adminId !== userId) {\n        priorities = await storage.getCategoryPriorities(adminId);\n      }\n    }\n    res.json(priorities);\n  });\n\n  app.post(api.categoryPriorities.set.path, isAuthenticated, async (req, res) => {\n    try {\n      const userId = getUserId(req);\n      const { priorities } = req.body as { priorities: { categoryName: string; sortOrder: number }[] };\n      const result = await storage.setCategoryPriorities(userId, priorities || []);\n      res.json(result);\n    } catch (err) {\n      console.error(\"Set category priorities error:\", err);\n      res.status(500).json({ message: \"Failed to set category priorities\" });\n    }\n  });\n\n  // === Excel Template & Import ===\n  app.get(api.excel.template.path, isAuthenticated, requireRole(\"admin\", \"sku_manager\"), (req, res) => {\n    const wb = XLSX.utils.book_new();\n    const headers = [\"SKU\", \"Nama Produk\", \"Kategori\", \"Deskripsi\", \"Stok Awal\", \"Lokasi\", \"Satuan\"];\n    const exampleRows = [\n      [\"ITEM-001\", \"Contoh Produk\", \"Elektronik\", \"Deskripsi produk\", 10, \"toko\", \"pcs\"],\n      [\"ITEM-002\", \"Produk Kedua\", \"Makanan\", \"\", 25, \"gudang\", \"dus, pack, pcs\"],\n    ];\n    const ws = XLSX.utils.aoa_to_sheet([headers, ...exampleRows]);\n    ws[\"!cols\"] = [{ wch: 15 }, { wch: 25 }, { wch: 15 }, { wch: 30 }, { wch: 12 }, { wch: 10 }, { wch: 20 }];\n    XLSX.utils.book_append_sheet(wb, ws, \"Template Produk\");\n    const buf = XLSX.write(wb, { type: \"buffer\", bookType: \"xlsx\" });\n    res.setHeader(\"Content-Disposition\", \"attachment; filename=template_produk.xlsx\");\n    res.setHeader(\"Content-Type\", \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\");\n    res.send(buf);\n  });\n\n  app.post(api.excel.import.path, isAuthenticated, requireRole(\"admin\", \"sku_manager\"), upload.single(\"file\"), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ message: \"No file uploaded\" });\n      }\n\n      const fileBuffer = fs.readFileSync(req.file.path);\n      fs.unlinkSync(req.file.path);\n      const wb = XLSX.read(fileBuffer, { type: \"buffer\" });\n      const ws = wb.Sheets[wb.SheetNames[0]];\n      const rows: any[][] = XLSX.utils.sheet_to_json(ws, { header: 1 });\n\n      if (rows.length < 2) {\n        return res.status(400).json({ message: \"File kosong atau tidak memiliki data\" });\n      }\n\n      const adminId = await getTeamAdminId(req);\n      const existingProducts = await storage.getProducts(adminId);\n      const existingSkus = new Set(existingProducts.map(p => p.sku.toLowerCase()));\n      const existingProductCodes = new Set(existingProducts.filter(p => p.productCode).map(p => p.productCode!.toLowerCase()));\n\n      const headerRow = rows[0] || [];\n      const firstHeader = String(headerRow[0] || \"\").trim().toLowerCase();\n      const isGudangFormat = firstHeader === \"product name\" || firstHeader === \"nama produk\" || firstHeader === \"product code\" ||\n        (headerRow.length >= 2 && String(headerRow[1] || \"\").trim().toLowerCase() === \"product code\");\n\n      let imported = 0;\n      let skipped = 0;\n      const errors: { row: number; message: string }[] = [];\n\n      for (let i = 1; i < rows.length; i++) {\n        const row = rows[i];\n        if (!row || row.length === 0 || row.every(cell => cell === undefined || cell === null || cell === \"\")) {\n          continue;\n        }\n\n        if (isGudangFormat) {\n          const name = String(row[0] || \"\").trim();\n          const productCode = String(row[1] || \"\").trim();\n          const satuanRaw = String(row[2] || \"\").trim();\n          const category = String(row[3] || \"\").trim() || null;\n          const subCategory = String(row[4] || \"\").trim() || null;\n\n          if (!name) {\n            errors.push({ row: i + 1, message: \"Nama Produk wajib diisi\" });\n            skipped++;\n            continue;\n          }\n\n          const sku = productCode || `GDG-${Date.now()}-${i}`;\n\n          if (existingSkus.has(sku.toLowerCase())) {\n            errors.push({ row: i + 1, message: `Produk \"${name}\" (kode: ${sku}) sudah ada` });\n            skipped++;\n            continue;\n          }\n\n          if (productCode && existingProductCodes.has(productCode.toLowerCase())) {\n            errors.push({ row: i + 1, message: `Kode Produk \"${productCode}\" sudah ada` });\n            skipped++;\n            continue;\n          }\n\n          try {\n            const product = await storage.createProduct({\n              sku,\n              name,\n              category,\n              description: null,\n              currentStock: 0,\n              photoUrl: null,\n              userId: adminId,\n              locationType: \"gudang\",\n              subCategory,\n              productCode: productCode || null,\n            });\n            existingSkus.add(sku.toLowerCase());\n            if (productCode) existingProductCodes.add(productCode.toLowerCase());\n\n            if (satuanRaw) {\n              const unitNames = satuanRaw.split(\",\").map(s => s.trim()).filter(Boolean);\n              for (let j = 0; j < unitNames.length; j++) {\n                await storage.addProductUnit({\n                  productId: product.id,\n                  unitName: unitNames[j],\n                  conversionToBase: 1,\n                  baseUnit: unitNames[j],\n                  sortOrder: j,\n                });\n              }\n            }\n\n            imported++;\n          } catch (err) {\n            errors.push({ row: i + 1, message: \"Gagal menyimpan produk\" });\n            skipped++;\n          }\n        } else {\n          const sku = String(row[0] || \"\").trim();\n          const name = String(row[1] || \"\").trim();\n          const category = String(row[2] || \"\").trim() || null;\n          const description = String(row[3] || \"\").trim() || null;\n          const currentStock = parseInt(String(row[4] || \"0\"), 10);\n          const locationRaw = String(row[5] || \"\").trim().toLowerCase();\n          const locationType = locationRaw === \"gudang\" ? \"gudang\" : \"toko\";\n          const satuanRaw = String(row[6] || \"\").trim();\n\n          if (!sku) {\n            errors.push({ row: i + 1, message: \"SKU wajib diisi\" });\n            skipped++;\n            continue;\n          }\n\n          if (!name) {\n            errors.push({ row: i + 1, message: \"Nama Produk wajib diisi\" });\n            skipped++;\n            continue;\n          }\n\n          if (existingSkus.has(sku.toLowerCase())) {\n            errors.push({ row: i + 1, message: `SKU \"${sku}\" sudah ada` });\n            skipped++;\n            continue;\n          }\n\n          if (isNaN(currentStock) || currentStock < 0) {\n            errors.push({ row: i + 1, message: \"Stok harus berupa angka positif\" });\n            skipped++;\n            continue;\n          }\n\n          const subCategoryRaw = String(row[7] || \"\").trim() || null;\n          const productCodeRaw = String(row[8] || \"\").trim() || null;\n\n          try {\n            const product = await storage.createProduct({\n              sku,\n              name,\n              category,\n              description,\n              currentStock,\n              photoUrl: null,\n              userId: adminId,\n              locationType,\n              subCategory: subCategoryRaw,\n              productCode: productCodeRaw,\n            });\n            existingSkus.add(sku.toLowerCase());\n\n            if (satuanRaw) {\n              const unitNames = satuanRaw.split(\",\").map(s => s.trim()).filter(Boolean);\n              for (let j = 0; j < unitNames.length; j++) {\n                await storage.addProductUnit({\n                  productId: product.id,\n                  unitName: unitNames[j],\n                  conversionToBase: 1,\n                  baseUnit: unitNames[j],\n                  sortOrder: j,\n                });\n              }\n            }\n\n            imported++;\n          } catch (err) {\n            errors.push({ row: i + 1, message: \"Gagal menyimpan produk\" });\n            skipped++;\n          }\n        }\n      }\n\n      res.json({ imported, skipped, errors, format: isGudangFormat ? \"gudang\" : \"standard\" });\n    } catch (err) {\n      console.error(\"Excel import error:\", err);\n      res.status(500).json({ message: \"Gagal memproses file Excel\" });\n    }\n  });\n\n  app.get(api.excel.export.path, isAuthenticated, requireRole(\"admin\", \"sku_manager\"), async (req, res) => {\n    try {\n      const adminId = await getTeamAdminId(req);\n      const productsWithUnits = await storage.getProductsWithPhotosAndUnits(adminId);\n\n      const wb = XLSX.utils.book_new();\n      const headers = [\"SKU\", \"Nama Produk\", \"Kategori\", \"Deskripsi\", \"Stok\", \"Lokasi\", \"Satuan\", \"Sub Kategori\", \"Kode Produk\"];\n      const rows = productsWithUnits.map(p => [\n        p.sku,\n        p.name,\n        p.category || \"\",\n        p.description || \"\",\n        p.currentStock,\n        p.locationType || \"toko\",\n        p.units && p.units.length > 0\n          ? p.units.sort((a, b) => a.sortOrder - b.sortOrder).map(u => u.unitName).join(\", \")\n          : \"\",\n        p.subCategory || \"\",\n        p.productCode || \"\",\n      ]);\n\n      const ws = XLSX.utils.aoa_to_sheet([headers, ...rows]);\n      ws[\"!cols\"] = [{ wch: 15 }, { wch: 25 }, { wch: 15 }, { wch: 30 }, { wch: 12 }, { wch: 10 }, { wch: 20 }, { wch: 15 }, { wch: 15 }];\n      XLSX.utils.book_append_sheet(wb, ws, \"Produk\");\n      const buf = XLSX.write(wb, { type: \"buffer\", bookType: \"xlsx\" });\n      res.setHeader(\"Content-Disposition\", \"attachment; filename=produk_export.xlsx\");\n      res.setHeader(\"Content-Type\", \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\");\n      res.send(buf);\n    } catch (err) {\n      console.error(\"Excel export error:\", err);\n      res.status(500).json({ message: \"Gagal export Excel\" });\n    }\n  });\n\n  return httpServer;\n}\n","path":null,"size_bytes":41127,"size_tokens":null},"client/src/pages/StaffManagement.tsx":{"content":"import { useState } from \"react\";\nimport { useStaff, useCreateStaff, useUpdateStaff, useDeleteStaff } from \"@/hooks/use-staff\";\nimport { useRole } from \"@/hooks/use-role\";\nimport type { StaffMember } from \"@shared/schema\";\nimport { Plus, Trash2, Loader2, Users, Pencil, Save, X, Filter } from \"lucide-react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\n\nconst locationTypeLabels: Record<string, string> = {\n  toko: \"Toko\",\n  gudang: \"Gudang\",\n};\n\nconst locationTypeColors: Record<string, string> = {\n  toko: \"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400\",\n  gudang: \"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400\",\n};\n\nexport default function StaffManagement() {\n  const { data: staffMembers, isLoading } = useStaff();\n  const { isAdmin, canManageSku } = useRole();\n  const [locationFilter, setLocationFilter] = useState<string>(\"all\");\n  const [isCreateOpen, setIsCreateOpen] = useState(false);\n  const [editingId, setEditingId] = useState<number | null>(null);\n\n  const canManage = isAdmin || canManageSku;\n\n  if (!canManage) {\n    return (\n      <div className=\"space-y-8 animate-enter\">\n        <div>\n          <h1 className=\"text-3xl font-display font-bold text-foreground\">Manajemen Staff</h1>\n          <p className=\"text-muted-foreground mt-2\">Anda tidak memiliki akses ke halaman ini.</p>\n        </div>\n      </div>\n    );\n  }\n\n  const filteredStaff = staffMembers?.filter((staff: StaffMember) => {\n    const matchesLocation = locationFilter === \"all\" || staff.locationType === locationFilter;\n    return matchesLocation;\n  });\n\n  return (\n    <div className=\"space-y-8 animate-enter\">\n      <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-3xl font-display font-bold text-foreground flex items-center gap-3\">\n            <Users className=\"w-8 h-8 text-primary\" />\n            Manajemen Staff\n          </h1>\n          <p className=\"text-muted-foreground mt-2\">Kelola staff yang melakukan stock opname (SO).</p>\n        </div>\n        <div className=\"flex items-center gap-3 flex-wrap\">\n          <Select value={locationFilter} onValueChange={setLocationFilter}>\n            <SelectTrigger className=\"w-40 bg-white\" data-testid=\"select-location-filter\">\n              <Filter className=\"w-4 h-4 mr-2 text-muted-foreground\" />\n              <SelectValue placeholder=\"Semua Lokasi\" />\n            </SelectTrigger>\n            <SelectContent className=\"bg-card border border-border\">\n              <SelectItem value=\"all\">Semua Lokasi</SelectItem>\n              <SelectItem value=\"toko\">Toko</SelectItem>\n              <SelectItem value=\"gudang\">Gudang</SelectItem>\n            </SelectContent>\n          </Select>\n          <CreateStaffDialog open={isCreateOpen} onOpenChange={setIsCreateOpen} />\n        </div>\n      </div>\n\n      <div className=\"bg-card border border-border/50 rounded-2xl shadow-sm overflow-hidden\">\n        {isLoading ? (\n          <div className=\"p-12 flex justify-center\">\n            <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n          </div>\n        ) : filteredStaff?.length === 0 ? (\n          <div className=\"p-16 text-center\">\n            <Users className=\"w-16 h-16 mx-auto text-muted-foreground/30 mb-4\" />\n            <h3 className=\"text-lg font-semibold text-foreground\">Tidak ada staff</h3>\n            <p className=\"text-muted-foreground mt-1\">Mulai dengan menambahkan staff baru.</p>\n          </div>\n        ) : (\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full text-left text-sm\">\n              <thead>\n                <tr className=\"bg-muted/30 border-b border-border/50\">\n                  <th className=\"px-6 py-4 font-medium text-muted-foreground\">Nama</th>\n                  <th className=\"px-6 py-4 font-medium text-muted-foreground\">Lokasi</th>\n                  <th className=\"px-6 py-4 font-medium text-muted-foreground\">Status</th>\n                  <th className=\"px-6 py-4 font-medium text-muted-foreground text-right\">Aksi</th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-border/50\">\n                {filteredStaff?.map((staff: StaffMember) => (\n                  editingId === staff.id ? (\n                    <EditStaffRow\n                      key={staff.id}\n                      staff={staff}\n                      onCancel={() => setEditingId(null)}\n                      onSaved={() => setEditingId(null)}\n                    />\n                  ) : (\n                    <tr key={staff.id} className=\"hover:bg-muted/20 transition-colors group\" data-testid={`row-staff-${staff.id}`}>\n                      <td className=\"px-6 py-4 font-medium text-foreground\">{staff.name}</td>\n                      <td className=\"px-6 py-4\">\n                        {staff.locationType && (\n                          <Badge className={locationTypeColors[staff.locationType] || \"\"} data-testid={`badge-location-${staff.id}`}>\n                            {locationTypeLabels[staff.locationType] || staff.locationType}\n                          </Badge>\n                        )}\n                      </td>\n                      <td className=\"px-6 py-4\">\n                        <Badge variant={staff.active ? \"default\" : \"secondary\"} data-testid={`badge-status-${staff.id}`}>\n                          {staff.active ? \"Aktif\" : \"Tidak Aktif\"}\n                        </Badge>\n                      </td>\n                      <td className=\"px-6 py-4 text-right\">\n                        <div className=\"flex items-center justify-end gap-1\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            className=\"text-muted-foreground\"\n                            onClick={() => setEditingId(staff.id)}\n                            data-testid={`button-edit-staff-${staff.id}`}\n                          >\n                            <Pencil className=\"w-4 h-4\" />\n                          </Button>\n                          <DeleteStaffButton id={staff.id} name={staff.name} />\n                        </div>\n                      </td>\n                    </tr>\n                  )\n                ))}\n              </tbody>\n            </table>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction EditStaffRow({ staff, onCancel, onSaved }: { staff: StaffMember; onCancel: () => void; onSaved: () => void }) {\n  const [name, setName] = useState(staff.name);\n  const [locationType, setLocationType] = useState(staff.locationType || \"toko\");\n  const updateStaff = useUpdateStaff();\n\n  const handleSave = () => {\n    updateStaff.mutate(\n      { id: staff.id, name, locationType },\n      { onSuccess: onSaved }\n    );\n  };\n\n  return (\n    <tr className=\"bg-primary/5\" data-testid={`row-edit-staff-${staff.id}`}>\n      <td className=\"px-6 py-3\">\n        <Input\n          value={name}\n          onChange={(e) => setName(e.target.value)}\n          className=\"bg-white\"\n          data-testid={`input-edit-name-${staff.id}`}\n        />\n      </td>\n      <td className=\"px-6 py-3\">\n        <Select value={locationType} onValueChange={(value) => setLocationType(value as \"toko\" | \"gudang\")}>\n          <SelectTrigger className=\"w-32 bg-white\" data-testid={`select-edit-location-${staff.id}`}>\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent className=\"bg-card border border-border\">\n            <SelectItem value=\"toko\">Toko</SelectItem>\n            <SelectItem value=\"gudang\">Gudang</SelectItem>\n          </SelectContent>\n        </Select>\n      </td>\n      <td className=\"px-6 py-3\">\n        <Badge variant=\"default\">Aktif</Badge>\n      </td>\n      <td className=\"px-6 py-4 text-right\">\n        <div className=\"flex items-center justify-end gap-1\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={handleSave}\n            disabled={updateStaff.isPending}\n            data-testid={`button-save-edit-${staff.id}`}\n          >\n            {updateStaff.isPending ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <Save className=\"w-4 h-4 text-green-600\" />}\n          </Button>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={onCancel}\n            data-testid={`button-cancel-edit-${staff.id}`}\n          >\n            <X className=\"w-4 h-4 text-muted-foreground\" />\n          </Button>\n        </div>\n      </td>\n    </tr>\n  );\n}\n\nfunction CreateStaffDialog({ open, onOpenChange }: { open: boolean; onOpenChange: (open: boolean) => void }) {\n  const createStaff = useCreateStaff();\n  const [name, setName] = useState(\"\");\n  const [locationType, setLocationType] = useState(\"toko\");\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    createStaff.mutate(\n      { name, locationType },\n      {\n        onSuccess: () => {\n          onOpenChange(false);\n          setName(\"\");\n          setLocationType(\"toko\");\n        },\n      }\n    );\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogTrigger asChild>\n        <Button data-testid=\"button-add-staff\">\n          <Plus className=\"w-4 h-4 mr-2\" />\n          Tambah Staff\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"sm:max-w-[450px]\">\n        <DialogHeader>\n          <DialogTitle>Tambah Staff Baru</DialogTitle>\n        </DialogHeader>\n        <form onSubmit={handleSubmit} className=\"space-y-4 pt-4\">\n          <div>\n            <label className=\"text-sm font-medium text-foreground mb-1.5 block\">Nama</label>\n            <Input\n              value={name}\n              onChange={(e) => setName(e.target.value)}\n              placeholder=\"Nama staff\"\n              required\n              data-testid=\"input-staff-name\"\n            />\n          </div>\n\n          <div>\n            <label className=\"text-sm font-medium text-foreground mb-1.5 block\">Lokasi</label>\n            <Select value={locationType} onValueChange={setLocationType}>\n              <SelectTrigger data-testid=\"select-staff-location\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent className=\"bg-card border border-border\">\n                <SelectItem value=\"toko\">Toko</SelectItem>\n                <SelectItem value=\"gudang\">Gudang</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"flex justify-end gap-3 pt-2\">\n            <Button type=\"button\" variant=\"outline\" onClick={() => onOpenChange(false)}>Batal</Button>\n            <Button type=\"submit\" disabled={createStaff.isPending} data-testid=\"button-submit-staff\">\n              {createStaff.isPending && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n              Tambah Staff\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nfunction DeleteStaffButton({ id, name }: { id: number; name: string }) {\n  const deleteStaff = useDeleteStaff();\n\n  return (\n    <AlertDialog>\n      <AlertDialogTrigger asChild>\n        <Button variant=\"ghost\" size=\"icon\" className=\"text-muted-foreground\" data-testid={`button-delete-staff-${id}`}>\n          <Trash2 className=\"w-4 h-4\" />\n        </Button>\n      </AlertDialogTrigger>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle>Hapus Staff?</AlertDialogTitle>\n          <AlertDialogDescription>\n            Apakah Anda yakin ingin menghapus <strong>{name}</strong>? Aksi ini tidak dapat dibatalkan.\n          </AlertDialogDescription>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel>Batal</AlertDialogCancel>\n          <AlertDialogAction\n            className=\"bg-destructive\"\n            onClick={() => deleteStaff.mutate(id)}\n            data-testid=\"button-confirm-delete\"\n          >\n            Hapus\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n","path":null,"size_bytes":12570,"size_tokens":null},"client/src/index.css":{"content":"@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@500;600;700&display=swap');\n\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --font-body: 'Inter', sans-serif;\n  --font-display: 'Outfit', sans-serif;\n\n  /* HSL Colors - Modern Blue & Slate Palette */\n  --background: 210 40% 98%;\n  --foreground: 222 47% 11%;\n\n  --primary: 221 83% 53%;\n  --primary-foreground: 210 40% 98%;\n\n  --secondary: 210 40% 96%;\n  --secondary-foreground: 222 47% 11%;\n\n  --muted: 210 40% 96%;\n  --muted-foreground: 215 16% 47%;\n\n  --accent: 262 83% 58%;\n  --accent-foreground: 210 40% 98%;\n\n  --destructive: 0 84% 60%;\n  --destructive-foreground: 210 40% 98%;\n\n  --border: 214 32% 91%;\n  --input: 214 32% 91%;\n  --ring: 221 83% 53%;\n\n  --radius: 0.75rem;\n}\n\n.dark {\n  --background: 222 47% 11%;\n  --foreground: 210 40% 98%;\n  --primary: 217 91% 60%;\n  --primary-foreground: 222 47% 11%;\n  /* ... simplified dark mode for now ... */\n}\n\n@layer base {\n  body {\n    @apply bg-background text-foreground antialiased selection:bg-primary/20 selection:text-primary;\n    font-family: var(--font-body);\n  }\n\n  h1, h2, h3, h4, h5, h6 {\n    font-family: var(--font-display);\n    @apply font-bold tracking-tight text-foreground;\n  }\n}\n\n@layer utilities {\n  .glass-card {\n    @apply bg-white/80 backdrop-blur-md border border-white/20 shadow-xl shadow-black/5;\n  }\n  \n  .animate-enter {\n    animation: enter 0.4s ease-out forwards;\n  }\n}\n\n@keyframes enter {\n  from {\n    opacity: 0;\n    transform: translateY(10px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n","path":null,"size_bytes":1607,"size_tokens":null},"replit.md":{"content":"# Stockify - Inventory Management & Stock Opname\n\n## Overview\nA full-stack inventory management application for stock opname (stock counting/auditing). Built with Express + Vite + React + PostgreSQL + Drizzle ORM. Supports location-based access control (Toko/Gudang), multi-photo with compression, hierarchical units, staff management, announcements, feedback, and motivation messages.\n\n## Recent Changes\n- **2026-02-18**: Batch photo upload with in-app camera (WebRTC) - kamera langsung terbuka di dalam app, bisa foto berkali-kali, preview semua foto, hapus yang tidak diinginkan, upload semua sekaligus. Diterapkan di Products dan SessionDetail.\n- **2026-02-18**: Fixed logout to reliably redirect to login screen via page reload\n- **2026-02-13**: Announcements with image support - admin can upload images to announcements, displayed prominently at top of Dashboard as banners with big header text and images, also shown in popup dialog\n- **2026-02-13**: Announcement popup - active announcements show as popup dialog when user opens the app\n- **2026-02-13**: Selective ZIP download dialog (filter by product or date) using POST endpoint\n- **2026-02-13**: Bulk delete products (checkbox selection, select all, confirm dialog)\n- **2026-02-13**: Category priority ordering per-user (all users including stock counter can set their own order, falls back to admin's order)\n- **2026-02-12**: Added location-based access (Toko/Gudang) for products and sessions\n- **2026-02-12**: New roles: stock_counter_toko (only toko), stock_counter_gudang (only gudang)\n- **2026-02-12**: Multi-photo support per product and per opname record with client-side compression\n- **2026-02-12**: Unit hierarchy (unit beranak) for gudang products (e.g., 1 Dus = 24 Pack)\n- **2026-02-12**: Staff Management page - manage SO staff with location assignment\n- **2026-02-12**: \"Siapa yang Stock Opname?\" dialog with staff selection and motivation messages\n- **2026-02-12**: Announcements page (admin-only), displayed on Dashboard\n- **2026-02-12**: Kritik & Saran (Feedback) page for all users\n- **2026-02-12**: Motivation Messages page (admin-only) - customizable messages for SO dialog\n- **2026-02-16**: Migrated photo storage from local /uploads to Replit Object Storage for permanent persistence across server restarts. Old /uploads URLs still served for backward compatibility.\n- **2026-02-16**: Database migrated to Supabase - server/db.ts uses SUPABASE_DATABASE_URL as primary, falls back to DATABASE_URL. Schema synced via drizzle-kit push. All data (553 products, 1392 photos, 4406 opname records, 8 users) preserved.\n- **2026-02-13**: Disabled auto-delete photos (was 7 days), photos now stored permanently\n- **2026-02-12**: Photo compression before upload (max 1200px, 0.7 quality JPEG)\n- **2026-02-11**: Switched to username/password auth (bcryptjs). Every registered user is admin (superuser). Admin can create sub-users from Role Management page.\n- **2026-02-11**: Team-based data isolation: admin creates sub-users, all team members see admin's data.\n- **2026-02-11**: Edit Profile, Inline edit products, Excel import/export, Lupa Password\n\n## Architecture\n\n### Backend\n- **server/routes.ts** - API routes with authentication, role-based middleware, team-based data access, photo uploads, auto-cleanup\n- **server/storage.ts** - Database CRUD operations via IStorage interface (products, sessions, photos, units, staff, announcements, feedback, motivation)\n- **server/replit_integrations/auth/routes.ts** - Username/password auth (register, login, logout, profile update, create sub-user)\n- **server/replit_integrations/auth/storage.ts** - User CRUD operations\n- **server/replit_integrations/auth/replitAuth.ts** - Session middleware (express-session + connect-pg-simple)\n- **shared/schema.ts** - Drizzle ORM schema definitions + Zod validation\n- **shared/models/auth.ts** - User & session table definitions\n- **shared/routes.ts** - Typed API route definitions shared between frontend and backend\n\n### Frontend (client/src/)\n- **App.tsx** - Main app with auth-gated routing, login/register forms\n- **pages/Dashboard.tsx** - Overview with stats, active sessions, low stock alerts, announcements\n- **pages/Products.tsx** - Product catalog with location tabs (Toko/Gudang), multi-photo gallery, unit management, search, category filter, inline edit\n- **pages/Sessions.tsx** - Stock opname session list with location filtering, staff selection dialog, motivation messages\n- **pages/SessionDetail.tsx** - Individual session with multi-photo per record, unit-based input for gudang, photo compression, category filter, Excel export\n- **pages/RoleManagement.tsx** - Admin-only: manage team users, create sub-users with 5 role types\n- **pages/StaffManagement.tsx** - Manage SO staff members with location assignment\n- **pages/Announcements.tsx** - Admin creates/edits announcements for team\n- **pages/FeedbackPage.tsx** - Kritik & Saran submission and viewing\n- **pages/MotivationPage.tsx** - Admin manages motivation messages\n- **pages/Profile.tsx** - Edit profile (name, username, password)\n- **components/Sidebar.tsx** - Navigation sidebar with role-based menu items\n- **hooks/use-auth.ts** - Authentication state hook\n- **hooks/use-role.ts** - Role and permissions hook (canCountToko, canCountGudang, canCountLocation)\n- **hooks/use-products.ts** - Product, photo, unit CRUD hooks\n- **hooks/use-sessions.ts** - Session, record, record photo hooks\n- **hooks/use-staff.ts** - Staff CRUD hooks\n- **hooks/use-announcements.ts** - Announcement CRUD hooks\n- **hooks/use-feedback.ts** - Feedback CRUD hooks\n- **hooks/use-motivation.ts** - Motivation message CRUD hooks\n\n### Database Tables\n- **users** - User accounts with username, password (hashed), adminId\n- **sessions** - Express session storage (connect-pg-simple)\n- **user_roles** - Role assignments (admin, sku_manager, stock_counter, stock_counter_toko, stock_counter_gudang)\n- **products** - Inventory items with SKU, name, category, stock, locationType (toko/gudang). userId = adminId\n- **product_photos** - Multiple photos per product with URL and timestamp\n- **product_units** - Unit hierarchy per product (unitName, conversionToBase, baseUnit, sortOrder)\n- **opname_sessions** - Stock counting sessions with locationType, startedByName, assignedTo\n- **opname_records** - Individual stock count entries per session/product, unitValues for gudang\n- **opname_record_photos** - Multiple photos per opname record\n- **staff_members** - SO staff with name and locationType\n- **announcements** - Team announcements with title, content, expiresAt\n- **feedback** - Kritik & Saran entries with type and content\n- **motivation_messages** - Customizable motivation messages for SO dialog\n- **category_priorities** - Admin-configurable category display ordering\n\n### Auth & Team System\n- Every user who registers via the public form becomes an admin\n- Admin can create sub-users from Role Management\n- Sub-users have adminId pointing to their creator admin\n- Data access: getTeamAdminId() returns admin's own ID or sub-user's adminId\n- Products, sessions, staff, announcements etc. stored with userId = adminId\n\n### Roles\n- **admin** - Full access: products, sessions, user management, announcements, motivation\n- **sku_manager** - Can manage products/SKUs, staff. No sessions or role management\n- **stock_counter** - Can create sessions and count stock for both Toko and Gudang\n- **stock_counter_toko** - Can only stock opname for Toko location\n- **stock_counter_gudang** - Can only stock opname for Gudang location\n\n### Photo System\n- Photos uploaded via multer, then saved to Replit Object Storage (permanent cloud storage)\n- New photos stored at `/objects/uploads/<uuid>.<ext>` paths, served via Object Storage routes\n- Legacy photos at `/uploads/` paths still served via express.static for backward compatibility\n- Client-side compression: max 1200px width, 0.7 quality JPEG (compressImage utility in lib/utils.ts)\n- Multi-photo support per product and per opname record\n- Photos stored permanently (no auto-cleanup)\n\n### Unit System (Gudang Products)\n- Gudang products can have hierarchical units (unit beranak)\n- Example: 1 Dus = 24 Pack, 1 Pack = 50 gr\n- Units stored in product_units table with conversionToBase and baseUnit\n- During stock opname, gudang products show unit input fields\n- Total calculated from unit values and stored in unitValues JSON field\n\n## User Preferences\n- Indonesian language (Bahasa Indonesia) for all UI labels\n- SelectContent dropdowns: always use className=\"bg-card border border-border\"\n- Photos stored in /uploads directory (not client/public)\n\n## Running\n- `npm run dev` starts Express backend + Vite frontend on port 5000\n- `npm run db:push` syncs schema to database\n","path":null,"size_bytes":8734,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/App.tsx":{"content":"import { useState, useEffect, useCallback } from \"react\";\nimport { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { Sidebar } from \"@/components/Sidebar\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useAnnouncements } from \"@/hooks/use-announcements\";\nimport Dashboard from \"@/pages/Dashboard\";\nimport Products from \"@/pages/Products\";\nimport Sessions from \"@/pages/Sessions\";\nimport SessionDetail from \"@/pages/SessionDetail\";\nimport RoleManagement from \"@/pages/RoleManagement\";\nimport Profile from \"@/pages/Profile\";\nimport StaffManagement from \"@/pages/StaffManagement\";\nimport Announcements from \"@/pages/Announcements\";\nimport FeedbackPage from \"@/pages/FeedbackPage\";\nimport MotivationPage from \"@/pages/MotivationPage\";\nimport NotFound from \"@/pages/not-found\";\nimport { BackgroundUploadProvider } from \"@/components/BackgroundUpload\";\nimport { Loader2, Package, AlertCircle, Info, Megaphone, ChevronLeft, ChevronRight } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport type { Announcement } from \"@shared/schema\";\n\nfunction LoginPage() {\n  const { login, register, loginError, registerError, isLoggingIn, isRegistering } = useAuth();\n  const [mode, setMode] = useState<\"login\" | \"register\">(\"login\");\n  const [username, setUsername] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [firstName, setFirstName] = useState(\"\");\n  const [lastName, setLastName] = useState(\"\");\n  const [showForgotInfo, setShowForgotInfo] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (mode === \"login\") {\n      await login({ username, password });\n    } else {\n      await register({ username, password, firstName, lastName });\n    }\n  };\n\n  const error = mode === \"login\" ? loginError : registerError;\n  const isPending = mode === \"login\" ? isLoggingIn : isRegistering;\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-background to-muted/30 p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"text-center space-y-4\">\n          <div className=\"mx-auto bg-gradient-to-br from-primary to-accent p-4 rounded-2xl shadow-lg shadow-primary/20 w-fit\">\n            <Package className=\"w-10 h-10 text-white\" />\n          </div>\n          <div>\n            <CardTitle className=\"text-2xl font-display\">Stockify</CardTitle>\n            <CardDescription className=\"mt-1\">\n              {mode === \"login\" ? \"Masuk ke akun Anda\" : \"Daftar akun baru\"}\n            </CardDescription>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            {error && (\n              <div className=\"flex items-center gap-2 p-3 rounded-md bg-destructive/10 text-destructive text-sm\" data-testid=\"text-auth-error\">\n                <AlertCircle className=\"w-4 h-4 shrink-0\" />\n                {error.message}\n              </div>\n            )}\n\n            {mode === \"register\" && (\n              <div className=\"grid grid-cols-2 gap-3\">\n                <div>\n                  <label className=\"text-sm font-medium text-foreground mb-1.5 block\">Nama Depan</label>\n                  <Input\n                    value={firstName}\n                    onChange={(e) => setFirstName(e.target.value)}\n                    placeholder=\"John\"\n                    data-testid=\"input-first-name\"\n                  />\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium text-foreground mb-1.5 block\">Nama Belakang</label>\n                  <Input\n                    value={lastName}\n                    onChange={(e) => setLastName(e.target.value)}\n                    placeholder=\"Doe\"\n                    data-testid=\"input-last-name\"\n                  />\n                </div>\n              </div>\n            )}\n\n            <div>\n              <label className=\"text-sm font-medium text-foreground mb-1.5 block\">Username</label>\n              <Input\n                value={username}\n                onChange={(e) => setUsername(e.target.value)}\n                placeholder=\"username\"\n                autoComplete=\"username\"\n                required\n                data-testid=\"input-username\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-foreground mb-1.5 block\">Password</label>\n              <Input\n                type=\"password\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                placeholder=\"******\"\n                autoComplete={mode === \"login\" ? \"current-password\" : \"new-password\"}\n                required\n                data-testid=\"input-password\"\n              />\n            </div>\n\n            <Button type=\"submit\" className=\"w-full\" disabled={isPending} data-testid=\"button-submit-auth\">\n              {isPending && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n              {mode === \"login\" ? \"Masuk\" : \"Daftar\"}\n            </Button>\n\n            {mode === \"login\" && (\n              <div className=\"text-center\">\n                <button\n                  type=\"button\"\n                  className=\"text-sm text-muted-foreground hover:text-foreground transition-colors\"\n                  onClick={() => setShowForgotInfo(true)}\n                  data-testid=\"button-forgot-password\"\n                >\n                  Lupa Password?\n                </button>\n              </div>\n            )}\n\n            <div className=\"text-center text-sm text-muted-foreground\">\n              {mode === \"login\" ? (\n                <span>\n                  Belum punya akun?{\" \"}\n                  <button\n                    type=\"button\"\n                    className=\"text-primary font-medium hover:underline\"\n                    onClick={() => { setMode(\"register\"); setUsername(\"\"); setPassword(\"\"); }}\n                    data-testid=\"button-switch-register\"\n                  >\n                    Daftar di sini\n                  </button>\n                </span>\n              ) : (\n                <span>\n                  Sudah punya akun?{\" \"}\n                  <button\n                    type=\"button\"\n                    className=\"text-primary font-medium hover:underline\"\n                    onClick={() => { setMode(\"login\"); setUsername(\"\"); setPassword(\"\"); }}\n                    data-testid=\"button-switch-login\"\n                  >\n                    Masuk di sini\n                  </button>\n                </span>\n              )}\n            </div>\n          </form>\n        </CardContent>\n      </Card>\n\n      <Dialog open={showForgotInfo} onOpenChange={setShowForgotInfo}>\n        <DialogContent className=\"sm:max-w-[400px]\">\n          <DialogHeader>\n            <DialogTitle>Lupa Password?</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 pt-2\">\n            <div className=\"flex gap-3 p-4 rounded-lg bg-muted/50 border border-border/50\">\n              <Info className=\"w-5 h-5 text-primary shrink-0 mt-0.5\" />\n              <div className=\"space-y-2 text-sm text-muted-foreground\">\n                <p>Hubungi <strong className=\"text-foreground\">Admin</strong> tim Anda untuk mereset password.</p>\n                <p>Admin dapat mereset password Anda melalui halaman <strong className=\"text-foreground\">User Roles</strong>.</p>\n              </div>\n            </div>\n            <p className=\"text-xs text-muted-foreground text-center\">\n              Jika Anda adalah admin dan lupa password, silakan hubungi administrator sistem.\n            </p>\n            <div className=\"flex justify-end\">\n              <Button variant=\"outline\" onClick={() => setShowForgotInfo(false)} data-testid=\"button-close-forgot\">\n                Tutup\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n\nfunction AnnouncementPopup() {\n  const { data: announcements } = useAnnouncements();\n  const [open, setOpen] = useState(false);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [activeAnnouncements, setActiveAnnouncements] = useState<Announcement[]>([]);\n\n  useEffect(() => {\n    if (!announcements || announcements.length === 0) return;\n\n    const now = new Date();\n    const active = (announcements as Announcement[]).filter((a) => {\n      if (a.expiresAt && new Date(a.expiresAt) < now) return false;\n      return true;\n    });\n\n    if (active.length === 0) return;\n\n    const dismissedRaw = localStorage.getItem(\"dismissed_announcements\");\n    const dismissed: Record<string, string> = dismissedRaw ? JSON.parse(dismissedRaw) : {};\n\n    const unread = active.filter((a) => {\n      const dismissedAt = dismissed[String(a.id)];\n      if (!dismissedAt) return true;\n      return new Date(a.createdAt) > new Date(dismissedAt);\n    });\n\n    if (unread.length > 0) {\n      setActiveAnnouncements(unread);\n      setCurrentIndex(0);\n      setOpen(true);\n    }\n  }, [announcements]);\n\n  const dismissAll = useCallback(() => {\n    const dismissedRaw = localStorage.getItem(\"dismissed_announcements\");\n    const dismissed: Record<string, string> = dismissedRaw ? JSON.parse(dismissedRaw) : {};\n    const now = new Date().toISOString();\n    activeAnnouncements.forEach((a) => {\n      dismissed[String(a.id)] = now;\n    });\n    localStorage.setItem(\"dismissed_announcements\", JSON.stringify(dismissed));\n    setOpen(false);\n  }, [activeAnnouncements]);\n\n  if (activeAnnouncements.length === 0) return null;\n\n  const current = activeAnnouncements[currentIndex];\n  if (!current) return null;\n\n  return (\n    <Dialog open={open} onOpenChange={(v) => { if (!v) dismissAll(); }}>\n      <DialogContent className=\"sm:max-w-[500px]\">\n        <DialogHeader>\n          <div className=\"flex items-center gap-3\">\n            <div className=\"bg-primary/10 p-2 rounded-lg\">\n              <Megaphone className=\"w-5 h-5 text-primary\" />\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <DialogTitle className=\"text-lg\">{current.title}</DialogTitle>\n              <p className=\"text-xs text-muted-foreground mt-0.5\">\n                {new Date(current.createdAt).toLocaleDateString(\"id-ID\", { day: \"numeric\", month: \"long\", year: \"numeric\" })}\n              </p>\n            </div>\n            {activeAnnouncements.length > 1 && (\n              <Badge variant=\"secondary\" className=\"no-default-hover-elevate no-default-active-elevate shrink-0\" data-testid=\"badge-announcement-count\">\n                {currentIndex + 1}/{activeAnnouncements.length}\n              </Badge>\n            )}\n          </div>\n        </DialogHeader>\n        <div className=\"py-3 space-y-3\">\n          {current.imageUrl && (\n            <div className=\"w-full rounded-md overflow-hidden\">\n              <img\n                src={current.imageUrl}\n                alt={current.title}\n                className=\"w-full max-h-[300px] object-cover\"\n                data-testid=\"img-announcement-popup\"\n              />\n            </div>\n          )}\n          <p className=\"text-sm text-foreground whitespace-pre-wrap leading-relaxed\" data-testid=\"text-announcement-content\">\n            {current.content}\n          </p>\n        </div>\n        <div className=\"flex items-center justify-between gap-2\">\n          <div className=\"flex items-center gap-1\">\n            {activeAnnouncements.length > 1 && (\n              <>\n                <Button\n                  variant=\"outline\"\n                  size=\"icon\"\n                  onClick={() => setCurrentIndex((i) => Math.max(0, i - 1))}\n                  disabled={currentIndex === 0}\n                  data-testid=\"button-prev-announcement\"\n                >\n                  <ChevronLeft className=\"w-4 h-4\" />\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  size=\"icon\"\n                  onClick={() => setCurrentIndex((i) => Math.min(activeAnnouncements.length - 1, i + 1))}\n                  disabled={currentIndex === activeAnnouncements.length - 1}\n                  data-testid=\"button-next-announcement\"\n                >\n                  <ChevronRight className=\"w-4 h-4\" />\n                </Button>\n              </>\n            )}\n          </div>\n          <Button onClick={dismissAll} data-testid=\"button-dismiss-announcements\">\n            Mengerti\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nfunction AuthenticatedApp() {\n  return (\n    <div className=\"min-h-screen bg-muted/10 flex flex-col lg:flex-row\">\n      <Sidebar />\n      <main className=\"flex-1 p-4 lg:p-8 mt-14 lg:mt-0 overflow-y-auto h-screen\">\n        <div className=\"max-w-7xl mx-auto\">\n          <Switch>\n            <Route path=\"/\" component={Dashboard} />\n            <Route path=\"/products\" component={Products} />\n            <Route path=\"/sessions\" component={Sessions} />\n            <Route path=\"/sessions/:id\" component={SessionDetail} />\n            <Route path=\"/roles\" component={RoleManagement} />\n            <Route path=\"/profile\" component={Profile} />\n            <Route path=\"/staff\" component={StaffManagement} />\n            <Route path=\"/announcements\" component={Announcements} />\n            <Route path=\"/feedback\" component={FeedbackPage} />\n            <Route path=\"/motivation\" component={MotivationPage} />\n            <Route component={NotFound} />\n          </Switch>\n        </div>\n      </main>\n      <AnnouncementPopup />\n    </div>\n  );\n}\n\nfunction Router() {\n  const { isAuthenticated, isLoading } = useAuth();\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (!isAuthenticated) {\n    return <LoginPage />;\n  }\n\n  return <AuthenticatedApp />;\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <BackgroundUploadProvider>\n          <Toaster />\n          <Router />\n        </BackgroundUploadProvider>\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":14661,"size_tokens":null},"client/src/pages/Profile.tsx":{"content":"import { useState } from \"react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { User, Loader2, AlertCircle, CheckCircle2 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\n\nexport default function Profile() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const [firstName, setFirstName] = useState(user?.firstName || \"\");\n  const [lastName, setLastName] = useState(user?.lastName || \"\");\n  const [username, setUsername] = useState(user?.username || \"\");\n  const [currentPassword, setCurrentPassword] = useState(\"\");\n  const [newPassword, setNewPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n\n  const updateProfile = useMutation({\n    mutationFn: async (data: Record<string, string>) => {\n      const res = await fetch(\"/api/auth/profile\", {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n        credentials: \"include\",\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.message || \"Gagal memperbarui profil\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      toast({ title: \"Profil Diperbarui\", description: \"Data profil berhasil disimpan.\" });\n      setCurrentPassword(\"\");\n      setNewPassword(\"\");\n      setConfirmPassword(\"\");\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const handleSaveProfile = (e: React.FormEvent) => {\n    e.preventDefault();\n    updateProfile.mutate({ firstName, lastName, username });\n  };\n\n  const handleChangePassword = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (newPassword !== confirmPassword) {\n      toast({ title: \"Error\", description: \"Password baru dan konfirmasi tidak cocok\", variant: \"destructive\" });\n      return;\n    }\n    updateProfile.mutate({ currentPassword, newPassword });\n  };\n\n  return (\n    <div className=\"space-y-8 animate-enter max-w-2xl\">\n      <div>\n        <h1 className=\"text-3xl font-display font-bold text-foreground flex items-center gap-3\">\n          <User className=\"w-8 h-8 text-primary\" />\n          Edit Profil\n        </h1>\n        <p className=\"text-muted-foreground mt-2\">Ubah informasi profil, username, dan password Anda.</p>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Informasi Profil</CardTitle>\n          <CardDescription>Ubah nama dan username Anda</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSaveProfile} className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"text-sm font-medium text-foreground mb-1.5 block\">Nama Depan</label>\n                <Input\n                  value={firstName}\n                  onChange={(e) => setFirstName(e.target.value)}\n                  placeholder=\"Nama depan\"\n                  data-testid=\"input-profile-first-name\"\n                />\n              </div>\n              <div>\n                <label className=\"text-sm font-medium text-foreground mb-1.5 block\">Nama Belakang</label>\n                <Input\n                  value={lastName}\n                  onChange={(e) => setLastName(e.target.value)}\n                  placeholder=\"Nama belakang\"\n                  data-testid=\"input-profile-last-name\"\n                />\n              </div>\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-foreground mb-1.5 block\">Username</label>\n              <Input\n                value={username}\n                onChange={(e) => setUsername(e.target.value)}\n                placeholder=\"username\"\n                data-testid=\"input-profile-username\"\n              />\n            </div>\n\n            <div className=\"flex justify-end\">\n              <Button type=\"submit\" disabled={updateProfile.isPending} data-testid=\"button-save-profile\">\n                {updateProfile.isPending && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n                Simpan Profil\n              </Button>\n            </div>\n          </form>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Ganti Password</CardTitle>\n          <CardDescription>Pastikan password baru minimal 6 karakter</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleChangePassword} className=\"space-y-4\">\n            <div>\n              <label className=\"text-sm font-medium text-foreground mb-1.5 block\">Password Lama</label>\n              <Input\n                type=\"password\"\n                value={currentPassword}\n                onChange={(e) => setCurrentPassword(e.target.value)}\n                placeholder=\"Masukkan password lama\"\n                required\n                data-testid=\"input-current-password\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-foreground mb-1.5 block\">Password Baru</label>\n              <Input\n                type=\"password\"\n                value={newPassword}\n                onChange={(e) => setNewPassword(e.target.value)}\n                placeholder=\"Masukkan password baru\"\n                required\n                data-testid=\"input-new-password\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-foreground mb-1.5 block\">Konfirmasi Password Baru</label>\n              <Input\n                type=\"password\"\n                value={confirmPassword}\n                onChange={(e) => setConfirmPassword(e.target.value)}\n                placeholder=\"Ketik ulang password baru\"\n                required\n                data-testid=\"input-confirm-password\"\n              />\n            </div>\n\n            <div className=\"flex justify-end\">\n              <Button type=\"submit\" disabled={updateProfile.isPending} data-testid=\"button-change-password\">\n                {updateProfile.isPending && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n                Ganti Password\n              </Button>\n            </div>\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":6613,"size_tokens":null},"server/replit_integrations/auth/storage.ts":{"content":"import { users, type User, type UpsertUser } from \"@shared/models/auth\";\nimport { db } from \"../../db\";\nimport { eq } from \"drizzle-orm\";\n\nexport interface IAuthStorage {\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: UpsertUser): Promise<User>;\n  updateUser(id: string, updates: Partial<UpsertUser>): Promise<User>;\n}\n\nclass AuthStorage implements IAuthStorage {\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.username, username));\n    return user;\n  }\n\n  async createUser(userData: UpsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(userData)\n      .returning();\n    return user;\n  }\n\n  async updateUser(id: string, updates: Partial<UpsertUser>): Promise<User> {\n    const [user] = await db\n      .update(users)\n      .set(updates)\n      .where(eq(users.id, id))\n      .returning();\n    return user;\n  }\n}\n\nexport const authStorage = new AuthStorage();\n","path":null,"size_bytes":1227,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/requirements.md":{"content":"## Packages\nxlsx | Exporting stock opname data to Excel\nframer-motion | Page transitions and UI animations\n\n## Notes\nTailwind Config - extend fontFamily:\nfontFamily: {\n  display: [\"var(--font-display)\"],\n  body: [\"var(--font-body)\"],\n}\n","path":null,"size_bytes":236,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"pg\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1417,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"shared/models/auth.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { index, jsonb, pgTable, timestamp, varchar } from \"drizzle-orm/pg-core\";\n\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)]\n);\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: varchar(\"username\").unique().notNull(),\n  password: varchar(\"password\").notNull(),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  email: varchar(\"email\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  adminId: varchar(\"admin_id\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport type UpsertUser = typeof users.$inferInsert;\nexport type User = typeof users.$inferSelect;\n","path":null,"size_bytes":937,"size_tokens":null},"client/src/lib/auth-utils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}\n\n// Redirect to login with a toast notification\nexport function redirectToLogin(toast?: (options: { title: string; description: string; variant: string }) => void) {\n  if (toast) {\n    toast({\n      title: \"Unauthorized\",\n      description: \"You are logged out. Logging in again...\",\n      variant: \"destructive\",\n    });\n  }\n  setTimeout(() => {\n    window.location.href = \"/api/login\";\n  }, 500);\n}\n","path":null,"size_bytes":517,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"server/replit_integrations/object_storage/index.ts":{"content":"export {\n  ObjectStorageService,\n  ObjectNotFoundError,\n  objectStorageClient,\n} from \"./objectStorage\";\n\nexport type {\n  ObjectAclPolicy,\n  ObjectAccessGroup,\n  ObjectAccessGroupType,\n  ObjectAclRule,\n} from \"./objectAcl\";\n\nexport {\n  canAccessObject,\n  getObjectAclPolicy,\n  setObjectAclPolicy,\n} from \"./objectAcl\";\n\nexport { registerObjectStorageRoutes } from \"./routes\";\n\n","path":null,"size_bytes":377,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"server/replit_integrations/auth/index.ts":{"content":"export { setupAuth, isAuthenticated, getSession } from \"./replitAuth\";\nexport { authStorage, type IAuthStorage } from \"./storage\";\nexport { registerAuthRoutes } from \"./routes\";\n","path":null,"size_bytes":178,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"server/replit_integrations/auth/routes.ts":{"content":"import type { Express } from \"express\";\nimport { authStorage } from \"./storage\";\nimport { isAuthenticated } from \"./replitAuth\";\nimport bcrypt from \"bcryptjs\";\nimport { db } from \"../../db\";\nimport { userRoles } from \"@shared/schema\";\nimport { users } from \"@shared/models/auth\";\nimport { eq } from \"drizzle-orm\";\n\nexport function registerAuthRoutes(app: Express): void {\n  app.post(\"/api/auth/register\", async (req, res) => {\n    try {\n      const { username, password, firstName, lastName } = req.body;\n\n      if (!username || !password) {\n        return res.status(400).json({ message: \"Username dan password wajib diisi\" });\n      }\n\n      if (username.length < 3) {\n        return res.status(400).json({ message: \"Username minimal 3 karakter\" });\n      }\n\n      if (password.length < 6) {\n        return res.status(400).json({ message: \"Password minimal 6 karakter\" });\n      }\n\n      const existing = await authStorage.getUserByUsername(username);\n      if (existing) {\n        return res.status(400).json({ message: \"Username sudah digunakan\" });\n      }\n\n      const hashedPassword = await bcrypt.hash(password, 10);\n      const user = await authStorage.createUser({\n        username,\n        password: hashedPassword,\n        firstName: firstName || null,\n        lastName: lastName || null,\n        adminId: null,\n      });\n\n      await db.insert(userRoles).values({\n        userId: user.id,\n        role: \"admin\",\n      });\n\n      (req.session as any).userId = user.id;\n\n      const { password: _, ...safeUser } = user;\n      res.status(201).json(safeUser);\n    } catch (error) {\n      console.error(\"Register error:\", error);\n      res.status(500).json({ message: \"Gagal mendaftar\" });\n    }\n  });\n\n  app.post(\"/api/auth/login\", async (req, res) => {\n    try {\n      const { username, password } = req.body;\n\n      if (!username || !password) {\n        return res.status(400).json({ message: \"Username dan password wajib diisi\" });\n      }\n\n      const user = await authStorage.getUserByUsername(username);\n      if (!user) {\n        return res.status(401).json({ message: \"Username atau password salah\" });\n      }\n\n      const valid = await bcrypt.compare(password, user.password);\n      if (!valid) {\n        return res.status(401).json({ message: \"Username atau password salah\" });\n      }\n\n      (req.session as any).userId = user.id;\n\n      const { password: _, ...safeUser } = user;\n      res.json(safeUser);\n    } catch (error) {\n      console.error(\"Login error:\", error);\n      res.status(500).json({ message: \"Gagal login\" });\n    }\n  });\n\n  app.get(\"/api/auth/user\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req.session as any).userId;\n      const user = await authStorage.getUser(userId);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      const { password: _, ...safeUser } = user;\n      res.json(safeUser);\n    } catch (error) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n\n  app.put(\"/api/auth/profile\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = (req.session as any).userId;\n      const { firstName, lastName, username, currentPassword, newPassword } = req.body;\n\n      const user = await authStorage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      const updates: Record<string, any> = {};\n\n      if (firstName !== undefined) updates.firstName = firstName;\n      if (lastName !== undefined) updates.lastName = lastName;\n\n      if (username && username !== user.username) {\n        if (username.length < 3) {\n          return res.status(400).json({ message: \"Username minimal 3 karakter\" });\n        }\n        const existing = await authStorage.getUserByUsername(username);\n        if (existing) {\n          return res.status(400).json({ message: \"Username sudah digunakan\" });\n        }\n        updates.username = username;\n      }\n\n      if (newPassword) {\n        if (!currentPassword) {\n          return res.status(400).json({ message: \"Password lama wajib diisi\" });\n        }\n        const valid = await bcrypt.compare(currentPassword, user.password);\n        if (!valid) {\n          return res.status(400).json({ message: \"Password lama salah\" });\n        }\n        if (newPassword.length < 6) {\n          return res.status(400).json({ message: \"Password baru minimal 6 karakter\" });\n        }\n        updates.password = await bcrypt.hash(newPassword, 10);\n      }\n\n      updates.updatedAt = new Date();\n\n      const updated = await authStorage.updateUser(userId, updates);\n      const { password: _, ...safeUser } = updated;\n      res.json(safeUser);\n    } catch (error) {\n      console.error(\"Profile update error:\", error);\n      res.status(500).json({ message: \"Gagal memperbarui profil\" });\n    }\n  });\n\n  app.post(\"/api/auth/create-user\", isAuthenticated, async (req, res) => {\n    try {\n      const adminId = (req.session as any).userId;\n      const adminRole = await db.select().from(userRoles).where(\n        eq(userRoles.userId, adminId)\n      );\n      if (!adminRole[0] || adminRole[0].role !== \"admin\") {\n        return res.status(403).json({ message: \"Hanya admin yang bisa membuat user\" });\n      }\n\n      const { username, password, firstName, lastName, role } = req.body;\n\n      if (!username || !password) {\n        return res.status(400).json({ message: \"Username dan password wajib diisi\" });\n      }\n\n      if (username.length < 3) {\n        return res.status(400).json({ message: \"Username minimal 3 karakter\" });\n      }\n\n      if (password.length < 6) {\n        return res.status(400).json({ message: \"Password minimal 6 karakter\" });\n      }\n\n      if (![\"sku_manager\", \"stock_counter\"].includes(role)) {\n        return res.status(400).json({ message: \"Role harus sku_manager atau stock_counter\" });\n      }\n\n      const existing = await authStorage.getUserByUsername(username);\n      if (existing) {\n        return res.status(400).json({ message: \"Username sudah digunakan\" });\n      }\n\n      const hashedPassword = await bcrypt.hash(password, 10);\n      const user = await authStorage.createUser({\n        username,\n        password: hashedPassword,\n        firstName: firstName || null,\n        lastName: lastName || null,\n        adminId,\n      });\n\n      await db.insert(userRoles).values({\n        userId: user.id,\n        role,\n      });\n\n      const { password: _, ...safeUser } = user;\n      res.status(201).json({ ...safeUser, role });\n    } catch (error) {\n      console.error(\"Create user error:\", error);\n      res.status(500).json({ message: \"Gagal membuat user\" });\n    }\n  });\n\n  app.post(\"/api/auth/reset-password\", isAuthenticated, async (req, res) => {\n    try {\n      const adminId = (req.session as any).userId;\n      const adminRole = await db.select().from(userRoles).where(\n        eq(userRoles.userId, adminId)\n      );\n      if (!adminRole[0] || adminRole[0].role !== \"admin\") {\n        return res.status(403).json({ message: \"Hanya admin yang bisa reset password\" });\n      }\n\n      const { userId, newPassword } = req.body;\n\n      if (!userId || !newPassword) {\n        return res.status(400).json({ message: \"User ID dan password baru wajib diisi\" });\n      }\n\n      if (newPassword.length < 6) {\n        return res.status(400).json({ message: \"Password baru minimal 6 karakter\" });\n      }\n\n      const targetUser = await authStorage.getUser(userId);\n      if (!targetUser) {\n        return res.status(404).json({ message: \"User tidak ditemukan\" });\n      }\n\n      if (targetUser.adminId !== adminId) {\n        return res.status(403).json({ message: \"Anda hanya bisa reset password anggota tim Anda\" });\n      }\n\n      const hashedPassword = await bcrypt.hash(newPassword, 10);\n      await authStorage.updateUser(userId, { password: hashedPassword, updatedAt: new Date() });\n\n      res.json({ message: \"Password berhasil direset\" });\n    } catch (error) {\n      console.error(\"Reset password error:\", error);\n      res.status(500).json({ message: \"Gagal mereset password\" });\n    }\n  });\n\n  app.post(\"/api/auth/logout\", (req, res) => {\n    req.session.destroy((err) => {\n      if (err) {\n        return res.status(500).json({ message: \"Gagal logout\" });\n      }\n      res.clearCookie(\"connect.sid\");\n      res.json({ message: \"Logged out\" });\n    });\n  });\n}\n","path":null,"size_bytes":8411,"size_tokens":null},"client/src/components/Sidebar.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { Package, ClipboardList, LayoutDashboard, Menu, X, Box, Shield, LogOut, UserCog, Users, Megaphone, MessageSquare, Heart } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { cn } from \"@/lib/utils\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useRole } from \"@/hooks/use-role\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\n\nexport function Sidebar() {\n  const [location] = useLocation();\n  const [isOpen, setIsOpen] = useState(false);\n  const { user, logout } = useAuth();\n  const { role, isAdmin, isSKUManager } = useRole();\n\n  const isStockCounterOnly = role === \"stock_counter\" || role === \"stock_counter_toko\" || role === \"stock_counter_gudang\";\n\n  const navigation = [\n    { name: \"Dashboard\", href: \"/\", icon: LayoutDashboard },\n    ...(!isStockCounterOnly ? [{ name: \"Products / SKU\", href: \"/products\", icon: Box }] : []),\n    { name: \"Opname Sessions\", href: \"/sessions\", icon: ClipboardList },\n    ...(isAdmin ? [{ name: \"User Roles\", href: \"/roles\", icon: Shield }] : []),\n    ...(isAdmin || isSKUManager ? [{ name: \"Staff SO\", href: \"/staff\", icon: Users }] : []),\n    ...(isAdmin ? [{ name: \"Pengumuman\", href: \"/announcements\", icon: Megaphone }] : []),\n    { name: \"Kritik & Saran\", href: \"/feedback\", icon: MessageSquare },\n    ...(isAdmin ? [{ name: \"Motivasi\", href: \"/motivation\", icon: Heart }] : []),\n    { name: \"Edit Profil\", href: \"/profile\", icon: UserCog },\n  ];\n\n  const displayName = user?.firstName && user?.lastName\n    ? `${user.firstName} ${user.lastName}`\n    : user?.username || \"User\";\n\n  const initials = user\n    ? (user.firstName && user.lastName\n      ? `${user.firstName[0]}${user.lastName[0]}`.toUpperCase()\n      : (user.username || \"U\").substring(0, 2).toUpperCase())\n    : \"U\";\n\n  const roleLabel: Record<string, string> = {\n    admin: \"Admin\",\n    sku_manager: \"SKU Manager\",\n    stock_counter: \"Stock Counter\",\n    stock_counter_toko: \"Stock Toko\",\n    stock_counter_gudang: \"Stock Gudang\",\n  };\n\n  return (\n    <>\n      <div className=\"lg:hidden fixed top-0 left-0 right-0 z-50 flex items-center justify-between gap-2 px-4 py-3 bg-white/80 backdrop-blur-md border-b border-border/50\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"bg-primary/10 p-1.5 rounded-lg\">\n            <Package className=\"w-5 h-5 text-primary\" />\n          </div>\n          <span className=\"font-display font-bold text-lg text-foreground\">Stockify</span>\n        </div>\n        <button onClick={() => setIsOpen(!isOpen)} className=\"p-2 -mr-2 text-muted-foreground\" data-testid=\"button-mobile-menu\">\n          {isOpen ? <X /> : <Menu />}\n        </button>\n      </div>\n\n      <div className={cn(\n        \"fixed inset-y-0 left-0 z-40 w-64 bg-white border-r border-border/50 shadow-2xl shadow-primary/5 transform transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:h-screen lg:shadow-none\",\n        isOpen ? \"translate-x-0\" : \"-translate-x-full\"\n      )}>\n        <div className=\"flex flex-col h-full\">\n          <div className=\"hidden lg:flex items-center gap-3 px-8 py-8\">\n            <div className=\"bg-gradient-to-br from-primary to-accent p-2.5 rounded-xl shadow-lg shadow-primary/20\">\n              <Package className=\"w-6 h-6 text-white\" />\n            </div>\n            <div>\n              <h1 className=\"font-display font-bold text-xl leading-none\">Stockify</h1>\n              <p className=\"text-xs text-muted-foreground mt-1\">Inventory Manager</p>\n            </div>\n          </div>\n\n          <nav className=\"flex-1 px-4 py-4 space-y-1 mt-14 lg:mt-0\">\n            {navigation.map((item) => {\n              const isActive = location === item.href;\n              return (\n                <Link key={item.name} href={item.href}>\n                  <div\n                    className={cn(\n                      \"flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 cursor-pointer group\",\n                      isActive\n                        ? \"bg-primary/5 text-primary font-medium shadow-sm ring-1 ring-primary/10\"\n                        : \"text-muted-foreground hover:text-foreground hover:bg-muted/50\"\n                    )}\n                    data-testid={`nav-${item.name.toLowerCase().replace(/\\s+/g, \"-\")}`}\n                  >\n                    <item.icon className={cn(\n                      \"w-5 h-5 transition-colors\",\n                      isActive ? \"text-primary\" : \"text-muted-foreground group-hover:text-foreground\"\n                    )} />\n                    {item.name}\n                  </div>\n                </Link>\n              );\n            })}\n          </nav>\n\n          <div className=\"p-4 border-t border-border/50 space-y-3\">\n            <div className=\"bg-muted/30 rounded-xl p-3 flex items-center gap-3\">\n              <Avatar>\n                <AvatarImage src={user?.profileImageUrl || undefined} />\n                <AvatarFallback className=\"bg-gradient-to-br from-indigo-400 to-purple-400 text-white font-bold text-sm\">\n                  {initials}\n                </AvatarFallback>\n              </Avatar>\n              <div className=\"overflow-hidden flex-1\">\n                <p className=\"text-sm font-semibold truncate\" data-testid=\"text-username\">\n                  {displayName}\n                </p>\n                <Badge variant=\"secondary\" className=\"text-xs mt-0.5\" data-testid=\"text-role\">\n                  {roleLabel[role] || role}\n                </Badge>\n              </div>\n            </div>\n            <Button\n              variant=\"ghost\"\n              className=\"w-full justify-start text-muted-foreground\"\n              onClick={() => logout()}\n              data-testid=\"button-logout\"\n            >\n              <LogOut className=\"w-4 h-4 mr-2\" />\n              Sign Out\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      {isOpen && (\n        <div\n          className=\"fixed inset-0 z-30 bg-black/20 backdrop-blur-sm lg:hidden\"\n          onClick={() => setIsOpen(false)}\n        />\n      )}\n    </>\n  );\n}\n","path":null,"size_bytes":6200,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/pages/FeedbackPage.tsx":{"content":"import { useState } from \"react\";\nimport { useFeedback, useCreateFeedback, useDeleteFeedback } from \"@/hooks/use-feedback\";\nimport { useRole } from \"@/hooks/use-role\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { MessageSquare, Send, Trash2, Loader2 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useForm } from \"react-hook-form\";\nimport { z } from \"zod\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { format } from \"date-fns\";\n\nconst feedbackFormSchema = z.object({\n  type: z.enum([\"kritik\", \"saran\"], {\n    errorMap: () => ({ message: \"Pilih tipe feedback\" }),\n  }),\n  content: z.string().min(1, \"Isi feedback tidak boleh kosong\").min(3, \"Feedback minimal 3 karakter\"),\n});\n\ntype FeedbackFormValues = z.infer<typeof feedbackFormSchema>;\n\nexport default function FeedbackPage() {\n  const { data: feedbackList = [], isLoading } = useFeedback();\n  const { isAdmin } = useRole();\n  const { user } = useAuth();\n  const createFeedback = useCreateFeedback();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const form = useForm<FeedbackFormValues>({\n    resolver: zodResolver(feedbackFormSchema),\n    defaultValues: {\n      type: \"saran\",\n      content: \"\",\n    },\n  });\n\n  const onSubmit = async (data: FeedbackFormValues) => {\n    setIsSubmitting(true);\n    try {\n      await createFeedback.mutateAsync({\n        type: data.type,\n        content: data.content,\n      });\n      form.reset();\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  // Sort feedback by newest first\n  const sortedFeedback = feedbackList\n    ? [...feedbackList].sort((a, b) => {\n        return new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime();\n      })\n    : [];\n\n  // Filter feedback based on user role\n  const visibleFeedback = isAdmin\n    ? sortedFeedback\n    : sortedFeedback.filter((fb) => fb.userId === user?.id);\n\n  return (\n    <div className=\"space-y-8 animate-enter\">\n      <div>\n        <h1 className=\"text-3xl font-display font-bold text-foreground flex items-center gap-3\">\n          <MessageSquare className=\"w-8 h-8 text-primary\" />\n          Kritik & Saran\n        </h1>\n        <p className=\"text-muted-foreground mt-2\">Bagikan feedback dan saran Anda untuk tim.</p>\n      </div>\n\n      {/* Feedback Form */}\n      <Card className=\"p-6 bg-card border border-border\">\n        <h2 className=\"text-lg font-semibold text-foreground mb-4\">Tulis Kritik atau Saran</h2>\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            <FormField\n              control={form.control}\n              name=\"type\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Tipe Feedback</FormLabel>\n                  <FormControl>\n                    <Select value={field.value} onValueChange={field.onChange}>\n                      <SelectTrigger className=\"w-full\" data-testid=\"select-feedback-type\">\n                        <SelectValue placeholder=\"Pilih tipe feedback\" />\n                      </SelectTrigger>\n                      <SelectContent className=\"bg-card border border-border\">\n                        <SelectItem value=\"kritik\" data-testid=\"option-kritik\">\n                          Kritik\n                        </SelectItem>\n                        <SelectItem value=\"saran\" data-testid=\"option-saran\">\n                          Saran\n                        </SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"content\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Isi Feedback</FormLabel>\n                  <FormControl>\n                    <Textarea\n                      placeholder=\"Tulis kritik atau saran Anda...\"\n                      {...field}\n                      className=\"min-h-[120px]\"\n                      data-testid=\"input-feedback-content\"\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"flex justify-end\">\n              <Button\n                type=\"submit\"\n                disabled={isSubmitting || createFeedback.isPending}\n                data-testid=\"button-submit-feedback\"\n              >\n                {isSubmitting || createFeedback.isPending ? (\n                  <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                ) : (\n                  <Send className=\"w-4 h-4 mr-2\" />\n                )}\n                Kirim\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </Card>\n\n      {/* Feedback List */}\n      {isLoading ? (\n        <div className=\"flex justify-center py-12\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n        </div>\n      ) : visibleFeedback.length === 0 ? (\n        <div className=\"text-center py-16\">\n          <MessageSquare className=\"w-16 h-16 mx-auto text-muted-foreground/30 mb-4\" />\n          <h3 className=\"text-lg font-semibold text-foreground\">\n            {isAdmin ? \"Belum ada feedback\" : \"Anda belum membuat feedback\"}\n          </h3>\n          <p className=\"text-muted-foreground mt-1\">\n            {isAdmin\n              ? \"Feedback dari tim akan muncul di sini.\"\n              : \"Mulai bagikan feedback Anda untuk tim.\"}\n          </p>\n        </div>\n      ) : (\n        <div className=\"space-y-4\">\n          {visibleFeedback.map((feedback) => (\n            <FeedbackCard\n              key={feedback.id}\n              feedback={feedback}\n              canDelete={isAdmin || feedback.userId === user?.id}\n            />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction FeedbackCard({\n  feedback,\n  canDelete,\n}: {\n  feedback: {\n    id: number;\n    userId: string;\n    userName: string | null;\n    type: \"kritik\" | \"saran\";\n    content: string;\n    createdAt: string;\n  };\n  canDelete: boolean;\n}) {\n  const deleteId = feedback.id;\n  const deleteTypeName = feedback.type === \"kritik\" ? \"kritik\" : \"saran\";\n\n  return (\n    <Card className=\"p-6 hover-elevate\" data-testid={`card-feedback-${feedback.id}`}>\n      <div className=\"flex items-start justify-between gap-3 mb-3\">\n        <div className=\"flex items-center gap-3 flex-1\">\n          <Badge\n            variant={feedback.type === \"kritik\" ? \"destructive\" : \"default\"}\n            className={feedback.type === \"saran\" ? \"bg-blue-500 hover:bg-blue-600\" : \"\"}\n            data-testid={`badge-${feedback.type}-${feedback.id}`}\n          >\n            {feedback.type === \"kritik\" ? \"Kritik\" : \"Saran\"}\n          </Badge>\n          <span className=\"text-sm text-muted-foreground\">\n            oleh {feedback.userName || \"Pengguna\"}\n          </span>\n        </div>\n        {canDelete && (\n          <DeleteFeedbackButton id={deleteId} type={deleteTypeName} />\n        )}\n      </div>\n\n      <p className=\"text-foreground whitespace-pre-wrap break-words mb-4\">{feedback.content}</p>\n\n      <div className=\"text-sm text-muted-foreground border-t border-border/50 pt-3\">\n        {format(new Date(feedback.createdAt), \"dd MMM yyyy HH:mm\")}\n      </div>\n    </Card>\n  );\n}\n\nfunction DeleteFeedbackButton({ id, type }: { id: number; type: string }) {\n  const deleteFeedback = useDeleteFeedback();\n\n  return (\n    <AlertDialog>\n      <AlertDialogTrigger asChild>\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          className=\"text-muted-foreground\"\n          data-testid={`button-delete-feedback-${id}`}\n        >\n          <Trash2 className=\"w-4 h-4\" />\n        </Button>\n      </AlertDialogTrigger>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle>Hapus Feedback?</AlertDialogTitle>\n          <AlertDialogDescription>\n            Apakah Anda yakin ingin menghapus {type} ini? Tindakan ini tidak dapat dibatalkan.\n          </AlertDialogDescription>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel>Batal</AlertDialogCancel>\n          <AlertDialogAction\n            className=\"bg-destructive\"\n            onClick={() => deleteFeedback.mutate(id)}\n            data-testid=\"button-confirm-delete-feedback\"\n          >\n            Hapus\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n","path":null,"size_bytes":9141,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"/{*path}\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":554,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/hooks/use-announcements.ts":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { api, buildUrl } from \"@shared/routes\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport function useAnnouncements() {\n  return useQuery({\n    queryKey: [api.announcements.list.path],\n    queryFn: async () => {\n      const res = await fetch(api.announcements.list.path, { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch announcements\");\n      return res.json();\n    },\n  });\n}\n\nexport function useCreateAnnouncement() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async (data: { title: string; content: string; expiresAt?: string }) => {\n      const res = await apiRequest(\"POST\", api.announcements.create.path, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [api.announcements.list.path] });\n      toast({ title: \"Announcement Created\", description: \"New announcement has been published.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n\nexport function useUpdateAnnouncement() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async ({ id, ...data }: { id: number; title?: string; content?: string; expiresAt?: string; imageUrl?: string | null }) => {\n      const url = buildUrl(api.announcements.update.path, { id });\n      const res = await apiRequest(\"PUT\", url, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [api.announcements.list.path] });\n      toast({ title: \"Announcement Updated\", description: \"Announcement has been updated.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n\nexport function useUploadAnnouncementImage() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async ({ id, file }: { id: number; file: File }) => {\n      const url = buildUrl(api.announcements.uploadImage.path, { id });\n      const formData = new FormData();\n      formData.append(\"image\", file);\n      const res = await fetch(url, { method: \"POST\", body: formData, credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to upload image\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [api.announcements.list.path] });\n      toast({ title: \"Gambar Diunggah\", description: \"Gambar pengumuman berhasil diunggah.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n\nexport function useDeleteAnnouncement() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async (id: number) => {\n      const url = buildUrl(api.announcements.delete.path, { id });\n      await apiRequest(\"DELETE\", url);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [api.announcements.list.path] });\n      toast({ title: \"Announcement Deleted\", description: \"Announcement has been removed.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n","path":null,"size_bytes":3507,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"/{*path}\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1541,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/components/BatchPhotoUpload.tsx":{"content":"import { useState, useRef, useCallback, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Camera, X, Upload, Loader2, RotateCcw, Image as ImageIcon } from \"lucide-react\";\nimport { compressImage } from \"@/lib/utils\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface CapturedPhoto {\n  id: string;\n  blob: Blob;\n  previewUrl: string;\n}\n\ninterface BatchPhotoUploadProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onUpload: (files: File[]) => Promise<void>;\n  title?: string;\n}\n\nexport function BatchPhotoUpload({ open, onOpenChange, onUpload, title = \"Ambil Foto\" }: BatchPhotoUploadProps) {\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const streamRef = useRef<MediaStream | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const mountedRef = useRef(true);\n  const flashTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n  const { toast } = useToast();\n\n  const [photos, setPhotos] = useState<CapturedPhoto[]>([]);\n  const [cameraActive, setCameraActive] = useState(false);\n  const [cameraError, setCameraError] = useState<string | null>(null);\n  const [isUploading, setIsUploading] = useState(false);\n  const [facingMode, setFacingMode] = useState<\"environment\" | \"user\">(\"environment\");\n  const facingModeRef = useRef(facingMode);\n  facingModeRef.current = facingMode;\n  const [flashEffect, setFlashEffect] = useState(false);\n\n  useEffect(() => {\n    mountedRef.current = true;\n    return () => { mountedRef.current = false; };\n  }, []);\n\n  const stopCamera = useCallback(() => {\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(t => t.stop());\n      streamRef.current = null;\n    }\n    if (videoRef.current) {\n      videoRef.current.srcObject = null;\n    }\n    setCameraActive(false);\n  }, []);\n\n  const startCamera = useCallback(async (facing: \"environment\" | \"user\") => {\n    setCameraError(null);\n    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n      setCameraError(\"Browser tidak mendukung kamera. Gunakan browser Chrome atau Safari terbaru.\");\n      setCameraActive(false);\n      return;\n    }\n    try {\n      if (streamRef.current) {\n        streamRef.current.getTracks().forEach(t => t.stop());\n      }\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: { facingMode: facing, width: { ideal: 1280 }, height: { ideal: 960 } },\n        audio: false,\n      });\n      if (!mountedRef.current) {\n        stream.getTracks().forEach(t => t.stop());\n        return;\n      }\n      streamRef.current = stream;\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n        await videoRef.current.play();\n      }\n      setCameraActive(true);\n    } catch (err: any) {\n      if (!mountedRef.current) return;\n      if (err.name === \"NotAllowedError\") {\n        setCameraError(\"Izin kamera ditolak. Buka pengaturan browser dan izinkan akses kamera.\");\n      } else if (err.name === \"NotFoundError\") {\n        setCameraError(\"Kamera tidak ditemukan pada perangkat ini.\");\n      } else {\n        setCameraError(\"Tidak dapat mengakses kamera. Pastikan izin kamera sudah diberikan.\");\n      }\n      setCameraActive(false);\n    }\n  }, []);\n\n  const capturePhoto = useCallback(() => {\n    if (!videoRef.current || !canvasRef.current) return;\n    const video = videoRef.current;\n    const canvas = canvasRef.current;\n    canvas.width = video.videoWidth;\n    canvas.height = video.videoHeight;\n    const ctx = canvas.getContext(\"2d\");\n    if (!ctx) return;\n\n    if (facingMode === \"user\") {\n      ctx.translate(canvas.width, 0);\n      ctx.scale(-1, 1);\n    }\n    ctx.drawImage(video, 0, 0);\n\n    setFlashEffect(true);\n    if (flashTimerRef.current) clearTimeout(flashTimerRef.current);\n    flashTimerRef.current = setTimeout(() => {\n      if (mountedRef.current) setFlashEffect(false);\n    }, 150);\n\n    canvas.toBlob((blob) => {\n      if (!blob || !mountedRef.current) return;\n      const id = crypto.randomUUID();\n      const previewUrl = URL.createObjectURL(blob);\n      setPhotos(prev => [...prev, { id, blob, previewUrl }]);\n    }, \"image/jpeg\", 0.85);\n  }, [facingMode]);\n\n  const removePhoto = useCallback((id: string) => {\n    setPhotos(prev => {\n      const photo = prev.find(p => p.id === id);\n      if (photo) URL.revokeObjectURL(photo.previewUrl);\n      return prev.filter(p => p.id !== id);\n    });\n  }, []);\n\n  const switchCamera = useCallback(() => {\n    setFacingMode(prev => {\n      const newFacing = prev === \"environment\" ? \"user\" : \"environment\";\n      startCamera(newFacing);\n      return newFacing;\n    });\n  }, [startCamera]);\n\n  const handleGallerySelect = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files;\n    if (!files) return;\n    Array.from(files).forEach(file => {\n      const id = crypto.randomUUID();\n      const previewUrl = URL.createObjectURL(file);\n      setPhotos(prev => [...prev, { id, blob: file, previewUrl }]);\n    });\n    e.target.value = \"\";\n  }, []);\n\n  const handleUploadAll = useCallback(async () => {\n    if (photos.length === 0) return;\n    setIsUploading(true);\n    try {\n      const files: File[] = [];\n      for (const photo of photos) {\n        const file = new File([photo.blob], `photo_${Date.now()}_${Math.random().toString(36).slice(2)}.jpg`, {\n          type: photo.blob.type || \"image/jpeg\",\n          lastModified: Date.now(),\n        });\n        const compressed = await compressImage(file);\n        files.push(compressed);\n      }\n      photos.forEach(p => URL.revokeObjectURL(p.previewUrl));\n      setPhotos([]);\n      stopCamera();\n      onOpenChange(false);\n      onUpload(files);\n    } catch (err) {\n      if (mountedRef.current) {\n        toast({ title: \"Gagal Memproses\", description: \"Terjadi kesalahan saat memproses foto.\", variant: \"destructive\" });\n      }\n    } finally {\n      if (mountedRef.current) setIsUploading(false);\n    }\n  }, [photos, onUpload, stopCamera, onOpenChange, toast]);\n\n  useEffect(() => {\n    if (open) {\n      startCamera(facingModeRef.current);\n    } else {\n      stopCamera();\n      setPhotos(prev => {\n        prev.forEach(p => URL.revokeObjectURL(p.previewUrl));\n        return [];\n      });\n      setCameraError(null);\n      setIsUploading(false);\n    }\n  }, [open, startCamera, stopCamera]);\n\n  useEffect(() => {\n    return () => {\n      stopCamera();\n      if (flashTimerRef.current) clearTimeout(flashTimerRef.current);\n    };\n  }, [stopCamera]);\n\n  return (\n    <Dialog open={open} onOpenChange={(v) => { if (!v) { stopCamera(); } onOpenChange(v); }}>\n      <DialogContent className=\"sm:max-w-[500px] p-0 gap-0 overflow-hidden\">\n        <DialogHeader className=\"p-4 pb-2\">\n          <DialogTitle data-testid=\"text-batch-photo-title\">{title}</DialogTitle>\n        </DialogHeader>\n\n        <div className=\"relative bg-black aspect-[4/3] w-full\">\n          <video\n            ref={videoRef}\n            autoPlay\n            playsInline\n            muted\n            className={`w-full h-full object-cover ${facingMode === \"user\" ? \"scale-x-[-1]\" : \"\"}`}\n            data-testid=\"video-camera-preview\"\n          />\n          <canvas ref={canvasRef} className=\"hidden\" />\n\n          {flashEffect && (\n            <div className=\"absolute inset-0 bg-white z-10 animate-pulse\" />\n          )}\n\n          {cameraError && (\n            <div className=\"absolute inset-0 flex flex-col items-center justify-center bg-muted/90 text-muted-foreground p-4 text-center gap-3\">\n              <Camera className=\"w-10 h-10 opacity-50\" />\n              <p className=\"text-sm\">{cameraError}</p>\n              <div className=\"flex gap-2 flex-wrap justify-center\">\n                <Button variant=\"outline\" onClick={() => startCamera(facingMode)} data-testid=\"button-retry-camera\">\n                  <RotateCcw className=\"w-4 h-4 mr-2\" />\n                  Coba Lagi\n                </Button>\n                <Button variant=\"outline\" onClick={() => fileInputRef.current?.click()} data-testid=\"button-gallery-fallback\">\n                  <ImageIcon className=\"w-4 h-4 mr-2\" />\n                  Pilih dari Galeri\n                </Button>\n              </div>\n            </div>\n          )}\n\n          {!cameraActive && !cameraError && (\n            <div className=\"absolute inset-0 flex items-center justify-center bg-muted/90\">\n              <Loader2 className=\"w-8 h-8 animate-spin text-muted-foreground\" />\n            </div>\n          )}\n\n          {cameraActive && (\n            <div className=\"absolute bottom-3 left-0 right-0 flex items-center justify-center gap-4\">\n              <Button\n                variant=\"outline\"\n                size=\"icon\"\n                className=\"rounded-full bg-background/60 backdrop-blur-sm border-background/30\"\n                onClick={() => fileInputRef.current?.click()}\n                data-testid=\"button-batch-gallery\"\n              >\n                <ImageIcon className=\"w-5 h-5\" />\n              </Button>\n\n              <button\n                onClick={capturePhoto}\n                className=\"w-14 h-14 rounded-full border-4 border-white bg-white/20 backdrop-blur-sm active:scale-90 transition-transform flex items-center justify-center\"\n                data-testid=\"button-capture-photo\"\n              >\n                <div className=\"w-11 h-11 rounded-full bg-white\" />\n              </button>\n\n              <Button\n                variant=\"outline\"\n                size=\"icon\"\n                className=\"rounded-full bg-background/60 backdrop-blur-sm border-background/30\"\n                onClick={switchCamera}\n                data-testid=\"button-switch-camera\"\n              >\n                <RotateCcw className=\"w-5 h-5\" />\n              </Button>\n            </div>\n          )}\n\n          {photos.length > 0 && (\n            <div className=\"absolute top-3 right-3 bg-primary text-primary-foreground rounded-full w-7 h-7 flex items-center justify-center text-sm font-bold\" data-testid=\"text-photo-count\">\n              {photos.length}\n            </div>\n          )}\n        </div>\n\n        {photos.length > 0 && (\n          <div className=\"p-3 border-t border-border\">\n            <div className=\"flex gap-2 overflow-x-auto pb-1\">\n              {photos.map((photo, idx) => (\n                <div key={photo.id} className=\"relative flex-shrink-0 w-16 h-16 group\" data-testid={`preview-photo-${idx}`}>\n                  <img\n                    src={photo.previewUrl}\n                    alt={`Foto ${idx + 1}`}\n                    className=\"w-full h-full object-cover rounded-md border border-border/50\"\n                  />\n                  <button\n                    onClick={() => removePhoto(photo.id)}\n                    className=\"absolute -top-1.5 -right-1.5 w-5 h-5 bg-destructive text-white rounded-full flex items-center justify-center\"\n                    data-testid={`button-remove-preview-${idx}`}\n                  >\n                    <X className=\"w-3 h-3\" />\n                  </button>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        <DialogFooter className=\"p-3 pt-0 gap-2 flex-row\">\n          <Button\n            variant=\"outline\"\n            className=\"flex-1\"\n            onClick={() => { stopCamera(); onOpenChange(false); }}\n            disabled={isUploading}\n            data-testid=\"button-cancel-batch\"\n          >\n            Batal\n          </Button>\n          <Button\n            className=\"flex-1\"\n            onClick={handleUploadAll}\n            disabled={photos.length === 0 || isUploading}\n            data-testid=\"button-upload-all\"\n          >\n            {isUploading ? (\n              <>\n                <Loader2 className=\"w-4 h-4 animate-spin mr-2\" />\n                Mengupload...\n              </>\n            ) : (\n              <>\n                <Upload className=\"w-4 h-4 mr-2\" />\n                Upload {photos.length > 0 ? `(${photos.length})` : \"\"}\n              </>\n            )}\n          </Button>\n        </DialogFooter>\n\n        <input\n          ref={fileInputRef}\n          type=\"file\"\n          accept=\"image/*\"\n          multiple\n          className=\"hidden\"\n          onChange={handleGallerySelect}\n          data-testid=\"input-batch-gallery\"\n        />\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":12447,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/pages/Products.tsx":{"content":"import { useState, useRef, useEffect, useCallback } from \"react\";\nimport {\n  useProducts,\n  useCreateProduct,\n  useUpdateProduct,\n  useDeleteProduct,\n  useBulkDeleteProducts,\n  useCategories,\n  useImportExcel,\n  useProductPhotos,\n  useUploadProductPhoto,\n  useDeleteProductPhoto,\n  useProductUnits,\n  useCreateProductUnit,\n  useUpdateProductUnit,\n  useDeleteProductUnit,\n  useCategoryPriorities,\n  useSetCategoryPriorities,\n  type ExcelImportResult,\n} from \"@/hooks/use-products\";\nimport { BatchPhotoUpload } from \"@/components/BatchPhotoUpload\";\nimport { useBackgroundUpload } from \"@/components/BackgroundUpload\";\nimport { useRole } from \"@/hooks/use-role\";\nimport { api } from \"@shared/routes\";\nimport type { Product, ProductPhoto, ProductUnit } from \"@shared/schema\";\nimport { insertProductSchema } from \"@shared/schema\";\nimport {\n  Plus, Search, Trash2, Box, Loader2, Upload, ImageIcon, Filter,\n  Download, FileSpreadsheet, CheckCircle2, AlertTriangle, XCircle,\n  Pencil, Save, X, Camera, Package, Layers, Store, Warehouse,\n  ArrowUp, ArrowDown, ListOrdered, GripVertical,\n} from \"lucide-react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useForm } from \"react-hook-form\";\nimport { z } from \"zod\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport {\n  AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent,\n  AlertDialogDescription, AlertDialogFooter, AlertDialogHeader,\n  AlertDialogTitle, AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nfunction getDefaultProductTab(role: string): string {\n  if (role === \"stock_counter_toko\") return \"toko\";\n  if (role === \"stock_counter_gudang\") return \"gudang\";\n  return \"semua\";\n}\n\nexport default function Products() {\n  const { canManageSku, isAdmin, canCountToko, canCountGudang, role } = useRole();\n  const defaultTab = getDefaultProductTab(role);\n  const [locationType, setLocationType] = useState<string>(defaultTab);\n  const queryLocationType = locationType === \"semua\" ? undefined : locationType;\n  const { data: products, isLoading } = useProducts(queryLocationType);\n  const { data: categories } = useCategories();\n  const { data: categoryPriorities } = useCategoryPriorities();\n  const showAllTabs = role === \"admin\" || role === \"sku_manager\" || role === \"stock_counter\";\n  const [search, setSearch] = useState(\"\");\n  const [categoryFilter, setCategoryFilter] = useState<string>(\"all\");\n  const [isCreateOpen, setIsCreateOpen] = useState(false);\n  const [editingId, setEditingId] = useState<number | null>(null);\n  const [importResult, setImportResult] = useState<ExcelImportResult | null>(null);\n  const [isImportResultOpen, setIsImportResultOpen] = useState(false);\n  const [photosProductId, setPhotosProductId] = useState<number | null>(null);\n  const [unitsProductId, setUnitsProductId] = useState<number | null>(null);\n  const [selectedIds, setSelectedIds] = useState<number[]>([]);\n  const [bulkDeleteOpen, setBulkDeleteOpen] = useState(false);\n  const [categoryPriorityOpen, setCategoryPriorityOpen] = useState(false);\n  const importExcel = useImportExcel();\n  const bulkDelete = useBulkDeleteProducts();\n  const excelInputRef = useRef<HTMLInputElement>(null);\n\n  const handleExcelUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      importExcel.mutate(file, {\n        onSuccess: (result) => {\n          setImportResult(result);\n          setIsImportResultOpen(true);\n        },\n      });\n      e.target.value = \"\";\n    }\n  };\n\n  const filteredProducts = products?.filter((p) => {\n    const matchesSearch =\n      p.name.toLowerCase().includes(search.toLowerCase()) ||\n      p.sku.toLowerCase().includes(search.toLowerCase());\n    const matchesCategory = categoryFilter === \"all\" || p.category === categoryFilter;\n    return matchesSearch && matchesCategory;\n  })?.sort((a, b) => {\n    if (!categoryPriorities || categoryPriorities.length === 0) return 0;\n    const priorityMap = new Map(categoryPriorities.map(p => [p.categoryName, p.sortOrder]));\n    const aPriority = priorityMap.get(a.category || \"\") ?? 999;\n    const bPriority = priorityMap.get(b.category || \"\") ?? 999;\n    if (aPriority !== bPriority) return aPriority - bPriority;\n    return 0;\n  });\n\n  return (\n    <div className=\"space-y-6 animate-enter\">\n      <div className=\"flex flex-col gap-4\">\n        <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\n          <div>\n            <h1 className=\"text-3xl font-display font-bold text-foreground\">Produk</h1>\n            <p className=\"text-muted-foreground mt-1\">Kelola katalog inventaris dan stok.</p>\n          </div>\n          <div className=\"flex items-center gap-3 flex-wrap\">\n            {canManageSku && selectedIds.length > 0 && (\n              <AlertDialog open={bulkDeleteOpen} onOpenChange={setBulkDeleteOpen}>\n                <AlertDialogTrigger asChild>\n                  <Button variant=\"destructive\" data-testid=\"button-bulk-delete\">\n                    <Trash2 className=\"w-4 h-4 mr-2\" />\n                    Hapus {selectedIds.length} Produk\n                  </Button>\n                </AlertDialogTrigger>\n                <AlertDialogContent>\n                  <AlertDialogHeader>\n                    <AlertDialogTitle>Hapus {selectedIds.length} Produk?</AlertDialogTitle>\n                    <AlertDialogDescription>\n                      Tindakan ini tidak dapat dibatalkan. Semua data produk yang dipilih akan dihapus permanen.\n                    </AlertDialogDescription>\n                  </AlertDialogHeader>\n                  <AlertDialogFooter>\n                    <AlertDialogCancel data-testid=\"button-cancel-bulk-delete\">Batal</AlertDialogCancel>\n                    <AlertDialogAction\n                      onClick={() => {\n                        bulkDelete.mutate(selectedIds, {\n                          onSuccess: () => {\n                            setSelectedIds([]);\n                            setBulkDeleteOpen(false);\n                          },\n                        });\n                      }}\n                      className=\"bg-destructive text-destructive-foreground\"\n                      data-testid=\"button-confirm-bulk-delete\"\n                    >\n                      {bulkDelete.isPending ? <Loader2 className=\"w-4 h-4 animate-spin mr-2\" /> : null}\n                      Hapus\n                    </AlertDialogAction>\n                  </AlertDialogFooter>\n                </AlertDialogContent>\n              </AlertDialog>\n            )}\n            {canManageSku && (\n              <>\n                <Button\n                  variant=\"outline\"\n                  onClick={() => window.open(api.excel.template.path, \"_blank\")}\n                  data-testid=\"button-download-template\"\n                >\n                  <Download className=\"w-4 h-4 mr-2\" />\n                  Template\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  onClick={() => excelInputRef.current?.click()}\n                  disabled={importExcel.isPending}\n                  data-testid=\"button-import-excel\"\n                >\n                  {importExcel.isPending ? (\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                  ) : (\n                    <FileSpreadsheet className=\"w-4 h-4 mr-2\" />\n                  )}\n                  Import Excel\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  onClick={() => window.open(api.excel.export.path, \"_blank\")}\n                  data-testid=\"button-export-excel\"\n                >\n                  <Download className=\"w-4 h-4 mr-2\" />\n                  Export Excel\n                </Button>\n                <input\n                  ref={excelInputRef}\n                  type=\"file\"\n                  accept=\".xlsx,.xls\"\n                  className=\"hidden\"\n                  onChange={handleExcelUpload}\n                  data-testid=\"input-excel-file\"\n                />\n                <CreateProductDialog open={isCreateOpen} onOpenChange={setIsCreateOpen} />\n              </>\n            )}\n          </div>\n        </div>\n\n        <div className=\"flex flex-col md:flex-row md:items-center gap-3\">\n          <Tabs value={locationType} onValueChange={setLocationType} data-testid=\"tabs-location-type\">\n            <TabsList>\n              {showAllTabs && (\n                <TabsTrigger value=\"semua\" data-testid=\"tab-semua\">\n                  <Package className=\"w-4 h-4 mr-1.5\" />\n                  Semua\n                </TabsTrigger>\n              )}\n              {canCountToko && (\n                <TabsTrigger value=\"toko\" data-testid=\"tab-toko\">\n                  <Store className=\"w-4 h-4 mr-1.5\" />\n                  Toko\n                </TabsTrigger>\n              )}\n              {canCountGudang && (\n                <TabsTrigger value=\"gudang\" data-testid=\"tab-gudang\">\n                  <Warehouse className=\"w-4 h-4 mr-1.5\" />\n                  Gudang\n                </TabsTrigger>\n              )}\n            </TabsList>\n          </Tabs>\n\n          <div className=\"flex items-center gap-3 flex-wrap flex-1\">\n            <div className=\"relative flex-1 min-w-[200px] max-w-xs\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"Cari SKU atau Nama...\"\n                className=\"pl-9\"\n                value={search}\n                onChange={(e) => setSearch(e.target.value)}\n                data-testid=\"input-search-products\"\n              />\n            </div>\n            <Select value={categoryFilter} onValueChange={setCategoryFilter}>\n              <SelectTrigger className=\"w-40\" data-testid=\"select-category-filter\">\n                <Filter className=\"w-4 h-4 mr-2 text-muted-foreground\" />\n                <SelectValue placeholder=\"Semua Kategori\" />\n              </SelectTrigger>\n              <SelectContent className=\"bg-card border border-border\">\n                <SelectItem value=\"all\">Semua Kategori</SelectItem>\n                {categories?.map((cat) => (\n                  <SelectItem key={cat} value={cat}>{cat}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n            <Button variant=\"outline\" size=\"sm\" onClick={() => setCategoryPriorityOpen(true)} data-testid=\"button-category-priority\">\n              <ListOrdered className=\"w-4 h-4 mr-2\" />\n              Urutan Kategori\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      <ImportResultDialog\n        result={importResult}\n        open={isImportResultOpen}\n        onOpenChange={setIsImportResultOpen}\n      />\n\n      <PhotoGalleryDialog\n        productId={photosProductId}\n        open={photosProductId !== null}\n        onOpenChange={(open) => { if (!open) setPhotosProductId(null); }}\n        canManage={canManageSku}\n      />\n\n      <UnitManagementDialog\n        productId={unitsProductId}\n        open={unitsProductId !== null}\n        onOpenChange={(open) => { if (!open) setUnitsProductId(null); }}\n      />\n\n      <CategoryPriorityDialog\n        open={categoryPriorityOpen}\n        onOpenChange={setCategoryPriorityOpen}\n        categories={categories ?? []}\n      />\n\n      <div className=\"bg-card border border-border rounded-md overflow-hidden\">\n        {isLoading ? (\n          <div className=\"p-12 flex justify-center\">\n            <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n          </div>\n        ) : filteredProducts?.length === 0 ? (\n          <div className=\"p-16 text-center\">\n            <Box className=\"w-16 h-16 mx-auto text-muted-foreground/30 mb-4\" />\n            <h3 className=\"text-lg font-semibold text-foreground\">Tidak Ada Produk</h3>\n            <p className=\"text-muted-foreground mt-1\">Coba ubah pencarian atau tambah produk baru.</p>\n          </div>\n        ) : (\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full text-left text-sm\">\n              <thead>\n                <tr className=\"bg-muted/30 border-b border-border/50\">\n                  {canManageSku && (\n                    <th className=\"px-4 py-3 w-10\">\n                      <input\n                        type=\"checkbox\"\n                        checked={filteredProducts ? filteredProducts.length > 0 && selectedIds.length === filteredProducts.length : false}\n                        onChange={() => {\n                          if (!filteredProducts) return;\n                          if (selectedIds.length === filteredProducts.length) {\n                            setSelectedIds([]);\n                          } else {\n                            setSelectedIds(filteredProducts.map(p => p.id));\n                          }\n                        }}\n                        className=\"rounded\"\n                        data-testid=\"checkbox-select-all\"\n                      />\n                    </th>\n                  )}\n                  <th className=\"px-4 py-3 font-medium text-muted-foreground\">Foto</th>\n                  <th className=\"px-4 py-3 font-medium text-muted-foreground\">SKU</th>\n                  <th className=\"px-4 py-3 font-medium text-muted-foreground\">Nama Produk</th>\n                  <th className=\"px-4 py-3 font-medium text-muted-foreground\">Kategori</th>\n                  <th className=\"px-4 py-3 font-medium text-muted-foreground\">Lokasi</th>\n                  <th className=\"px-4 py-3 font-medium text-muted-foreground text-right\">Stok</th>\n                  {canManageSku && (\n                    <th className=\"px-4 py-3 font-medium text-muted-foreground text-right\">Aksi</th>\n                  )}\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-border/50\">\n                {filteredProducts?.map((product) =>\n                  editingId === product.id ? (\n                    <EditProductRow\n                      key={product.id}\n                      product={product}\n                      onCancel={() => setEditingId(null)}\n                      onSaved={() => setEditingId(null)}\n                    />\n                  ) : (\n                    <ProductRow\n                      key={product.id}\n                      product={product}\n                      canManageSku={canManageSku}\n                      selected={selectedIds.includes(product.id)}\n                      onToggleSelect={() => {\n                        setSelectedIds(prev =>\n                          prev.includes(product.id) ? prev.filter(id => id !== product.id) : [...prev, product.id]\n                        );\n                      }}\n                      onEdit={() => setEditingId(product.id)}\n                      onPhotos={() => setPhotosProductId(product.id)}\n                      onUnits={() => setUnitsProductId(product.id)}\n                    />\n                  )\n                )}\n              </tbody>\n            </table>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction ProductRow({\n  product,\n  canManageSku,\n  selected,\n  onToggleSelect,\n  onEdit,\n  onPhotos,\n  onUnits,\n}: {\n  product: Product;\n  canManageSku: boolean;\n  selected: boolean;\n  onToggleSelect: () => void;\n  onEdit: () => void;\n  onPhotos: () => void;\n  onUnits: () => void;\n}) {\n  const { data: photos } = useProductPhotos(product.id);\n  const { data: units } = useProductUnits(product.id);\n  const photoCount = photos?.length ?? 0;\n  const firstPhoto = photos?.[0];\n  const hasUnits = units && units.length > 0;\n\n  return (\n    <tr className=\"hover:bg-muted/20 transition-colors group\" data-testid={`row-product-${product.id}`}>\n      {canManageSku && (\n        <td className=\"px-4 py-3\">\n          <input\n            type=\"checkbox\"\n            checked={selected}\n            onChange={onToggleSelect}\n            className=\"rounded\"\n            data-testid={`checkbox-product-${product.id}`}\n          />\n        </td>\n      )}\n      <td className=\"px-4 py-3\">\n        <button\n          onClick={onPhotos}\n          className=\"relative w-10 h-10 rounded-md overflow-hidden border border-border/50 flex items-center justify-center bg-muted/30\"\n          data-testid={`button-photos-${product.id}`}\n        >\n          {firstPhoto ? (\n            <img\n              src={firstPhoto.url}\n              alt=\"\"\n              className=\"w-10 h-10 object-cover\"\n              onError={(e) => {\n                e.currentTarget.style.display = \"none\";\n              }}\n            />\n          ) : product.photoUrl ? (\n            <img\n              src={product.photoUrl}\n              alt=\"\"\n              className=\"w-10 h-10 object-cover\"\n              onError={(e) => {\n                e.currentTarget.style.display = \"none\";\n              }}\n            />\n          ) : (\n            <ImageIcon className=\"w-4 h-4 text-muted-foreground/40\" />\n          )}\n          {photoCount > 0 && (\n            <Badge className=\"absolute -top-1.5 -right-1.5 no-default-hover-elevate no-default-active-elevate\" variant=\"secondary\">\n              {photoCount}\n            </Badge>\n          )}\n        </button>\n      </td>\n      <td className=\"px-4 py-3 font-mono font-medium text-foreground\">\n        <div className=\"flex flex-col gap-1\">\n          <span>{product.locationType === \"gudang\" && product.productCode ? product.productCode : product.sku}</span>\n        </div>\n      </td>\n      <td className=\"px-4 py-3\">\n        <div className=\"flex flex-col gap-1\">\n          <span className=\"font-medium text-foreground\">{product.name}</span>\n          {product.locationType === \"gudang\" && product.subCategory && (\n            <span className=\"text-xs text-muted-foreground\">\n              {product.subCategory}\n            </span>\n          )}\n          {hasUnits && (\n            <span className=\"text-xs text-muted-foreground\">\n              {formatUnitDisplay(units)}\n            </span>\n          )}\n        </div>\n      </td>\n      <td className=\"px-4 py-3 text-muted-foreground\">{product.category || \"-\"}</td>\n      <td className=\"px-4 py-3\">\n        <Badge variant={product.locationType === \"gudang\" ? \"outline\" : \"secondary\"} data-testid={`badge-location-${product.id}`}>\n          {product.locationType === \"gudang\" ? (\n            <><Warehouse className=\"w-3 h-3 mr-1\" />Gudang</>\n          ) : (\n            <><Store className=\"w-3 h-3 mr-1\" />Toko</>\n          )}\n        </Badge>\n      </td>\n      <td className=\"px-4 py-3 text-right\">\n        <span className={product.currentStock < 10 ? \"text-orange-600 font-bold\" : \"text-foreground\"}>\n          {product.currentStock}\n        </span>\n      </td>\n      {canManageSku && (\n        <td className=\"px-4 py-3 text-right\">\n          <div className=\"flex items-center justify-end gap-1\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"text-muted-foreground\"\n              onClick={onUnits}\n              data-testid={`button-units-${product.id}`}\n            >\n              <Layers className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"text-muted-foreground\"\n              onClick={onPhotos}\n              data-testid={`button-manage-photos-${product.id}`}\n            >\n              <Camera className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"text-muted-foreground\"\n              onClick={onEdit}\n              data-testid={`button-edit-product-${product.id}`}\n            >\n              <Pencil className=\"w-4 h-4\" />\n            </Button>\n            <DeleteProductButton id={product.id} name={product.name} />\n          </div>\n        </td>\n      )}\n    </tr>\n  );\n}\n\nfunction formatUnitDisplay(units: ProductUnit[]): string {\n  if (!units || units.length === 0) return \"\";\n  const sorted = [...units].sort((a, b) => a.sortOrder - b.sortOrder);\n  return sorted.map(u => u.unitName).join(\", \");\n}\n\nfunction EditProductRow({ product, onCancel, onSaved }: { product: Product; onCancel: () => void; onSaved: () => void }) {\n  const [name, setName] = useState(product.name);\n  const [currentStock, setCurrentStock] = useState(product.currentStock);\n  const updateProduct = useUpdateProduct();\n\n  const handleSave = () => {\n    updateProduct.mutate(\n      { id: product.id, name, currentStock },\n      { onSuccess: onSaved }\n    );\n  };\n\n  return (\n    <tr className=\"bg-primary/5\" data-testid={`row-edit-product-${product.id}`}>\n      <td className=\"px-4 py-3\"></td>\n      <td className=\"px-4 py-3\">\n        <div className=\"w-10 h-10 rounded-md bg-muted/50 flex items-center justify-center\">\n          <ImageIcon className=\"w-4 h-4 text-muted-foreground/40\" />\n        </div>\n      </td>\n      <td className=\"px-4 py-3 font-mono font-medium text-foreground\">{product.sku}</td>\n      <td className=\"px-4 py-3\">\n        <Input\n          value={name}\n          onChange={(e) => setName(e.target.value)}\n          data-testid={`input-edit-name-${product.id}`}\n        />\n      </td>\n      <td className=\"px-4 py-3 text-muted-foreground\">{product.category || \"-\"}</td>\n      <td className=\"px-4 py-3\">\n        <Badge variant={product.locationType === \"gudang\" ? \"outline\" : \"secondary\"}>\n          {product.locationType === \"gudang\" ? \"Gudang\" : \"Toko\"}\n        </Badge>\n      </td>\n      <td className=\"px-4 py-3 text-right\">\n        <Input\n          type=\"number\"\n          value={currentStock}\n          onChange={(e) => setCurrentStock(parseInt(e.target.value) || 0)}\n          className=\"w-24 ml-auto text-right\"\n          data-testid={`input-edit-stock-${product.id}`}\n        />\n      </td>\n      <td className=\"px-4 py-3 text-right\">\n        <div className=\"flex items-center justify-end gap-1\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={handleSave}\n            disabled={updateProduct.isPending}\n            data-testid={`button-save-edit-${product.id}`}\n          >\n            {updateProduct.isPending ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <Save className=\"w-4 h-4 text-green-600\" />}\n          </Button>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={onCancel}\n            data-testid={`button-cancel-edit-${product.id}`}\n          >\n            <X className=\"w-4 h-4 text-muted-foreground\" />\n          </Button>\n        </div>\n      </td>\n    </tr>\n  );\n}\n\nconst createFormSchema = insertProductSchema.omit({ userId: true, photoUrl: true });\n\nfunction CreateProductDialog({ open, onOpenChange }: { open: boolean; onOpenChange: (open: boolean) => void }) {\n  const createProduct = useCreateProduct();\n  const uploadPhoto = useUploadProductPhoto();\n  const { toast } = useToast();\n  const [selectedFiles, setSelectedFiles] = useState<File[]>([]);\n  const [previews, setPreviews] = useState<string[]>([]);\n  const [isUploading, setIsUploading] = useState(false);\n  const photoInputRef = useRef<HTMLInputElement>(null);\n  const cameraInputRef = useRef<HTMLInputElement>(null);\n\n  const form = useForm<z.infer<typeof createFormSchema>>({\n    resolver: zodResolver(createFormSchema),\n    defaultValues: {\n      sku: \"\",\n      name: \"\",\n      category: \"\",\n      description: \"\",\n      currentStock: 0,\n      locationType: \"toko\",\n      subCategory: \"\",\n      productCode: \"\",\n    },\n  });\n\n  const locationTypeValue = form.watch(\"locationType\");\n\n  const handleSelectPhotos = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files;\n    if (!files) return;\n    const newFiles = Array.from(files);\n    setSelectedFiles((prev) => [...prev, ...newFiles]);\n    newFiles.forEach((file) => {\n      const reader = new FileReader();\n      reader.onload = (ev) => {\n        setPreviews((prev) => [...prev, ev.target?.result as string]);\n      };\n      reader.readAsDataURL(file);\n    });\n    e.target.value = \"\";\n  };\n\n  const removeFile = (index: number) => {\n    setSelectedFiles((prev) => prev.filter((_, i) => i !== index));\n    setPreviews((prev) => prev.filter((_, i) => i !== index));\n  };\n\n  const resetForm = () => {\n    form.reset();\n    setSelectedFiles([]);\n    setPreviews([]);\n    setIsUploading(false);\n  };\n\n  const onSubmit = async (data: z.infer<typeof createFormSchema>) => {\n    setIsUploading(true);\n    createProduct.mutate(data, {\n      onSuccess: async (newProduct: Product) => {\n        if (selectedFiles.length > 0) {\n          const { compressImage } = await import(\"@/lib/utils\");\n          let failCount = 0;\n          for (const file of selectedFiles) {\n            try {\n              const compressed = await compressImage(file);\n              await uploadPhoto.mutateAsync({ productId: newProduct.id, file: compressed });\n            } catch {\n              failCount++;\n            }\n          }\n          if (failCount > 0) {\n            toast({ title: \"Peringatan\", description: `${failCount} foto gagal diupload. Anda bisa upload ulang dari galeri produk.`, variant: \"destructive\" });\n          }\n        }\n        setIsUploading(false);\n        onOpenChange(false);\n        resetForm();\n      },\n      onError: () => {\n        setIsUploading(false);\n      },\n    });\n  };\n\n  const isBusy = createProduct.isPending || isUploading;\n\n  return (\n    <Dialog open={open} onOpenChange={(v) => { if (!v) resetForm(); onOpenChange(v); }}>\n      <DialogTrigger asChild>\n        <Button data-testid=\"button-add-product\">\n          <Plus className=\"w-4 h-4 mr-2\" />\n          Tambah Produk\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"sm:max-w-[500px]\">\n        <DialogHeader>\n          <DialogTitle>Tambah Produk Baru</DialogTitle>\n        </DialogHeader>\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4 pt-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <FormField\n                control={form.control}\n                name=\"sku\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>SKU</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Cth: ITEM-001\" {...field} data-testid=\"input-sku\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"category\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Kategori</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Elektronik\" {...field} value={field.value || \"\"} data-testid=\"input-category\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            {locationTypeValue === \"gudang\" && (\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"productCode\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Kode Produk</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Cth: ABC123\" {...field} value={field.value || \"\"} data-testid=\"input-product-code\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"subCategory\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Sub Kategori</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Cth: Snack\" {...field} value={field.value || \"\"} data-testid=\"input-sub-category\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n            )}\n\n            <FormField\n              control={form.control}\n              name=\"name\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Nama Produk</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"Headphone Wireless\" {...field} data-testid=\"input-product-name\" />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <FormField\n                control={form.control}\n                name=\"currentStock\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Stok Awal</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"number\"\n                        {...field}\n                        onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                        data-testid=\"input-initial-stock\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"locationType\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Lokasi</FormLabel>\n                    <Select onValueChange={field.onChange} defaultValue={field.value || \"toko\"}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-location-type\">\n                          <SelectValue placeholder=\"Pilih Lokasi\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent className=\"bg-card border border-border\">\n                        <SelectItem value=\"toko\">Toko</SelectItem>\n                        <SelectItem value=\"gudang\">Gudang</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            <FormField\n              control={form.control}\n              name=\"description\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Deskripsi (Opsional)</FormLabel>\n                  <FormControl>\n                    <Textarea placeholder=\"Detail tentang produk...\" {...field} value={field.value || \"\"} data-testid=\"input-description\" />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div>\n              <FormLabel>Foto Produk (Opsional)</FormLabel>\n              <div className=\"mt-2 space-y-3\">\n                {previews.length > 0 && (\n                  <div className=\"grid grid-cols-4 gap-2\">\n                    {previews.map((src, i) => (\n                      <div key={i} className=\"relative aspect-square rounded-md overflow-hidden border border-border/50 bg-muted/30 group/preview\">\n                        <img src={src} alt=\"\" className=\"w-full h-full object-cover\" />\n                        <Button\n                          type=\"button\"\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"absolute top-0.5 right-0.5 invisible group-hover/preview:visible\"\n                          onClick={() => removeFile(i)}\n                          data-testid={`button-remove-preview-${i}`}\n                        >\n                          <X className=\"w-3 h-3 text-destructive\" />\n                        </Button>\n                      </div>\n                    ))}\n                  </div>\n                )}\n                <div className=\"flex gap-2\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    className=\"flex-1\"\n                    onClick={() => cameraInputRef.current?.click()}\n                    disabled={isBusy}\n                    data-testid=\"button-camera-create\"\n                  >\n                    <Camera className=\"w-4 h-4 mr-2\" />\n                    Kamera\n                  </Button>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    className=\"flex-1\"\n                    onClick={() => photoInputRef.current?.click()}\n                    disabled={isBusy}\n                    data-testid=\"button-gallery-create\"\n                  >\n                    <ImageIcon className=\"w-4 h-4 mr-2\" />\n                    Galeri\n                  </Button>\n                </div>\n                {selectedFiles.length > 0 && (\n                  <p className=\"text-xs text-muted-foreground text-center\">{selectedFiles.length} foto dipilih</p>\n                )}\n                <input\n                  ref={photoInputRef}\n                  type=\"file\"\n                  accept=\"image/*\"\n                  multiple\n                  className=\"hidden\"\n                  onChange={handleSelectPhotos}\n                  data-testid=\"input-select-photos\"\n                />\n                <input\n                  ref={cameraInputRef}\n                  type=\"file\"\n                  accept=\"image/*\"\n                  capture=\"environment\"\n                  className=\"hidden\"\n                  onChange={handleSelectPhotos}\n                  data-testid=\"input-camera-create\"\n                />\n              </div>\n            </div>\n\n            <div className=\"flex justify-end gap-3 pt-2\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => { resetForm(); onOpenChange(false); }}>Batal</Button>\n              <Button type=\"submit\" disabled={isBusy} data-testid=\"button-submit-product\">\n                {isBusy && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n                {isUploading ? \"Mengupload foto...\" : \"Buat Produk\"}\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nfunction PhotoGalleryDialog({\n  productId,\n  open,\n  onOpenChange,\n  canManage,\n}: {\n  productId: number | null;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  canManage: boolean;\n}) {\n  const { data: photos, isLoading } = useProductPhotos(productId ?? 0);\n  const uploadPhoto = useUploadProductPhoto();\n  const deletePhoto = useDeleteProductPhoto();\n  const [viewingPhoto, setViewingPhoto] = useState<string | null>(null);\n  const [batchOpen, setBatchOpen] = useState(false);\n  const { addUploadJob } = useBackgroundUpload();\n\n  const handleBatchUpload = useCallback(async (files: File[]) => {\n    if (!productId) return;\n    const pid = productId;\n    addUploadJob(\"Foto Produk\", files, (file) => {\n      return new Promise<void>((resolve, reject) => {\n        uploadPhoto.mutate({ productId: pid, file }, { onSuccess: () => resolve(), onError: (err) => reject(err) });\n      });\n    });\n  }, [productId, uploadPhoto, addUploadJob]);\n\n  return (\n    <>\n      <Dialog open={open && !viewingPhoto && !batchOpen} onOpenChange={onOpenChange}>\n        <DialogContent className=\"sm:max-w-[600px]\">\n          <DialogHeader>\n            <DialogTitle>Foto Produk</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 pt-2\">\n            {isLoading ? (\n              <div className=\"flex justify-center p-8\">\n                <Loader2 className=\"w-6 h-6 animate-spin text-primary\" />\n              </div>\n            ) : (\n              <div className=\"grid grid-cols-3 gap-3\">\n                {photos?.map((photo: ProductPhoto) => (\n                  <div key={photo.id} className=\"relative group/photo aspect-square rounded-md overflow-hidden border border-border/50 bg-muted/30\">\n                    <img\n                      src={photo.url}\n                      alt=\"\"\n                      className=\"w-full h-full object-cover cursor-pointer\"\n                      onClick={() => setViewingPhoto(photo.url)}\n                      onError={(e) => {\n                        e.currentTarget.style.display = \"none\";\n                        const parent = e.currentTarget.parentElement;\n                        if (parent) {\n                          const placeholder = parent.querySelector(\".photo-placeholder\");\n                          if (placeholder) (placeholder as HTMLElement).style.display = \"flex\";\n                        }\n                      }}\n                      data-testid={`img-photo-${photo.id}`}\n                    />\n                    <div className=\"photo-placeholder hidden w-full h-full items-center justify-center absolute inset-0\">\n                      <ImageIcon className=\"w-8 h-8 text-muted-foreground/40\" />\n                    </div>\n                    {canManage && (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"absolute top-1 right-1 bg-background/80 opacity-0 group-hover/photo:opacity-100 transition-opacity\"\n                        onClick={() => productId && deletePhoto.mutate({ productId, photoId: photo.id })}\n                        data-testid={`button-delete-photo-${photo.id}`}\n                      >\n                        <Trash2 className=\"w-3.5 h-3.5 text-destructive\" />\n                      </Button>\n                    )}\n                  </div>\n                ))}\n                {canManage && (\n                  <div\n                    className=\"aspect-square rounded-md border border-dashed border-border flex flex-col items-center justify-center gap-2 cursor-pointer hover:bg-muted/30 transition-colors\"\n                    onClick={() => setBatchOpen(true)}\n                    data-testid=\"button-open-batch-camera\"\n                  >\n                    <Camera className=\"w-6 h-6 text-muted-foreground\" />\n                    <span className=\"text-[10px] text-muted-foreground text-center leading-tight\">Ambil / Pilih Foto</span>\n                  </div>\n                )}\n              </div>\n            )}\n            {(!photos || photos.length === 0) && !isLoading && (\n              <p className=\"text-sm text-muted-foreground text-center py-4\">Belum ada foto untuk produk ini.</p>\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <BatchPhotoUpload\n        open={batchOpen}\n        onOpenChange={setBatchOpen}\n        onUpload={handleBatchUpload}\n        title=\"Foto Produk\"\n      />\n\n      <Dialog open={!!viewingPhoto} onOpenChange={() => setViewingPhoto(null)}>\n        <DialogContent className=\"sm:max-w-[800px] p-2\">\n          {viewingPhoto && (\n            <img\n              src={viewingPhoto}\n              alt=\"\"\n              className=\"w-full h-auto max-h-[80vh] object-contain rounded-md\"\n              onError={(e) => {\n                e.currentTarget.style.display = \"none\";\n              }}\n              data-testid=\"img-photo-fullsize\"\n            />\n          )}\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}\n\nfunction UnitManagementDialog({\n  productId,\n  open,\n  onOpenChange,\n}: {\n  productId: number | null;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}) {\n  const { data: units, isLoading } = useProductUnits(productId ?? 0);\n  const createUnit = useCreateProductUnit();\n  const updateUnit = useUpdateProductUnit();\n  const deleteUnit = useDeleteProductUnit();\n  const [newUnitName, setNewUnitName] = useState(\"\");\n  const [editingUnitId, setEditingUnitId] = useState<number | null>(null);\n  const [editUnitName, setEditUnitName] = useState(\"\");\n\n  const handleAddUnit = () => {\n    if (!productId || !newUnitName.trim()) return;\n    const sortOrder = units ? units.length : 0;\n    createUnit.mutate(\n      {\n        productId,\n        unitName: newUnitName.trim(),\n        conversionToBase: 1,\n        baseUnit: newUnitName.trim(),\n        sortOrder,\n      },\n      {\n        onSuccess: () => {\n          setNewUnitName(\"\");\n        },\n      }\n    );\n  };\n\n  const handleUpdateUnit = (unitId: number) => {\n    if (!productId) return;\n    updateUnit.mutate(\n      {\n        productId,\n        unitId,\n        unitName: editUnitName.trim() || undefined,\n        baseUnit: editUnitName.trim() || undefined,\n      },\n      {\n        onSuccess: () => setEditingUnitId(null),\n      }\n    );\n  };\n\n  const startEditing = (unit: ProductUnit) => {\n    setEditingUnitId(unit.id);\n    setEditUnitName(unit.unitName);\n  };\n\n  const sortedUnits = units ? [...units].sort((a: ProductUnit, b: ProductUnit) => a.sortOrder - b.sortOrder) : [];\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[500px]\">\n        <DialogHeader>\n          <DialogTitle>Kelola Unit</DialogTitle>\n        </DialogHeader>\n        <div className=\"space-y-4 pt-2\">\n          {isLoading ? (\n            <div className=\"flex justify-center p-6\">\n              <Loader2 className=\"w-6 h-6 animate-spin text-primary\" />\n            </div>\n          ) : (\n            <>\n              {sortedUnits.length > 0 && (\n                <div className=\"text-sm text-muted-foreground bg-muted/30 p-3 rounded-md\" data-testid=\"text-unit-display\">\n                  {formatUnitDisplay(sortedUnits)}\n                </div>\n              )}\n\n              <div className=\"space-y-2\">\n                {sortedUnits.map((unit: ProductUnit) => (\n                  <div key={unit.id} className=\"flex items-center gap-2 p-2 rounded-md border border-border/50\">\n                    {editingUnitId === unit.id ? (\n                      <>\n                        <Input\n                          value={editUnitName}\n                          onChange={(e) => setEditUnitName(e.target.value)}\n                          className=\"flex-1\"\n                          placeholder=\"Nama satuan\"\n                          data-testid={`input-edit-unit-name-${unit.id}`}\n                        />\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => handleUpdateUnit(unit.id)}\n                          disabled={updateUnit.isPending}\n                          data-testid={`button-save-unit-${unit.id}`}\n                        >\n                          <Save className=\"w-4 h-4 text-green-600\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => setEditingUnitId(null)}\n                          data-testid={`button-cancel-unit-${unit.id}`}\n                        >\n                          <X className=\"w-4 h-4\" />\n                        </Button>\n                      </>\n                    ) : (\n                      <>\n                        <div className=\"flex-1\">\n                          <span className=\"font-medium\">{unit.unitName}</span>\n                        </div>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => startEditing(unit)}\n                          data-testid={`button-edit-unit-${unit.id}`}\n                        >\n                          <Pencil className=\"w-3.5 h-3.5\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => productId && deleteUnit.mutate({ productId, unitId: unit.id })}\n                          data-testid={`button-delete-unit-${unit.id}`}\n                        >\n                          <Trash2 className=\"w-3.5 h-3.5 text-destructive\" />\n                        </Button>\n                      </>\n                    )}\n                  </div>\n                ))}\n              </div>\n\n              <div className=\"flex items-end gap-2 pt-2 border-t border-border/50 flex-wrap\">\n                <div className=\"flex-1 min-w-[100px]\">\n                  <label className=\"text-xs text-muted-foreground mb-1 block\">Nama Satuan</label>\n                  <Input\n                    value={newUnitName}\n                    onChange={(e) => setNewUnitName(e.target.value)}\n                    placeholder=\"Cth: Dus, Pack, Pcs, Kg\"\n                    data-testid=\"input-new-unit-name\"\n                  />\n                </div>\n                <Button\n                  onClick={handleAddUnit}\n                  disabled={createUnit.isPending || !newUnitName.trim()}\n                  data-testid=\"button-add-unit\"\n                >\n                  {createUnit.isPending ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <Plus className=\"w-4 h-4 mr-1\" />}\n                  Tambah\n                </Button>\n              </div>\n            </>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nfunction ImportResultDialog({ result, open, onOpenChange }: { result: ExcelImportResult | null; open: boolean; onOpenChange: (open: boolean) => void }) {\n  if (!result) return null;\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[500px]\">\n        <DialogHeader>\n          <DialogTitle>Hasil Import Excel</DialogTitle>\n        </DialogHeader>\n        <div className=\"space-y-4 pt-2\">\n          <div className=\"grid grid-cols-2 gap-3\">\n            <div className=\"flex items-center gap-3 p-3 rounded-md bg-green-50 dark:bg-green-950/30 border border-green-200 dark:border-green-900\">\n              <CheckCircle2 className=\"w-5 h-5 text-green-600 dark:text-green-400 shrink-0\" />\n              <div>\n                <div className=\"text-sm text-muted-foreground\">Berhasil</div>\n                <div className=\"text-lg font-bold text-green-700 dark:text-green-400\" data-testid=\"text-import-success-count\">{result.imported}</div>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-3 p-3 rounded-md bg-orange-50 dark:bg-orange-950/30 border border-orange-200 dark:border-orange-900\">\n              <AlertTriangle className=\"w-5 h-5 text-orange-600 dark:text-orange-400 shrink-0\" />\n              <div>\n                <div className=\"text-sm text-muted-foreground\">Dilewati</div>\n                <div className=\"text-lg font-bold text-orange-700 dark:text-orange-400\" data-testid=\"text-import-skipped-count\">{result.skipped}</div>\n              </div>\n            </div>\n          </div>\n\n          {result.errors.length > 0 && (\n            <div className=\"space-y-2\">\n              <h4 className=\"text-sm font-medium text-muted-foreground\">Detail Error:</h4>\n              <div className=\"max-h-48 overflow-y-auto space-y-1\">\n                {result.errors.map((err, i) => (\n                  <div key={i} className=\"flex items-start gap-2 text-sm p-2 rounded-md bg-muted/50\" data-testid={`text-import-error-${i}`}>\n                    <XCircle className=\"w-4 h-4 text-destructive shrink-0 mt-0.5\" />\n                    <span>\n                      <strong>Baris {err.row}:</strong> {err.message}\n                    </span>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          <div className=\"flex justify-end\">\n            <Button onClick={() => onOpenChange(false)} data-testid=\"button-close-import-result\">Tutup</Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nfunction CategoryPriorityDialog({ open, onOpenChange, categories }: {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  categories: string[];\n}) {\n  const { data: priorities, isLoading } = useCategoryPriorities();\n  const setCategoryPriorities = useSetCategoryPriorities();\n  const [orderedCategories, setOrderedCategories] = useState<string[]>([]);\n\n  useEffect(() => {\n    if (!open || categories.length === 0) return;\n    if (priorities && priorities.length > 0) {\n      const priorityMap = new Map(priorities.map(p => [p.categoryName, p.sortOrder]));\n      const sorted = [...categories].sort((a, b) => {\n        const aPriority = priorityMap.get(a) ?? 999;\n        const bPriority = priorityMap.get(b) ?? 999;\n        return aPriority - bPriority;\n      });\n      setOrderedCategories(sorted);\n    } else if (!isLoading) {\n      setOrderedCategories([...categories]);\n    }\n  }, [open, categories, priorities, isLoading]);\n\n  const moveUp = (index: number) => {\n    if (index === 0) return;\n    const newOrder = [...orderedCategories];\n    [newOrder[index - 1], newOrder[index]] = [newOrder[index], newOrder[index - 1]];\n    setOrderedCategories(newOrder);\n  };\n\n  const moveDown = (index: number) => {\n    if (index === orderedCategories.length - 1) return;\n    const newOrder = [...orderedCategories];\n    [newOrder[index], newOrder[index + 1]] = [newOrder[index + 1], newOrder[index]];\n    setOrderedCategories(newOrder);\n  };\n\n  const handleSave = () => {\n    const priorityData = orderedCategories.map((cat, i) => ({\n      categoryName: cat,\n      sortOrder: i,\n    }));\n    setCategoryPriorities.mutate(priorityData, {\n      onSuccess: () => onOpenChange(false),\n    });\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-md\">\n        <DialogHeader>\n          <DialogTitle>Urutan Prioritas Kategori</DialogTitle>\n        </DialogHeader>\n        <div className=\"space-y-2 py-2\">\n          <p className=\"text-sm text-muted-foreground\">Atur urutan prioritas kategori. Kategori di atas akan ditampilkan lebih dulu.</p>\n          {isLoading ? (\n            <div className=\"flex justify-center py-4\">\n              <Loader2 className=\"w-5 h-5 animate-spin text-muted-foreground\" />\n            </div>\n          ) : orderedCategories.length === 0 ? (\n            <p className=\"text-sm text-muted-foreground text-center py-4\">Tidak ada kategori</p>\n          ) : (\n            <div className=\"space-y-1 max-h-80 overflow-y-auto\">\n              {orderedCategories.map((cat, index) => (\n                <div\n                  key={cat}\n                  className=\"flex items-center gap-2 p-2 rounded-md border border-border/50\"\n                  data-testid={`category-priority-${index}`}\n                >\n                  <GripVertical className=\"w-4 h-4 text-muted-foreground/50 shrink-0\" />\n                  <span className=\"text-sm font-medium flex-1\">{cat}</span>\n                  <Badge variant=\"secondary\" className=\"no-default-hover-elevate no-default-active-elevate text-xs\">\n                    #{index + 1}\n                  </Badge>\n                  <Button variant=\"ghost\" size=\"icon\" onClick={() => moveUp(index)} disabled={index === 0} data-testid={`button-move-up-${index}`}>\n                    <ArrowUp className=\"w-3 h-3\" />\n                  </Button>\n                  <Button variant=\"ghost\" size=\"icon\" onClick={() => moveDown(index)} disabled={index === orderedCategories.length - 1} data-testid={`button-move-down-${index}`}>\n                    <ArrowDown className=\"w-3 h-3\" />\n                  </Button>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n        <div className=\"flex justify-end gap-2\">\n          <Button variant=\"outline\" onClick={() => onOpenChange(false)} data-testid=\"button-cancel-category-priority\">\n            Batal\n          </Button>\n          <Button onClick={handleSave} disabled={setCategoryPriorities.isPending} data-testid=\"button-save-category-priority\">\n            {setCategoryPriorities.isPending ? <Loader2 className=\"w-4 h-4 animate-spin mr-2\" /> : null}\n            Simpan Urutan\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nfunction DeleteProductButton({ id, name }: { id: number; name: string }) {\n  const deleteProduct = useDeleteProduct();\n\n  return (\n    <AlertDialog>\n      <AlertDialogTrigger asChild>\n        <Button variant=\"ghost\" size=\"icon\" className=\"text-muted-foreground\" data-testid={`button-delete-product-${id}`}>\n          <Trash2 className=\"w-4 h-4\" />\n        </Button>\n      </AlertDialogTrigger>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle>Hapus Produk?</AlertDialogTitle>\n          <AlertDialogDescription>\n            Apakah Anda yakin ingin menghapus <strong>{name}</strong>? Tindakan ini tidak dapat dibatalkan.\n          </AlertDialogDescription>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel>Batal</AlertDialogCancel>\n          <AlertDialogAction\n            className=\"bg-destructive\"\n            onClick={() => deleteProduct.mutate(id)}\n            data-testid=\"button-confirm-delete\"\n          >\n            Hapus\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n","path":null,"size_bytes":53635,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/hooks/use-feedback.ts":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { api, buildUrl } from \"@shared/routes\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport function useFeedback() {\n  return useQuery({\n    queryKey: [api.feedback.list.path],\n    queryFn: async () => {\n      const res = await fetch(api.feedback.list.path, { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch feedback\");\n      return res.json();\n    },\n  });\n}\n\nexport function useCreateFeedback() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async (data: { type: \"kritik\" | \"saran\"; content: string }) => {\n      const res = await apiRequest(\"POST\", api.feedback.create.path, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [api.feedback.list.path] });\n      toast({ title: \"Feedback Submitted\", description: \"Thank you for your feedback.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n\nexport function useDeleteFeedback() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async (id: number) => {\n      const url = buildUrl(api.feedback.delete.path, { id });\n      await apiRequest(\"DELETE\", url);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [api.feedback.list.path] });\n      toast({ title: \"Feedback Deleted\", description: \"Feedback has been removed.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n","path":null,"size_bytes":1779,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/pages/MotivationPage.tsx":{"content":"import { useState } from \"react\";\nimport {\n  useMotivation,\n  useCreateMotivation,\n  useUpdateMotivation,\n  useDeleteMotivation,\n} from \"@/hooks/use-motivation\";\nimport { useRole } from \"@/hooks/use-role\";\nimport { Heart, Plus, Pencil, Trash2, Loader2, Save, X } from \"lucide-react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { useForm } from \"react-hook-form\";\nimport { z } from \"zod\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\n\nconst createFormSchema = z.object({\n  message: z.string().min(1, \"Pesan tidak boleh kosong\"),\n});\n\nexport default function MotivationPage() {\n  const { data: motivations, isLoading } = useMotivation();\n  const { role } = useRole();\n  const [isCreateOpen, setIsCreateOpen] = useState(false);\n  const [editingId, setEditingId] = useState<number | null>(null);\n\n  const isAdmin = role === \"admin\";\n\n  return (\n    <div className=\"space-y-8 animate-enter\">\n      <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-3xl font-display font-bold text-foreground flex items-center gap-3\">\n            <Heart className=\"w-8 h-8 text-primary\" />\n            Pesan Motivasi\n          </h1>\n          <p className=\"text-muted-foreground mt-2\">Kelola pesan yang akan muncul saat memulai Stock Opname.</p>\n        </div>\n        {isAdmin && (\n          <CreateMotivationDialog open={isCreateOpen} onOpenChange={setIsCreateOpen} />\n        )}\n      </div>\n\n      {isLoading ? (\n        <div className=\"flex justify-center py-12\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n        </div>\n      ) : motivations?.length === 0 ? (\n        <div className=\"text-center py-16\">\n          <Heart className=\"w-16 h-16 mx-auto text-muted-foreground/30 mb-4\" />\n          <h3 className=\"text-lg font-semibold text-foreground\">Belum ada pesan motivasi</h3>\n          <p className=\"text-muted-foreground mt-1\">Mulai membuat pesan motivasi untuk tim Anda.</p>\n        </div>\n      ) : (\n        <div className=\"space-y-4\">\n          {motivations?.map((motivation: MotivationMessage) =>\n            editingId === motivation.id ? (\n              <EditMotivationCard\n                key={motivation.id}\n                motivation={motivation}\n                onCancel={() => setEditingId(null)}\n                onSaved={() => setEditingId(null)}\n              />\n            ) : (\n              <MotivationCard\n                key={motivation.id}\n                motivation={motivation}\n                onEdit={() => setEditingId(motivation.id)}\n              />\n            )\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\ninterface MotivationMessage {\n  id: number;\n  message: string;\n  userId: string;\n  active: number;\n}\n\nfunction MotivationCard({ motivation, onEdit }: { motivation: MotivationMessage; onEdit: () => void }) {\n  const updateMotivation = useUpdateMotivation();\n  const isActive = motivation.active === 1;\n\n  const handleToggleActive = (newActive: boolean) => {\n    updateMotivation.mutate({\n      id: motivation.id,\n      active: newActive ? 1 : 0,\n    });\n  };\n\n  return (\n    <Card className=\"flex flex-col p-6 hover-elevate\" data-testid={`card-motivation-${motivation.id}`}>\n      <div className=\"flex items-start justify-between gap-3\">\n        <div className=\"flex-1 min-w-0\">\n          <p className=\"text-foreground whitespace-pre-wrap break-words\">{motivation.message}</p>\n        </div>\n        <div className=\"flex items-center gap-2 shrink-0\">\n          <Badge variant={isActive ? \"default\" : \"secondary\"} data-testid={`badge-active-${motivation.id}`}>\n            {isActive ? \"Aktif\" : \"Nonaktif\"}\n          </Badge>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"text-muted-foreground\"\n            onClick={onEdit}\n            data-testid={`button-edit-motivation-${motivation.id}`}\n          >\n            <Pencil className=\"w-4 h-4\" />\n          </Button>\n          <DeleteMotivationButton id={motivation.id} message={motivation.message} />\n        </div>\n      </div>\n\n      <div className=\"flex items-center gap-3 pt-4 border-t border-border/50 mt-4\">\n        <span className=\"text-sm text-muted-foreground\">Pesan ini akan muncul saat memulai Stock Opname</span>\n        <div className=\"ml-auto flex items-center gap-2\">\n          <span className=\"text-sm text-muted-foreground\">{isActive ? \"Aktif\" : \"Nonaktif\"}</span>\n          <Switch\n            checked={isActive}\n            onCheckedChange={handleToggleActive}\n            disabled={updateMotivation.isPending}\n            data-testid={`switch-active-${motivation.id}`}\n          />\n        </div>\n      </div>\n    </Card>\n  );\n}\n\nfunction EditMotivationCard({ motivation, onCancel, onSaved }: { motivation: MotivationMessage; onCancel: () => void; onSaved: () => void }) {\n  const [message, setMessage] = useState(motivation.message);\n  const [active, setActive] = useState(motivation.active === 1);\n  const updateMotivation = useUpdateMotivation();\n\n  const handleSave = () => {\n    if (!message.trim()) return;\n    updateMotivation.mutate(\n      {\n        id: motivation.id,\n        message: message.trim(),\n        active: active ? 1 : 0,\n      },\n      { onSuccess: onSaved }\n    );\n  };\n\n  return (\n    <Card className=\"flex flex-col p-6 bg-primary/5 border-primary/20\" data-testid={`card-edit-motivation-${motivation.id}`}>\n      <div className=\"space-y-4 flex-1\">\n        <div>\n          <label className=\"text-sm font-medium text-foreground\">Pesan Motivasi</label>\n          <Input\n            value={message}\n            onChange={(e) => setMessage(e.target.value)}\n            className=\"bg-white mt-1\"\n            placeholder=\"Masukkan pesan motivasi...\"\n            data-testid={`input-edit-message-${motivation.id}`}\n          />\n        </div>\n\n        <div className=\"flex items-center gap-3\">\n          <label className=\"text-sm font-medium text-foreground\">Status</label>\n          <Switch\n            checked={active}\n            onCheckedChange={setActive}\n            data-testid={`input-edit-active-${motivation.id}`}\n          />\n          <span className=\"text-sm text-muted-foreground\">{active ? \"Aktif\" : \"Nonaktif\"}</span>\n        </div>\n      </div>\n\n      <div className=\"flex items-center gap-2 pt-4 border-t border-border/50 justify-end\">\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={onCancel}\n          data-testid={`button-cancel-edit-${motivation.id}`}\n        >\n          Batal\n        </Button>\n        <Button\n          size=\"sm\"\n          onClick={handleSave}\n          disabled={updateMotivation.isPending || !message.trim()}\n          data-testid={`button-save-edit-${motivation.id}`}\n        >\n          {updateMotivation.isPending && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n          Simpan\n        </Button>\n      </div>\n    </Card>\n  );\n}\n\nfunction CreateMotivationDialog({ open, onOpenChange }: { open: boolean; onOpenChange: (open: boolean) => void }) {\n  const createMotivation = useCreateMotivation();\n\n  const form = useForm<z.infer<typeof createFormSchema>>({\n    resolver: zodResolver(createFormSchema),\n    defaultValues: {\n      message: \"\",\n    },\n  });\n\n  const onSubmit = (data: z.infer<typeof createFormSchema>) => {\n    createMotivation.mutate(\n      {\n        message: data.message.trim(),\n      },\n      {\n        onSuccess: () => {\n          onOpenChange(false);\n          form.reset();\n        },\n      }\n    );\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogTrigger asChild>\n        <Button data-testid=\"button-create-motivation\">\n          <Plus className=\"w-4 h-4 mr-2\" />\n          Tambah Pesan\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"sm:max-w-[500px]\">\n        <DialogHeader>\n          <DialogTitle>Tambah Pesan Motivasi Baru</DialogTitle>\n        </DialogHeader>\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4 pt-4\">\n            <FormField\n              control={form.control}\n              name=\"message\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Pesan Motivasi</FormLabel>\n                  <FormControl>\n                    <Input\n                      placeholder=\"Jangan Lupa Tersenyum, ya! Semangat kamu pasti bisa!\"\n                      {...field}\n                      data-testid=\"input-message\"\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"flex justify-end gap-3 pt-2\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => onOpenChange(false)}>\n                Batal\n              </Button>\n              <Button type=\"submit\" disabled={createMotivation.isPending} data-testid=\"button-submit-motivation\">\n                {createMotivation.isPending && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n                Tambah Pesan\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nfunction DeleteMotivationButton({ id, message }: { id: number; message: string }) {\n  const deleteMotivation = useDeleteMotivation();\n\n  return (\n    <AlertDialog>\n      <AlertDialogTrigger asChild>\n        <Button variant=\"ghost\" size=\"icon\" className=\"text-muted-foreground\" data-testid={`button-delete-motivation-${id}`}>\n          <Trash2 className=\"w-4 h-4\" />\n        </Button>\n      </AlertDialogTrigger>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle>Hapus Pesan Motivasi?</AlertDialogTitle>\n          <AlertDialogDescription>\n            Apakah Anda yakin ingin menghapus pesan \"{message}\"? Tindakan ini tidak dapat dibatalkan.\n          </AlertDialogDescription>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel>Batal</AlertDialogCancel>\n          <AlertDialogAction\n            className=\"bg-destructive\"\n            onClick={() => deleteMotivation.mutate(id)}\n            data-testid=\"button-confirm-delete-motivation\"\n          >\n            Hapus\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n","path":null,"size_bytes":10962,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"server/replit_integrations/object_storage/objectStorage.ts":{"content":"import { Storage, File } from \"@google-cloud/storage\";\nimport { Response } from \"express\";\nimport { randomUUID } from \"crypto\";\nimport {\n  ObjectAclPolicy,\n  ObjectPermission,\n  canAccessObject,\n  getObjectAclPolicy,\n  setObjectAclPolicy,\n} from \"./objectAcl\";\n\nconst REPLIT_SIDECAR_ENDPOINT = \"http://127.0.0.1:1106\";\n\n// The object storage client is used to interact with the object storage service.\nexport const objectStorageClient = new Storage({\n  credentials: {\n    audience: \"replit\",\n    subject_token_type: \"access_token\",\n    token_url: `${REPLIT_SIDECAR_ENDPOINT}/token`,\n    type: \"external_account\",\n    credential_source: {\n      url: `${REPLIT_SIDECAR_ENDPOINT}/credential`,\n      format: {\n        type: \"json\",\n        subject_token_field_name: \"access_token\",\n      },\n    },\n    universe_domain: \"googleapis.com\",\n  },\n  projectId: \"\",\n});\n\nexport class ObjectNotFoundError extends Error {\n  constructor() {\n    super(\"Object not found\");\n    this.name = \"ObjectNotFoundError\";\n    Object.setPrototypeOf(this, ObjectNotFoundError.prototype);\n  }\n}\n\n// The object storage service is used to interact with the object storage service.\nexport class ObjectStorageService {\n  constructor() {}\n\n  // Gets the public object search paths.\n  getPublicObjectSearchPaths(): Array<string> {\n    const pathsStr = process.env.PUBLIC_OBJECT_SEARCH_PATHS || \"\";\n    const paths = Array.from(\n      new Set(\n        pathsStr\n          .split(\",\")\n          .map((path) => path.trim())\n          .filter((path) => path.length > 0)\n      )\n    );\n    if (paths.length === 0) {\n      throw new Error(\n        \"PUBLIC_OBJECT_SEARCH_PATHS not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PUBLIC_OBJECT_SEARCH_PATHS env var (comma-separated paths).\"\n      );\n    }\n    return paths;\n  }\n\n  // Gets the private object directory.\n  getPrivateObjectDir(): string {\n    const dir = process.env.PRIVATE_OBJECT_DIR || \"\";\n    if (!dir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n    return dir;\n  }\n\n  // Search for a public object from the search paths.\n  async searchPublicObject(filePath: string): Promise<File | null> {\n    for (const searchPath of this.getPublicObjectSearchPaths()) {\n      const fullPath = `${searchPath}/${filePath}`;\n\n      // Full path format: /<bucket_name>/<object_name>\n      const { bucketName, objectName } = parseObjectPath(fullPath);\n      const bucket = objectStorageClient.bucket(bucketName);\n      const file = bucket.file(objectName);\n\n      // Check if file exists\n      const [exists] = await file.exists();\n      if (exists) {\n        return file;\n      }\n    }\n\n    return null;\n  }\n\n  // Downloads an object to the response.\n  async downloadObject(file: File, res: Response, cacheTtlSec: number = 3600) {\n    try {\n      // Get file metadata\n      const [metadata] = await file.getMetadata();\n      // Get the ACL policy for the object.\n      const aclPolicy = await getObjectAclPolicy(file);\n      const isPublic = aclPolicy?.visibility === \"public\";\n      // Set appropriate headers\n      res.set({\n        \"Content-Type\": metadata.contentType || \"application/octet-stream\",\n        \"Content-Length\": metadata.size,\n        \"Cache-Control\": `${\n          isPublic ? \"public\" : \"private\"\n        }, max-age=${cacheTtlSec}`,\n      });\n\n      // Stream the file to the response\n      const stream = file.createReadStream();\n\n      stream.on(\"error\", (err) => {\n        console.error(\"Stream error:\", err);\n        if (!res.headersSent) {\n          res.status(500).json({ error: \"Error streaming file\" });\n        }\n      });\n\n      stream.pipe(res);\n    } catch (error) {\n      console.error(\"Error downloading file:\", error);\n      if (!res.headersSent) {\n        res.status(500).json({ error: \"Error downloading file\" });\n      }\n    }\n  }\n\n  async uploadFileFromServer(\n    fileBuffer: Buffer,\n    originalName: string,\n    contentType: string\n  ): Promise<string> {\n    const privateObjectDir = this.getPrivateObjectDir();\n    const objectId = randomUUID();\n    const ext = originalName.includes('.') ? originalName.substring(originalName.lastIndexOf('.')) : '';\n    const fullPath = `${privateObjectDir}/uploads/${objectId}${ext}`;\n\n    const { bucketName, objectName } = parseObjectPath(fullPath);\n    const bucket = objectStorageClient.bucket(bucketName);\n    const file = bucket.file(objectName);\n\n    await file.save(fileBuffer, {\n      contentType,\n      resumable: false,\n    });\n\n    const entityId = `uploads/${objectId}${ext}`;\n    return `/objects/${entityId}`;\n  }\n\n  async getObjectStream(objectPath: string): Promise<{ stream: NodeJS.ReadableStream; contentType: string } | null> {\n    try {\n      const objectFile = await this.getObjectEntityFile(objectPath);\n      const [metadata] = await objectFile.getMetadata();\n      const stream = objectFile.createReadStream();\n      return {\n        stream,\n        contentType: (metadata.contentType as string) || 'application/octet-stream',\n      };\n    } catch {\n      return null;\n    }\n  }\n\n  // Gets the upload URL for an object entity.\n  async getObjectEntityUploadURL(): Promise<string> {\n    const privateObjectDir = this.getPrivateObjectDir();\n    if (!privateObjectDir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n\n    const objectId = randomUUID();\n    const fullPath = `${privateObjectDir}/uploads/${objectId}`;\n\n    const { bucketName, objectName } = parseObjectPath(fullPath);\n\n    // Sign URL for PUT method with TTL\n    return signObjectURL({\n      bucketName,\n      objectName,\n      method: \"PUT\",\n      ttlSec: 900,\n    });\n  }\n\n  // Gets the object entity file from the object path.\n  async getObjectEntityFile(objectPath: string): Promise<File> {\n    if (!objectPath.startsWith(\"/objects/\")) {\n      throw new ObjectNotFoundError();\n    }\n\n    const parts = objectPath.slice(1).split(\"/\");\n    if (parts.length < 2) {\n      throw new ObjectNotFoundError();\n    }\n\n    const entityId = parts.slice(1).join(\"/\");\n    let entityDir = this.getPrivateObjectDir();\n    if (!entityDir.endsWith(\"/\")) {\n      entityDir = `${entityDir}/`;\n    }\n    const objectEntityPath = `${entityDir}${entityId}`;\n    const { bucketName, objectName } = parseObjectPath(objectEntityPath);\n    const bucket = objectStorageClient.bucket(bucketName);\n    const objectFile = bucket.file(objectName);\n    const [exists] = await objectFile.exists();\n    if (!exists) {\n      throw new ObjectNotFoundError();\n    }\n    return objectFile;\n  }\n\n  normalizeObjectEntityPath(\n    rawPath: string,\n  ): string {\n    if (!rawPath.startsWith(\"https://storage.googleapis.com/\")) {\n      return rawPath;\n    }\n  \n    // Extract the path from the URL by removing query parameters and domain\n    const url = new URL(rawPath);\n    const rawObjectPath = url.pathname;\n  \n    let objectEntityDir = this.getPrivateObjectDir();\n    if (!objectEntityDir.endsWith(\"/\")) {\n      objectEntityDir = `${objectEntityDir}/`;\n    }\n  \n    if (!rawObjectPath.startsWith(objectEntityDir)) {\n      return rawObjectPath;\n    }\n  \n    // Extract the entity ID from the path\n    const entityId = rawObjectPath.slice(objectEntityDir.length);\n    return `/objects/${entityId}`;\n  }\n\n  // Tries to set the ACL policy for the object entity and return the normalized path.\n  async trySetObjectEntityAclPolicy(\n    rawPath: string,\n    aclPolicy: ObjectAclPolicy\n  ): Promise<string> {\n    const normalizedPath = this.normalizeObjectEntityPath(rawPath);\n    if (!normalizedPath.startsWith(\"/\")) {\n      return normalizedPath;\n    }\n\n    const objectFile = await this.getObjectEntityFile(normalizedPath);\n    await setObjectAclPolicy(objectFile, aclPolicy);\n    return normalizedPath;\n  }\n\n  // Checks if the user can access the object entity.\n  async canAccessObjectEntity({\n    userId,\n    objectFile,\n    requestedPermission,\n  }: {\n    userId?: string;\n    objectFile: File;\n    requestedPermission?: ObjectPermission;\n  }): Promise<boolean> {\n    return canAccessObject({\n      userId,\n      objectFile,\n      requestedPermission: requestedPermission ?? ObjectPermission.READ,\n    });\n  }\n}\n\nfunction parseObjectPath(path: string): {\n  bucketName: string;\n  objectName: string;\n} {\n  if (!path.startsWith(\"/\")) {\n    path = `/${path}`;\n  }\n  const pathParts = path.split(\"/\");\n  if (pathParts.length < 3) {\n    throw new Error(\"Invalid path: must contain at least a bucket name\");\n  }\n\n  const bucketName = pathParts[1];\n  const objectName = pathParts.slice(2).join(\"/\");\n\n  return {\n    bucketName,\n    objectName,\n  };\n}\n\nasync function signObjectURL({\n  bucketName,\n  objectName,\n  method,\n  ttlSec,\n}: {\n  bucketName: string;\n  objectName: string;\n  method: \"GET\" | \"PUT\" | \"DELETE\" | \"HEAD\";\n  ttlSec: number;\n}): Promise<string> {\n  const request = {\n    bucket_name: bucketName,\n    object_name: objectName,\n    method,\n    expires_at: new Date(Date.now() + ttlSec * 1000).toISOString(),\n  };\n  const response = await fetch(\n    `${REPLIT_SIDECAR_ENDPOINT}/object-storage/signed-object-url`,\n    {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(request),\n    }\n  );\n  if (!response.ok) {\n    throw new Error(\n      `Failed to sign object URL, errorcode: ${response.status}, ` +\n        `make sure you're running on Replit`\n    );\n  }\n\n  const { signed_url: signedURL } = await response.json();\n  return signedURL;\n}\n\n","path":null,"size_bytes":9623,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"migrate_prod_to_dev.ts":{"content":"import pg from \"pg\";\nimport fs from \"fs\";\n\nconst devUrl = process.env.DATABASE_URL!;\nconst dataDir = \"/tmp/prod_data\";\n\nasync function exportFromProd() {\n  const files = fs.readdirSync(dataDir).filter(f => f.endsWith('.json'));\n  if (files.length === 0) {\n    console.error(\"No JSON files found in /tmp/prod_data/\");\n    console.error(\"Run the export step first\");\n    process.exit(1);\n  }\n}\n\nasync function importToDev() {\n  const client = new pg.Client({ connectionString: devUrl });\n  await client.connect();\n  console.log(\"Connected to development database\");\n\n  const tables = [\n    \"users\",\n    \"user_roles\",\n    \"products\",\n    \"product_photos\",\n    \"product_units\",\n    \"opname_sessions\",\n    \"opname_records\",\n    \"opname_record_photos\",\n    \"staff_members\",\n    \"announcements\",\n    \"feedback\",\n    \"motivation_messages\",\n    \"category_priorities\",\n  ];\n\n  try {\n    await client.query(\"BEGIN\");\n\n    await client.query(\"DELETE FROM sessions\");\n    for (const table of [...tables].reverse()) {\n      console.log(`Clearing: ${table}`);\n      await client.query(`DELETE FROM \"${table}\"`);\n    }\n\n    for (const table of tables) {\n      const filePath = `${dataDir}/${table}.json`;\n      if (!fs.existsSync(filePath)) {\n        console.log(`Skipping ${table} (no data file)`);\n        continue;\n      }\n\n      const raw = fs.readFileSync(filePath, \"utf-8\").trim();\n      if (!raw || raw === \"null\") {\n        console.log(`Skipping ${table} (empty)`);\n        continue;\n      }\n\n      const data = JSON.parse(raw);\n      if (!Array.isArray(data) || data.length === 0) {\n        console.log(`Skipping ${table} (no rows)`);\n        continue;\n      }\n\n      console.log(`Importing ${table}: ${data.length} rows`);\n      let imported = 0;\n\n      for (const row of data) {\n        const cols = Object.keys(row);\n        const placeholders = cols.map((_, i) => `$${i + 1}`).join(\", \");\n        const colNames = cols.map(c => `\"${c}\"`).join(\", \");\n        const values = cols.map(c => row[c]);\n\n        await client.query(\n          `INSERT INTO \"${table}\" (${colNames}) VALUES (${placeholders})`,\n          values\n        );\n        imported++;\n      }\n      console.log(`  Done: ${imported} rows`);\n    }\n\n    const serialTables = [\"user_roles\", \"products\", \"product_photos\", \"product_units\",\n      \"opname_sessions\", \"opname_records\", \"opname_record_photos\",\n      \"staff_members\", \"announcements\", \"feedback\", \"motivation_messages\", \"category_priorities\"];\n\n    for (const table of serialTables) {\n      try {\n        await client.query(`\n          SELECT setval(pg_get_serial_sequence('\"${table}\"', 'id'),\n            COALESCE((SELECT MAX(id) FROM \"${table}\"), 1))\n        `);\n      } catch {}\n    }\n\n    await client.query(\"COMMIT\");\n    console.log(\"\\nMigration completed successfully!\");\n\n    console.log(\"\\nVerification:\");\n    for (const table of tables) {\n      const { rows } = await client.query(`SELECT COUNT(*) as cnt FROM \"${table}\"`);\n      console.log(`  ${table}: ${rows[0].cnt} rows`);\n    }\n  } catch (err) {\n    await client.query(\"ROLLBACK\");\n    console.error(\"Migration failed:\", err);\n    process.exit(1);\n  } finally {\n    await client.end();\n  }\n}\n\nimportToDev();\n","path":null,"size_bytes":3191,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        display: [\"var(--font-display)\"],\n        body: [\"var(--font-body)\"],\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4128,"size_tokens":null},"client/src/pages/Dashboard.tsx":{"content":"import { useProducts } from \"@/hooks/use-products\";\nimport { useSessions } from \"@/hooks/use-sessions\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useRole } from \"@/hooks/use-role\";\nimport { useAnnouncements } from \"@/hooks/use-announcements\";\nimport { Package, ClipboardList, AlertTriangle, ArrowRight, Megaphone } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { StatusBadge } from \"@/components/StatusBadge\";\nimport { Card } from \"@/components/ui/card\";\nimport { format } from \"date-fns\";\nimport { Badge } from \"@/components/ui/badge\";\n\nexport default function Dashboard() {\n  const { data: products } = useProducts();\n  const { data: sessions } = useSessions();\n  const { user } = useAuth();\n  const { role } = useRole();\n  const { data: announcements } = useAnnouncements();\n\n  const activeSessions = sessions?.filter(s => s.status === 'in_progress') || [];\n  const lowStockItems = products?.filter(p => p.currentStock < 10) || [];\n  \n  const now = new Date();\n  const activeAnnouncements = announcements?.filter((a: any) => !a.expiresAt || new Date(a.expiresAt) > now) || [];\n\n  const roleLabel: Record<string, string> = {\n    admin: \"Admin\",\n    sku_manager: \"SKU Manager\",\n    stock_counter: \"Stock Counter\",\n    stock_counter_toko: \"Stock Counter Toko\",\n    stock_counter_gudang: \"Stock Counter Gudang\",\n  };\n\n  const stats = [\n    {\n      label: \"Total Produk\",\n      value: products?.length || 0,\n      icon: Package,\n      color: \"bg-blue-500\",\n      desc: \"Item dalam inventori\"\n    },\n    {\n      label: \"Sesi Aktif\",\n      value: activeSessions.length,\n      icon: ClipboardList,\n      color: \"bg-purple-500\",\n      desc: \"Opname sedang berlangsung\"\n    },\n    {\n      label: \"Stok Rendah\",\n      value: lowStockItems.length,\n      icon: AlertTriangle,\n      color: \"bg-orange-500\",\n      desc: \"Item di bawah ambang batas\"\n    },\n  ];\n\n  return (\n    <div className=\"space-y-8 animate-enter\">\n      {activeAnnouncements.length > 0 && (\n        <div className=\"space-y-4\" data-testid=\"section-announcements\">\n          {activeAnnouncements.map((announcement: any) => (\n            <Card key={announcement.id} className=\"overflow-visible\" data-testid={`card-announcement-${announcement.id}`}>\n              {announcement.imageUrl ? (\n                <div className=\"flex flex-col md:flex-row\">\n                  <div className=\"md:w-2/5 w-full\">\n                    <img\n                      src={announcement.imageUrl}\n                      alt={announcement.title}\n                      className=\"w-full h-full object-cover rounded-t-md md:rounded-l-md md:rounded-tr-none min-h-[200px] max-h-[300px]\"\n                      data-testid={`img-announcement-${announcement.id}`}\n                    />\n                  </div>\n                  <div className=\"md:w-3/5 w-full p-6 flex flex-col justify-center\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <Megaphone className=\"w-5 h-5 text-primary shrink-0\" />\n                      <Badge variant=\"secondary\">Pengumuman</Badge>\n                    </div>\n                    <h2 className=\"text-2xl md:text-3xl font-display font-bold text-foreground mb-3\" data-testid={`text-announcement-title-${announcement.id}`}>\n                      {announcement.title}\n                    </h2>\n                    <p className=\"text-foreground/80 whitespace-pre-wrap leading-relaxed mb-4\" data-testid={`text-announcement-content-${announcement.id}`}>\n                      {announcement.content}\n                    </p>\n                    <div className=\"flex items-center gap-3 text-xs text-muted-foreground\">\n                      <span>{format(new Date(announcement.createdAt), 'dd MMM yyyy')}</span>\n                      {announcement.expiresAt && (\n                        <span className=\"text-orange-600 font-medium\">\n                          Berlaku hingga {format(new Date(announcement.expiresAt), 'dd MMM yyyy')}\n                        </span>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"p-6 md:p-8 text-center\">\n                  <div className=\"flex items-center justify-center gap-2 mb-3\">\n                    <Megaphone className=\"w-6 h-6 text-primary\" />\n                    <Badge variant=\"secondary\">Pengumuman</Badge>\n                  </div>\n                  <h2 className=\"text-2xl md:text-3xl font-display font-bold text-foreground mb-3\" data-testid={`text-announcement-title-${announcement.id}`}>\n                    {announcement.title}\n                  </h2>\n                  <p className=\"text-foreground/80 whitespace-pre-wrap leading-relaxed max-w-2xl mx-auto mb-4\" data-testid={`text-announcement-content-${announcement.id}`}>\n                    {announcement.content}\n                  </p>\n                  <div className=\"flex items-center justify-center gap-3 text-xs text-muted-foreground\">\n                    <span>{format(new Date(announcement.createdAt), 'dd MMM yyyy')}</span>\n                    {announcement.expiresAt && (\n                      <span className=\"text-orange-600 font-medium\">\n                        Berlaku hingga {format(new Date(announcement.expiresAt), 'dd MMM yyyy')}\n                      </span>\n                    )}\n                  </div>\n                </div>\n              )}\n            </Card>\n          ))}\n        </div>\n      )}\n\n      <div>\n        <h1 className=\"text-3xl font-display font-bold text-foreground\" data-testid=\"text-dashboard-title\">\n          Welcome, {user?.firstName || \"User\"}\n        </h1>\n        <div className=\"text-muted-foreground mt-2 flex items-center flex-wrap gap-2\">\n          <span>Overview of inventory health and ongoing audits.</span>\n          <Badge variant=\"secondary\">{roleLabel[role] || role}</Badge>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n        {stats.map((stat, i) => (\n          <div key={i} className=\"bg-card p-6 rounded-2xl border border-border/50 shadow-sm\" data-testid={`card-stat-${i}`}>\n            <div className=\"flex items-center justify-between gap-2\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">{stat.label}</p>\n                <p className=\"text-4xl font-display font-bold mt-2\">{stat.value}</p>\n              </div>\n              <div className={`${stat.color} p-3 rounded-xl text-white shadow-lg shadow-black/10`}>\n                <stat.icon className=\"w-6 h-6\" />\n              </div>\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-4\">{stat.desc}</p>\n          </div>\n        ))}\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n        <div className=\"bg-card rounded-2xl border border-border/50 shadow-sm overflow-hidden flex flex-col\">\n          <div className=\"p-6 border-b border-border/50 flex items-center justify-between gap-2\">\n            <h3 className=\"font-display font-bold text-lg\">Active Opname Sessions</h3>\n            <Link href=\"/sessions\">\n              <span className=\"text-sm text-primary font-medium hover:underline flex items-center gap-1 cursor-pointer\">\n                View All <ArrowRight className=\"w-4 h-4\" />\n              </span>\n            </Link>\n          </div>\n          <div className=\"p-0\">\n            {activeSessions.length === 0 ? (\n              <div className=\"p-8 text-center text-muted-foreground\">\n                <ClipboardList className=\"w-12 h-12 mx-auto mb-3 opacity-20\" />\n                <p>No active sessions</p>\n              </div>\n            ) : (\n              <div className=\"divide-y divide-border/50\">\n                {activeSessions.map(session => (\n                  <Link key={session.id} href={`/sessions/${session.id}`}>\n                    <div className=\"p-4 hover:bg-muted/30 transition-colors cursor-pointer flex items-center justify-between gap-2 group\">\n                      <div>\n                        <h4 className=\"font-semibold text-foreground group-hover:text-primary transition-colors\">{session.title}</h4>\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          Started {format(new Date(session.startedAt), 'MMM d, yyyy')}\n                        </p>\n                      </div>\n                      <StatusBadge status={session.status} />\n                    </div>\n                  </Link>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n\n        <div className=\"bg-card rounded-2xl border border-border/50 shadow-sm overflow-hidden flex flex-col\">\n          <div className=\"p-6 border-b border-border/50 flex items-center justify-between gap-2\">\n            <h3 className=\"font-display font-bold text-lg flex items-center gap-2\">\n              <AlertTriangle className=\"w-5 h-5 text-orange-500\" />\n              Low Stock Alerts\n            </h3>\n            <Link href=\"/products\">\n              <span className=\"text-sm text-primary font-medium hover:underline flex items-center gap-1 cursor-pointer\">\n                Manage <ArrowRight className=\"w-4 h-4\" />\n              </span>\n            </Link>\n          </div>\n          <div className=\"p-0\">\n            {lowStockItems.length === 0 ? (\n              <div className=\"p-8 text-center text-muted-foreground\">\n                <Package className=\"w-12 h-12 mx-auto mb-3 opacity-20\" />\n                <p>All stock levels healthy</p>\n              </div>\n            ) : (\n              <div className=\"divide-y divide-border/50\">\n                {lowStockItems.slice(0, 5).map(item => (\n                  <div key={item.id} className=\"p-4 flex items-center justify-between gap-2\">\n                    <div>\n                      <h4 className=\"font-medium text-foreground\">{item.name}</h4>\n                      <p className=\"text-xs text-muted-foreground font-mono\">{item.sku}</p>\n                    </div>\n                    <span className=\"text-sm font-bold text-orange-600 bg-orange-50 px-3 py-1 rounded-lg\">\n                      {item.currentStock} left\n                    </span>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":10308,"size_tokens":null},"client/src/pages/Sessions.tsx":{"content":"import { useSessions, useCreateSession } from \"@/hooks/use-sessions\";\nimport { useRole } from \"@/hooks/use-role\";\nimport { useStaff } from \"@/hooks/use-staff\";\nimport { useMotivation } from \"@/hooks/use-motivation\";\nimport type { StaffMember, MotivationMessage } from \"@shared/schema\";\nimport { Link } from \"wouter\";\nimport { Plus, ClipboardList, Calendar, Loader2, Store, Warehouse, Package, User } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { StatusBadge } from \"@/components/StatusBadge\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { format } from \"date-fns\";\nimport { useState, useMemo } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { z } from \"zod\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\n\nconst sessionFormSchema = z.object({\n  title: z.string().min(1, \"Title is required\"),\n  notes: z.string().optional(),\n});\n\nfunction getDefaultTab(role: string, canCountToko: boolean, canCountGudang: boolean): string {\n  if (role === \"stock_counter_toko\") return \"toko\";\n  if (role === \"stock_counter_gudang\") return \"gudang\";\n  return \"semua\";\n}\n\nexport default function Sessions() {\n  const { canCount, canCountToko, canCountGudang, canCountLocation, role } = useRole();\n  const defaultTab = getDefaultTab(role, canCountToko, canCountGudang);\n  const [locationType, setLocationType] = useState<string>(defaultTab);\n  const queryLocationType = locationType === \"semua\" ? undefined : locationType;\n  const { data: sessions, isLoading } = useSessions(queryLocationType);\n  const [isCreateOpen, setIsCreateOpen] = useState(false);\n\n  const showAllTabs = role === \"admin\" || role === \"sku_manager\" || role === \"stock_counter\";\n\n  return (\n    <div className=\"space-y-8 animate-enter\">\n      <div className=\"flex items-center justify-between flex-wrap gap-3\">\n        <div>\n          <h1 className=\"text-3xl font-display font-bold text-foreground\">Opname Sessions</h1>\n          <p className=\"text-muted-foreground mt-2\">Track and audit your stock counting sessions.</p>\n        </div>\n        {canCount && (\n          <CreateSessionDialog\n            open={isCreateOpen}\n            onOpenChange={setIsCreateOpen}\n            currentLocationType={locationType === \"semua\" ? \"toko\" : locationType}\n          />\n        )}\n      </div>\n\n      <div className=\"flex flex-col md:flex-row md:items-center gap-3\">\n        <Tabs value={locationType} onValueChange={setLocationType} data-testid=\"tabs-session-location-type\">\n          <TabsList>\n            {showAllTabs && (\n              <TabsTrigger value=\"semua\" data-testid=\"tab-session-semua\">\n                <Package className=\"w-4 h-4 mr-1.5\" />\n                Semua\n              </TabsTrigger>\n            )}\n            {canCountToko && (\n              <TabsTrigger value=\"toko\" data-testid=\"tab-session-toko\">\n                <Store className=\"w-4 h-4 mr-1.5\" />\n                Toko\n              </TabsTrigger>\n            )}\n            {canCountGudang && (\n              <TabsTrigger value=\"gudang\" data-testid=\"tab-session-gudang\">\n                <Warehouse className=\"w-4 h-4 mr-1.5\" />\n                Gudang\n              </TabsTrigger>\n            )}\n          </TabsList>\n        </Tabs>\n      </div>\n\n      {isLoading ? (\n        <div className=\"flex justify-center p-12\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n        </div>\n      ) : sessions?.length === 0 ? (\n        <div className=\"bg-card border border-border/50 rounded-2xl p-16 text-center shadow-sm\">\n          <ClipboardList className=\"w-16 h-16 mx-auto text-muted-foreground/30 mb-4\" />\n          <h3 className=\"text-lg font-semibold text-foreground\">No Sessions Yet</h3>\n          <p className=\"text-muted-foreground mt-1 mb-6\">Start a new stock opname session to begin auditing.</p>\n          {canCount && <Button onClick={() => setIsCreateOpen(true)} data-testid=\"button-start-session-empty\">Start Session</Button>}\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {sessions?.map((session) => (\n            <Link key={session.id} href={`/sessions/${session.id}`}>\n              <div\n                className=\"bg-card p-6 rounded-2xl border border-border/50 shadow-sm hover:shadow-lg hover:border-primary/20 transition-all cursor-pointer group flex flex-col h-full\"\n                data-testid={`card-session-${session.id}`}\n              >\n                <div className=\"flex items-start justify-between mb-4 gap-2\">\n                  <div className=\"p-3 bg-primary/5 rounded-xl group-hover:bg-primary/10 transition-colors\">\n                    <ClipboardList className=\"w-6 h-6 text-primary\" />\n                  </div>\n                  <div className=\"flex items-center gap-2 flex-wrap\">\n                    <Badge\n                      variant={session.locationType === \"gudang\" ? \"secondary\" : \"outline\"}\n                      data-testid={`badge-location-${session.id}`}\n                    >\n                      {session.locationType === \"gudang\" ? (\n                        <Warehouse className=\"w-3 h-3 mr-1\" />\n                      ) : (\n                        <Store className=\"w-3 h-3 mr-1\" />\n                      )}\n                      {session.locationType === \"gudang\" ? \"Gudang\" : \"Toko\"}\n                    </Badge>\n                    <StatusBadge status={session.status} />\n                  </div>\n                </div>\n                \n                <h3 className=\"font-display font-bold text-lg mb-2\">{session.title}</h3>\n                <p className=\"text-sm text-muted-foreground line-clamp-2 mb-2 flex-1\">\n                  {session.notes || \"No additional notes provided.\"}\n                </p>\n\n                {session.assignedTo && (\n                  <div className=\"flex items-center gap-1.5 text-sm text-muted-foreground mb-4\" data-testid={`text-petugas-${session.id}`}>\n                    <User className=\"w-3.5 h-3.5\" />\n                    <span>Petugas: {session.assignedTo}</span>\n                  </div>\n                )}\n\n                <div className=\"pt-4 border-t border-border/50 flex items-center gap-2 text-xs text-muted-foreground\">\n                  <Calendar className=\"w-4 h-4\" />\n                  Started {format(new Date(session.startedAt), 'MMMM d, yyyy')}\n                </div>\n              </div>\n            </Link>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction CreateSessionDialog({\n  open,\n  onOpenChange,\n  currentLocationType,\n}: {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  currentLocationType: string;\n}) {\n  const createSession = useCreateSession();\n  const { data: staffList } = useStaff();\n  const { data: motivationList } = useMotivation();\n  const { canCountToko, canCountGudang, role } = useRole();\n\n  const [step, setStep] = useState<\"staff\" | \"details\">(\"staff\");\n  const [selectedStaff, setSelectedStaff] = useState<string>(\"\");\n  const [selectedLocation, setSelectedLocation] = useState<string>(currentLocationType);\n\n  const activeMotivation = useMemo(() => {\n    const active = (motivationList || []).filter((m: MotivationMessage) => m.active === 1);\n    if (active.length === 0) return null;\n    return active[Math.floor(Math.random() * active.length)];\n  }, [motivationList, open]);\n\n  const filteredStaff = useMemo(() => {\n    if (!staffList) return [];\n    return (staffList as StaffMember[]).filter(\n      (s) => s.active === 1 && s.locationType === selectedLocation\n    );\n  }, [staffList, selectedLocation]);\n\n  const showLocationSelect = role === \"admin\" || role === \"sku_manager\" || role === \"stock_counter\";\n\n  const form = useForm<z.infer<typeof sessionFormSchema>>({\n    resolver: zodResolver(sessionFormSchema),\n    defaultValues: {\n      title: \"\",\n      notes: \"\",\n    },\n  });\n\n  const handleOpenChange = (newOpen: boolean) => {\n    if (!newOpen) {\n      setStep(\"staff\");\n      setSelectedStaff(\"\");\n      setSelectedLocation(currentLocationType);\n      form.reset();\n    }\n    onOpenChange(newOpen);\n  };\n\n  const handleStaffContinue = () => {\n    if (selectedStaff) {\n      setStep(\"details\");\n    }\n  };\n\n  const onSubmit = (data: z.infer<typeof sessionFormSchema>) => {\n    const staffName = filteredStaff.find((s) => String(s.id) === selectedStaff)?.name || \"\";\n    createSession.mutate(\n      {\n        ...data,\n        locationType: selectedLocation,\n        startedByName: staffName,\n        assignedTo: staffName,\n      },\n      {\n        onSuccess: () => {\n          handleOpenChange(false);\n        },\n      }\n    );\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleOpenChange}>\n      <DialogTrigger asChild>\n        <Button data-testid=\"button-new-session\">\n          <Plus className=\"w-4 h-4 mr-2\" />\n          New Session\n        </Button>\n      </DialogTrigger>\n      <DialogContent>\n        {step === \"staff\" ? (\n          <>\n            <DialogHeader>\n              <DialogTitle data-testid=\"dialog-title-staff\">Siapa yang Stock Opname hari ini?</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-5 pt-4\">\n              {activeMotivation && (\n                <div\n                  className=\"bg-primary/5 border border-primary/10 rounded-xl p-4 text-center\"\n                  data-testid=\"text-motivation-message\"\n                >\n                  <p className=\"text-sm text-foreground italic\">\n                    \"{activeMotivation.message}\"\n                  </p>\n                </div>\n              )}\n\n              {showLocationSelect && (\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium text-foreground\">Lokasi</label>\n                  <Select\n                    value={selectedLocation}\n                    onValueChange={(val) => {\n                      setSelectedLocation(val);\n                      setSelectedStaff(\"\");\n                    }}\n                    data-testid=\"select-location\"\n                  >\n                    <SelectTrigger data-testid=\"select-location-trigger\">\n                      <SelectValue placeholder=\"Pilih lokasi\" />\n                    </SelectTrigger>\n                    <SelectContent className=\"bg-card border border-border\">\n                      <SelectItem value=\"toko\" data-testid=\"select-location-toko\">\n                        <div className=\"flex items-center gap-2\">\n                          <Store className=\"w-4 h-4\" />\n                          Toko\n                        </div>\n                      </SelectItem>\n                      <SelectItem value=\"gudang\" data-testid=\"select-location-gudang\">\n                        <div className=\"flex items-center gap-2\">\n                          <Warehouse className=\"w-4 h-4\" />\n                          Gudang\n                        </div>\n                      </SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              )}\n\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium text-foreground\">Petugas</label>\n                <Select value={selectedStaff} onValueChange={setSelectedStaff} data-testid=\"select-staff\">\n                  <SelectTrigger data-testid=\"select-staff-trigger\">\n                    <SelectValue placeholder=\"Pilih petugas...\" />\n                  </SelectTrigger>\n                  <SelectContent className=\"bg-card border border-border\">\n                    {filteredStaff.length === 0 ? (\n                      <div className=\"p-3 text-sm text-muted-foreground text-center\">\n                        Tidak ada petugas untuk lokasi ini\n                      </div>\n                    ) : (\n                      filteredStaff.map((staff) => (\n                        <SelectItem\n                          key={staff.id}\n                          value={String(staff.id)}\n                          data-testid={`select-staff-${staff.id}`}\n                        >\n                          <div className=\"flex items-center gap-2\">\n                            <User className=\"w-4 h-4\" />\n                            {staff.name}\n                          </div>\n                        </SelectItem>\n                      ))\n                    )}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"flex justify-end gap-3 pt-2\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => handleOpenChange(false)}\n                  data-testid=\"button-cancel-staff\"\n                >\n                  Batal\n                </Button>\n                <Button\n                  type=\"button\"\n                  disabled={!selectedStaff}\n                  onClick={handleStaffContinue}\n                  data-testid=\"button-continue-staff\"\n                >\n                  Lanjutkan\n                </Button>\n              </div>\n            </div>\n          </>\n        ) : (\n          <>\n            <DialogHeader>\n              <DialogTitle>Start New Opname Session</DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4 pt-4\">\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                  <User className=\"w-4 h-4\" />\n                  <span>Petugas: <span className=\"font-medium text-foreground\">{filteredStaff.find((s) => String(s.id) === selectedStaff)?.name}</span></span>\n                  <Badge variant={selectedLocation === \"gudang\" ? \"secondary\" : \"outline\"}>\n                    {selectedLocation === \"gudang\" ? \"Gudang\" : \"Toko\"}\n                  </Badge>\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"title\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Session Title</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"E.g. Q4 Audit 2024\" {...field} data-testid=\"input-session-title\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"notes\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Notes (Optional)</FormLabel>\n                      <FormControl>\n                        <Textarea placeholder=\"Any specific instructions...\" {...field} value={field.value || \"\"} data-testid=\"input-session-notes\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"flex justify-end gap-3 pt-2\">\n                  <Button type=\"button\" variant=\"outline\" onClick={() => setStep(\"staff\")} data-testid=\"button-back-details\">\n                    Kembali\n                  </Button>\n                  <Button type=\"submit\" disabled={createSession.isPending} data-testid=\"button-submit-session\">\n                    {createSession.isPending && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n                    Start Session\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":15999,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/pages/SessionDetail.tsx":{"content":"import { useSession, useUpdateRecord, useCompleteSession, useUploadOpnamePhoto, useUploadRecordPhoto, useDeleteRecordPhoto } from \"@/hooks/use-sessions\";\nimport { useCategories, useCategoryPriorities, useSetCategoryPriorities } from \"@/hooks/use-products\";\nimport { useRole } from \"@/hooks/use-role\";\nimport { useParams, useLocation } from \"wouter\";\nimport { ArrowLeft, CheckCircle2, Download, Search, Loader2, Filter, Camera, Image, X, FileArchive, Trash2, Plus, Printer, MapPin, User, CalendarDays, CheckSquare, ListOrdered, ArrowUp, ArrowDown, GripVertical } from \"lucide-react\";\nimport { BatchPhotoUpload } from \"@/components/BatchPhotoUpload\";\nimport { useBackgroundUpload } from \"@/components/BackgroundUpload\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { StatusBadge } from \"@/components/StatusBadge\";\nimport { useState, useMemo, useRef, useCallback, useEffect } from \"react\";\nimport { cn, compressImage } from \"@/lib/utils\";\nimport * as XLSX from \"xlsx\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { buildUrl } from \"@shared/routes\";\nimport { api } from \"@shared/routes\";\nimport type { OpnameRecordWithProduct, ProductUnit } from \"@shared/schema\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\n\nexport default function SessionDetail() {\n  const { id } = useParams();\n  const sessionId = parseInt(id!);\n  const [, setLocation] = useLocation();\n  const { data: session, isLoading } = useSession(sessionId);\n  const { data: categories } = useCategories();\n  const { canCount } = useRole();\n  const completeSession = useCompleteSession();\n  const [search, setSearch] = useState(\"\");\n  const [categoryFilter, setCategoryFilter] = useState<string>(\"all\");\n  const [completionDialogOpen, setCompletionDialogOpen] = useState(false);\n  const [downloadDialogOpen, setDownloadDialogOpen] = useState(false);\n  const [categoryPriorityOpen, setCategoryPriorityOpen] = useState(false);\n  const { toast } = useToast();\n  const { data: categoryPriorities } = useCategoryPriorities();\n\n  const isCompleted = session?.status === \"completed\";\n\n  const records = useMemo(() => {\n    if (!session?.records) return [];\n    let filtered = session.records.filter(r => {\n      const searchLower = search.toLowerCase();\n      const matchesSearch = r.product.name.toLowerCase().includes(searchLower) ||\n        r.product.sku.toLowerCase().includes(searchLower) ||\n        (r.product.productCode && r.product.productCode.toLowerCase().includes(searchLower)) ||\n        (r.product.subCategory && r.product.subCategory.toLowerCase().includes(searchLower));\n      const matchesCategory = categoryFilter === \"all\" || r.product.category === categoryFilter;\n      return matchesSearch && matchesCategory;\n    });\n    if (categoryPriorities && categoryPriorities.length > 0) {\n      const priorityMap = new Map(categoryPriorities.map((p: any) => [p.categoryName, p.sortOrder]));\n      filtered = [...filtered].sort((a, b) => {\n        const aPriority = priorityMap.get(a.product.category) ?? 999;\n        const bPriority = priorityMap.get(b.product.category) ?? 999;\n        return aPriority - bPriority;\n      });\n    }\n    return filtered;\n  }, [session?.records, search, categoryFilter, categoryPriorities]);\n\n  const hasPhotos = useMemo(() => {\n    return session?.records?.some(r => r.photoUrl || (r.photos && r.photos.length > 0)) ?? false;\n  }, [session?.records]);\n\n  const stats = useMemo(() => {\n    if (!session?.records) return { total: 0, counted: 0, progress: 0 };\n    const total = session.records.length;\n    const counted = session.records.filter(r => r.actualStock !== null).length;\n    const progress = total > 0 ? Math.round((counted / total) * 100) : 0;\n    return { total, counted, progress };\n  }, [session?.records]);\n\n  const isGudangSession = session?.locationType === \"gudang\";\n\n  const exportToExcel = () => {\n    if (!session?.records) return;\n\n    const data = isGudangSession\n      ? session.records.map(r => ({\n          \"Product Name\": r.product.name,\n          \"Product Code\": r.product.productCode || \"\",\n          \"Unit\": r.product.units?.[0]?.unitName || \"\",\n          \"Category\": r.product.category || \"\",\n          \"Sub Category\": r.product.subCategory || \"\",\n          \"Actual Stock\": r.actualStock ?? 0,\n          \"Notes\": r.notes || \"\",\n        }))\n      : session.records.map(r => ({\n          SKU: r.product.sku,\n          \"Product Name\": r.product.name,\n          Category: r.product.category || \"\",\n          \"Actual Stock\": r.actualStock ?? 0,\n          \"Notes\": r.notes || \"\",\n        }));\n\n    const ws = XLSX.utils.json_to_sheet(data);\n    const wb = XLSX.utils.book_new();\n    XLSX.utils.book_append_sheet(wb, ws, \"Opname Data\");\n    XLSX.writeFile(wb, `${session.title.replace(/\\s+/g, '_')}_Report.xlsx`);\n\n    toast({\n      title: \"Export Successful\",\n      description: \"The Excel file has been downloaded.\",\n    });\n  };\n\n  const downloadPhotosZip = async (options?: { productIds?: number[]; date?: string }) => {\n    try {\n      const url = buildUrl(api.upload.downloadZip.path, { id: sessionId });\n      const res = await fetch(url, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(options || {}),\n        credentials: \"include\",\n      });\n      if (!res.ok) {\n        const err = await res.json();\n        toast({ title: \"Error\", description: err.message || \"Gagal download ZIP\", variant: \"destructive\" });\n        return;\n      }\n      const blob = await res.blob();\n      const downloadUrl = URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = downloadUrl;\n      a.download = `${session?.title?.replace(/\\s+/g, \"_\") || \"photos\"}_Photos.zip`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(downloadUrl);\n      toast({ title: \"Download Berhasil\", description: \"File ZIP telah didownload.\" });\n    } catch {\n      toast({ title: \"Error\", description: \"Gagal download ZIP\", variant: \"destructive\" });\n    }\n  };\n\n  const handleComplete = () => {\n    completeSession.mutate(sessionId, {\n      onSuccess: () => {\n        setCompletionDialogOpen(true);\n      }\n    });\n  };\n\n  const printSummary = () => {\n    window.print();\n  };\n\n  if (isLoading) return <div className=\"p-12 flex justify-center\"><Loader2 className=\"w-8 h-8 animate-spin text-primary\" /></div>;\n  if (!session) return <div className=\"p-12 text-center\">Session not found</div>;\n\n  return (\n    <div className=\"space-y-6 animate-enter pb-12\">\n      <div className=\"flex flex-col lg:flex-row lg:items-center justify-between gap-4\">\n        <div className=\"flex items-center gap-4\">\n          <Button variant=\"outline\" size=\"icon\" onClick={() => setLocation(\"/sessions\")} data-testid=\"button-back\">\n            <ArrowLeft className=\"w-4 h-4\" />\n          </Button>\n          <div>\n            <div className=\"flex items-center gap-3 flex-wrap\">\n              <h1 className=\"text-2xl font-display font-bold text-foreground\" data-testid=\"text-session-title\">{session.title}</h1>\n              <StatusBadge status={session.status} />\n              {session.locationType && (\n                <Badge variant=\"outline\" data-testid=\"badge-location-type\">\n                  <MapPin className=\"w-3 h-3 mr-1\" />\n                  {session.locationType === \"gudang\" ? \"Gudang\" : \"Toko\"}\n                </Badge>\n              )}\n            </div>\n            <div className=\"flex items-center gap-3 flex-wrap mt-1\">\n              <p className=\"text-sm text-muted-foreground\">\n                Started on {new Date(session.startedAt).toLocaleDateString()} | {records.length} items\n              </p>\n              {session.assignedTo && (\n                <span className=\"text-sm text-muted-foreground flex items-center gap-1\" data-testid=\"text-assigned-staff\">\n                  <User className=\"w-3 h-3\" />\n                  {session.assignedTo}\n                </span>\n              )}\n            </div>\n            <div className=\"flex items-center gap-3 mt-2\">\n              <Progress value={stats.progress} className=\"w-40 h-2\" data-testid=\"progress-session\" />\n              <span className=\"text-xs text-muted-foreground\" data-testid=\"text-progress\">{stats.counted}/{stats.total} dihitung ({stats.progress}%)</span>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-3 flex-wrap\">\n          {hasPhotos && (\n            <Button variant=\"outline\" onClick={() => setDownloadDialogOpen(true)} data-testid=\"button-download-zip\">\n              <FileArchive className=\"w-4 h-4 mr-2\" />\n              Download Foto ZIP\n            </Button>\n          )}\n\n          <Button variant=\"outline\" onClick={exportToExcel} data-testid=\"button-export\">\n            <Download className=\"w-4 h-4 mr-2\" />\n            Export Excel\n          </Button>\n\n          {!isCompleted && canCount && (\n            <AlertDialog>\n              <AlertDialogTrigger asChild>\n                <Button className=\"bg-emerald-600 text-white\" data-testid=\"button-finalize\">\n                  <CheckCircle2 className=\"w-4 h-4 mr-2\" />\n                  Finalize Session\n                </Button>\n              </AlertDialogTrigger>\n              <AlertDialogContent>\n                <AlertDialogHeader>\n                  <AlertDialogTitle>Finalize Stock Opname?</AlertDialogTitle>\n                  <AlertDialogDescription>\n                    This will mark the session as completed. Ensure all counts are entered correctly.\n                  </AlertDialogDescription>\n                </AlertDialogHeader>\n                <div className=\"py-3 space-y-2 text-sm\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Total Produk</span>\n                    <span className=\"font-medium\">{stats.total}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Sudah Dihitung</span>\n                    <span className=\"font-medium\">{stats.counted}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Belum Dihitung</span>\n                    <span className=\"font-medium text-amber-600\">{stats.total - stats.counted}</span>\n                  </div>\n                </div>\n                <AlertDialogFooter>\n                  <AlertDialogCancel>Cancel</AlertDialogCancel>\n                  <AlertDialogAction onClick={handleComplete} className=\"bg-emerald-600\" data-testid=\"button-confirm-finalize\">\n                    Confirm & Complete\n                  </AlertDialogAction>\n                </AlertDialogFooter>\n              </AlertDialogContent>\n            </AlertDialog>\n          )}\n        </div>\n      </div>\n\n      <div className=\"flex flex-col md:flex-row gap-3 items-stretch md:items-center\">\n        <div className=\"relative max-w-md flex-1\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search by SKU or Name...\"\n            className=\"pl-9 bg-white\"\n            value={search}\n            onChange={(e) => setSearch(e.target.value)}\n            data-testid=\"input-search-records\"\n          />\n        </div>\n        <Select value={categoryFilter} onValueChange={setCategoryFilter}>\n          <SelectTrigger className=\"w-40 bg-white\" data-testid=\"select-session-category-filter\">\n            <Filter className=\"w-4 h-4 mr-2 text-muted-foreground\" />\n            <SelectValue placeholder=\"All Categories\" />\n          </SelectTrigger>\n          <SelectContent className=\"bg-card border border-border\">\n            <SelectItem value=\"all\">All Categories</SelectItem>\n            {categories?.map(cat => (\n              <SelectItem key={cat} value={cat}>{cat}</SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n        <Button variant=\"outline\" size=\"sm\" onClick={() => setCategoryPriorityOpen(true)} data-testid=\"button-session-category-priority\">\n          <ListOrdered className=\"w-4 h-4 mr-2\" />\n          Urutan Kategori\n        </Button>\n      </div>\n\n      <SessionCategoryPriorityDialog\n        open={categoryPriorityOpen}\n        onOpenChange={setCategoryPriorityOpen}\n        categories={categories ?? []}\n      />\n\n      <div className=\"bg-card border border-border/50 rounded-2xl shadow-sm overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full text-left text-sm\">\n            <thead className=\"bg-muted/30 border-b border-border/50\">\n              <tr>\n                <th className=\"px-6 py-4 font-medium text-muted-foreground w-[15%]\">{isGudangSession ? \"Kode Produk\" : \"SKU\"}</th>\n                <th className=\"px-6 py-4 font-medium text-muted-foreground w-[20%]\">Produk</th>\n                <th className=\"px-6 py-4 font-medium text-muted-foreground w-[10%]\">Kategori</th>\n                <th className=\"px-6 py-4 font-medium text-muted-foreground w-[22%] text-center\">Jumlah Aktual</th>\n                <th className=\"px-6 py-4 font-medium text-muted-foreground w-[23%] text-center\">Foto</th>\n                <th className=\"px-6 py-4 font-medium text-muted-foreground w-[10%]\">Status</th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-border/50\">\n              {records.map((record) => (\n                <RecordRow\n                  key={record.id}\n                  record={record}\n                  sessionId={sessionId}\n                  readOnly={isCompleted || !canCount}\n                  isGudang={session.locationType === \"gudang\"}\n                />\n              ))}\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      <Dialog open={completionDialogOpen} onOpenChange={setCompletionDialogOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Session Selesai</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-2\">\n            <div className=\"flex items-center gap-3\">\n              <CheckCircle2 className=\"w-8 h-8 text-emerald-500\" />\n              <div>\n                <p className=\"font-medium text-foreground\">Stock opname telah selesai</p>\n                <p className=\"text-sm text-muted-foreground\">{session.title}</p>\n              </div>\n            </div>\n\n            <div className=\"space-y-2 text-sm border-t pt-3\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">Total Produk</span>\n                <span className=\"font-medium\" data-testid=\"text-summary-total\">{stats.total}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">Sudah Dihitung</span>\n                <span className=\"font-medium\" data-testid=\"text-summary-counted\">{stats.counted}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">Belum Dihitung</span>\n                <span className=\"font-medium text-amber-600\" data-testid=\"text-summary-uncounted\">{stats.total - stats.counted}</span>\n              </div>\n            </div>\n\n            <div className=\"flex flex-col gap-2 pt-2\">\n              {hasPhotos && (\n                <Button variant=\"outline\" onClick={() => { setCompletionDialogOpen(false); setDownloadDialogOpen(true); }} className=\"w-full\" data-testid=\"button-completion-download-zip\">\n                  <FileArchive className=\"w-4 h-4 mr-2\" />\n                  Download Foto ZIP\n                </Button>\n              )}\n              <Button variant=\"outline\" onClick={exportToExcel} className=\"w-full\" data-testid=\"button-completion-export\">\n                <Download className=\"w-4 h-4 mr-2\" />\n                Export Excel\n              </Button>\n              <Button variant=\"outline\" onClick={printSummary} className=\"w-full\" data-testid=\"button-completion-print\">\n                <Printer className=\"w-4 h-4 mr-2\" />\n                Print Summary\n              </Button>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button onClick={() => setCompletionDialogOpen(false)} data-testid=\"button-completion-close\">\n              Tutup\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <DownloadDialog\n        open={downloadDialogOpen}\n        onOpenChange={setDownloadDialogOpen}\n        records={session?.records ?? []}\n        onDownload={downloadPhotosZip}\n      />\n    </div>\n  );\n}\n\nfunction DownloadDialog({ open, onOpenChange, records, onDownload }: {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  records: OpnameRecordWithProduct[];\n  onDownload: (options?: { productIds?: number[]; date?: string }) => Promise<void>;\n}) {\n  const [mode, setMode] = useState<\"all\" | \"products\" | \"date\">(\"all\");\n  const [selectedProducts, setSelectedProducts] = useState<number[]>([]);\n  const [selectedDate, setSelectedDate] = useState(\"\");\n  const [isDownloading, setIsDownloading] = useState(false);\n\n  const productsWithPhotos = useMemo(() => {\n    return records\n      .filter(r => (r.photos && r.photos.length > 0) || r.photoUrl)\n      .map(r => ({ id: r.productId, name: r.product.name, sku: r.product.sku }))\n      .filter((v, i, a) => a.findIndex(t => t.id === v.id) === i);\n  }, [records]);\n\n  const photoDates = useMemo(() => {\n    const dates = new Set<string>();\n    for (const r of records) {\n      if (r.photos) {\n        for (const p of r.photos) {\n          dates.add(new Date(p.createdAt).toISOString().split(\"T\")[0]);\n        }\n      }\n    }\n    return Array.from(dates).sort().reverse();\n  }, [records]);\n\n  const toggleProduct = (id: number) => {\n    setSelectedProducts(prev =>\n      prev.includes(id) ? prev.filter(p => p !== id) : [...prev, id]\n    );\n  };\n\n  const selectAllProducts = () => {\n    if (selectedProducts.length === productsWithPhotos.length) {\n      setSelectedProducts([]);\n    } else {\n      setSelectedProducts(productsWithPhotos.map(p => p.id));\n    }\n  };\n\n  const handleDownload = async () => {\n    setIsDownloading(true);\n    try {\n      if (mode === \"products\" && selectedProducts.length > 0) {\n        await onDownload({ productIds: selectedProducts });\n      } else if (mode === \"date\" && selectedDate) {\n        await onDownload({ date: selectedDate });\n      } else {\n        await onDownload();\n      }\n      onOpenChange(false);\n    } finally {\n      setIsDownloading(false);\n    }\n  };\n\n  const canDownload = mode === \"all\" || (mode === \"products\" && selectedProducts.length > 0) || (mode === \"date\" && selectedDate);\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-lg\">\n        <DialogHeader>\n          <DialogTitle>Download Foto ZIP</DialogTitle>\n        </DialogHeader>\n        <div className=\"space-y-4 py-2\">\n          <div className=\"space-y-2\">\n            <label className=\"text-sm font-medium text-foreground\">Pilih mode download:</label>\n            <Select value={mode} onValueChange={(v) => setMode(v as \"all\" | \"products\" | \"date\")}>\n              <SelectTrigger data-testid=\"select-download-mode\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent className=\"bg-card border border-border\">\n                <SelectItem value=\"all\" data-testid=\"option-download-all\">Semua Foto</SelectItem>\n                <SelectItem value=\"products\" data-testid=\"option-download-products\">Pilih Produk</SelectItem>\n                <SelectItem value=\"date\" data-testid=\"option-download-date\">Pilih Tanggal</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          {mode === \"products\" && (\n            <div className=\"space-y-2\">\n              <div className=\"flex items-center justify-between\">\n                <label className=\"text-sm font-medium text-foreground\">Pilih produk:</label>\n                <Button variant=\"ghost\" size=\"sm\" onClick={selectAllProducts} data-testid=\"button-select-all-products\">\n                  <CheckSquare className=\"w-3 h-3 mr-1\" />\n                  {selectedProducts.length === productsWithPhotos.length ? \"Batal Semua\" : \"Pilih Semua\"}\n                </Button>\n              </div>\n              <div className=\"max-h-60 overflow-y-auto space-y-1 border rounded-md p-2\">\n                {productsWithPhotos.map(p => (\n                  <label\n                    key={p.id}\n                    className=\"flex items-center gap-2 p-2 rounded-md cursor-pointer hover-elevate\"\n                    data-testid={`checkbox-product-${p.id}`}\n                  >\n                    <input\n                      type=\"checkbox\"\n                      checked={selectedProducts.includes(p.id)}\n                      onChange={() => toggleProduct(p.id)}\n                      className=\"rounded\"\n                    />\n                    <span className=\"text-sm\">{p.name}</span>\n                    <span className=\"text-xs text-muted-foreground ml-auto\">{p.sku}</span>\n                  </label>\n                ))}\n                {productsWithPhotos.length === 0 && (\n                  <p className=\"text-sm text-muted-foreground text-center py-4\">Tidak ada produk dengan foto</p>\n                )}\n              </div>\n              {selectedProducts.length > 0 && (\n                <p className=\"text-xs text-muted-foreground\">{selectedProducts.length} produk dipilih</p>\n              )}\n            </div>\n          )}\n\n          {mode === \"date\" && (\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium text-foreground\">Pilih tanggal:</label>\n              {photoDates.length > 0 ? (\n                <div className=\"space-y-1 border rounded-md p-2\">\n                  {photoDates.map(d => (\n                    <label\n                      key={d}\n                      className=\"flex items-center gap-2 p-2 rounded-md cursor-pointer hover-elevate\"\n                      data-testid={`radio-date-${d}`}\n                    >\n                      <input\n                        type=\"radio\"\n                        name=\"download-date\"\n                        checked={selectedDate === d}\n                        onChange={() => setSelectedDate(d)}\n                      />\n                      <CalendarDays className=\"w-3 h-3 text-muted-foreground\" />\n                      <span className=\"text-sm\">{new Date(d).toLocaleDateString(\"id-ID\", { weekday: \"long\", year: \"numeric\", month: \"long\", day: \"numeric\" })}</span>\n                    </label>\n                  ))}\n                </div>\n              ) : (\n                <p className=\"text-sm text-muted-foreground text-center py-4\">Tidak ada tanggal foto tersedia</p>\n              )}\n            </div>\n          )}\n        </div>\n        <DialogFooter className=\"gap-2\">\n          <Button variant=\"outline\" onClick={() => onOpenChange(false)} data-testid=\"button-cancel-download\">\n            Batal\n          </Button>\n          <Button onClick={handleDownload} disabled={!canDownload || isDownloading} data-testid=\"button-confirm-download\">\n            {isDownloading ? <Loader2 className=\"w-4 h-4 animate-spin mr-2\" /> : <FileArchive className=\"w-4 h-4 mr-2\" />}\n            Download\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nfunction RecordRow({ record, sessionId, readOnly, isGudang }: { record: OpnameRecordWithProduct; sessionId: number; readOnly: boolean; isGudang: boolean }) {\n  const updateRecord = useUpdateRecord();\n  const uploadPhoto = useUploadRecordPhoto();\n  const deletePhoto = useDeleteRecordPhoto();\n  const uploadLegacyPhoto = useUploadOpnamePhoto();\n  const [actual, setActual] = useState(record.actualStock?.toString() ?? \"\");\n  const [isFocused, setIsFocused] = useState(false);\n  const [lightboxOpen, setLightboxOpen] = useState(false);\n  const [lightboxIndex, setLightboxIndex] = useState(0);\n\n  const productUnits = record.product.units ?? [];\n  const hasUnits = isGudang && productUnits.length > 0;\n\n  const parseExistingUnitValues = useCallback((): Record<string, number> => {\n    if (!record.unitValues) return {};\n    try {\n      return JSON.parse(record.unitValues);\n    } catch {\n      return {};\n    }\n  }, [record.unitValues]);\n\n  const [unitInputs, setUnitInputs] = useState<Record<string, string>>(() => {\n    const existing = parseExistingUnitValues();\n    const result: Record<string, string> = {};\n    productUnits.forEach(u => {\n      result[u.unitName] = existing[u.unitName]?.toString() ?? \"\";\n    });\n    return result;\n  });\n\n  useEffect(() => {\n    if (hasUnits) {\n      const existing = parseExistingUnitValues();\n      const result: Record<string, string> = {};\n      productUnits.forEach(u => {\n        result[u.unitName] = existing[u.unitName]?.toString() ?? \"\";\n      });\n      setUnitInputs(result);\n    }\n  }, [record.unitValues, hasUnits]);\n\n  const computedTotal = useMemo(() => {\n    if (!hasUnits) return 0;\n    let total = 0;\n    productUnits.forEach(u => {\n      const val = parseFloat(unitInputs[u.unitName] || \"0\");\n      if (!isNaN(val)) {\n        total += val * u.conversionToBase;\n      }\n    });\n    return Math.round(total);\n  }, [unitInputs, productUnits, hasUnits]);\n\n  const baseUnitName = useMemo(() => {\n    if (productUnits.length > 0) return productUnits[0].baseUnit;\n    return \"pcs\";\n  }, [productUnits]);\n\n  const allPhotos = record.photos ?? [];\n\n  const handleBlur = () => {\n    setIsFocused(false);\n    if (hasUnits) return;\n    const val = parseInt(actual);\n    if (!isNaN(val) && val !== record.actualStock) {\n      updateRecord.mutate({\n        sessionId,\n        productId: record.productId,\n        actualStock: val\n      });\n    }\n  };\n\n  const handleUnitBlur = () => {\n    setIsFocused(false);\n    const unitValues: Record<string, number> = {};\n    let anyFilled = false;\n    productUnits.forEach(u => {\n      const val = parseFloat(unitInputs[u.unitName] || \"0\");\n      if (!isNaN(val) && val > 0) {\n        unitValues[u.unitName] = val;\n        anyFilled = true;\n      }\n    });\n\n    if (anyFilled) {\n      updateRecord.mutate({\n        sessionId,\n        productId: record.productId,\n        actualStock: computedTotal,\n        unitValues: JSON.stringify(unitValues),\n      });\n    }\n  };\n\n  const [batchPhotoOpen, setBatchPhotoOpen] = useState(false);\n  const { addUploadJob } = useBackgroundUpload();\n\n  const handleBatchUpload = useCallback(async (files: File[]) => {\n    const sid = sessionId;\n    const pid = record.productId;\n    const label = record.product.name;\n    addUploadJob(label, files, (file) => {\n      return new Promise<void>((resolve, reject) => {\n        uploadPhoto.mutate(\n          { sessionId: sid, productId: pid, file },\n          { onSuccess: () => resolve(), onError: (err) => reject(err) }\n        );\n      });\n    });\n  }, [uploadPhoto, sessionId, record.productId, record.product.name, addUploadJob]);\n\n  const handleDeletePhoto = (photoId: number) => {\n    deletePhoto.mutate({\n      sessionId,\n      productId: record.productId,\n      photoId,\n    });\n  };\n\n  const openLightbox = (index: number) => {\n    setLightboxIndex(index);\n    setLightboxOpen(true);\n  };\n\n  const formatNumber = (n: number) => n.toLocaleString(\"id-ID\");\n\n  return (\n    <>\n      <tr className={cn(\"transition-colors\", isFocused ? \"bg-blue-50/50\" : \"hover:bg-muted/10\")} data-testid={`row-record-${record.id}`}>\n        <td className=\"px-6 py-4 font-mono text-muted-foreground\">{isGudang && record.product.productCode ? record.product.productCode : record.product.sku}</td>\n        <td className=\"px-6 py-4\">\n          <div className=\"flex items-center gap-2\">\n            {record.product.photos && record.product.photos.length > 0 ? (\n              <img\n                src={record.product.photos[0].url}\n                alt={record.product.name}\n                className=\"w-8 h-8 rounded-md object-cover flex-shrink-0\"\n                loading=\"lazy\"\n                onError={(e) => { e.currentTarget.style.display = 'none'; e.currentTarget.nextElementSibling?.classList.remove('hidden'); }}\n                data-testid={`img-product-photo-${record.productId}`}\n              />\n            ) : null}\n            <div className={cn(\"w-8 h-8 rounded-md bg-muted/30 flex items-center justify-center flex-shrink-0\", record.product.photos && record.product.photos.length > 0 ? \"hidden\" : \"\")} data-testid={`img-product-placeholder-${record.productId}`}>\n              <Image className=\"w-4 h-4 text-muted-foreground/50\" />\n            </div>\n            <span className=\"font-medium text-foreground\">{record.product.name}</span>\n          </div>\n        </td>\n        <td className=\"px-6 py-4 text-muted-foreground\">{record.product.category || \"-\"}</td>\n        <td className=\"px-6 py-3\">\n          {readOnly ? (\n            <div className=\"text-center\">\n              <div className=\"font-bold text-foreground py-2 px-3 bg-muted/20 rounded-lg\">\n                {record.actualStock !== null ? formatNumber(record.actualStock) : \"-\"}\n              </div>\n              {hasUnits && record.unitValues && (\n                <div className=\"mt-1 text-xs text-muted-foreground\">\n                  {Object.entries(parseExistingUnitValues()).map(([name, val]) => (\n                    <span key={name} className=\"mr-2\">{val} {name}</span>\n                  ))}\n                </div>\n              )}\n            </div>\n          ) : hasUnits ? (\n            <div className=\"space-y-1\">\n              <div className=\"flex flex-col gap-1\">\n                {productUnits.map(u => (\n                  <div key={u.id} className=\"flex items-center gap-2\">\n                    <Input\n                      type=\"number\"\n                      className=\"w-20 text-center text-sm\"\n                      placeholder=\"0\"\n                      value={unitInputs[u.unitName] || \"\"}\n                      onChange={(e) => setUnitInputs(prev => ({ ...prev, [u.unitName]: e.target.value }))}\n                      onFocus={() => setIsFocused(true)}\n                      onBlur={handleUnitBlur}\n                      disabled={updateRecord.isPending}\n                      data-testid={`input-unit-${record.productId}-${u.unitName}`}\n                    />\n                    <span className=\"text-xs text-muted-foreground whitespace-nowrap\">{u.unitName}</span>\n                  </div>\n                ))}\n              </div>\n              <div className=\"text-xs text-muted-foreground text-center\" data-testid={`text-total-${record.productId}`}>\n                Total: {formatNumber(computedTotal)} {baseUnitName}\n              </div>\n            </div>\n          ) : (\n            <div className=\"flex justify-center\">\n              <Input\n                type=\"number\"\n                className={cn(\n                  \"w-24 text-center font-bold transition-all\",\n                  actual !== \"\" && \"border-primary/50 bg-primary/5 text-primary\"\n                )}\n                placeholder=\"-\"\n                value={actual}\n                onChange={(e) => setActual(e.target.value)}\n                onFocus={() => setIsFocused(true)}\n                onBlur={handleBlur}\n                disabled={updateRecord.isPending}\n                data-testid={`input-count-${record.productId}`}\n              />\n            </div>\n          )}\n        </td>\n        <td className=\"px-6 py-3\">\n          <div className=\"flex items-center justify-center gap-1 flex-wrap\">\n            {allPhotos.length > 0 ? (\n              allPhotos.map((photo, idx) => (\n                <div key={photo.id} className=\"relative group\">\n                  <button\n                    onClick={() => openLightbox(idx)}\n                    className=\"cursor-pointer\"\n                    data-testid={`button-view-photo-${record.productId}-${photo.id}`}\n                  >\n                    <img\n                      src={photo.url}\n                      alt={`Foto ${record.product.name} ${idx + 1}`}\n                      className=\"w-9 h-9 rounded-md object-cover border border-border/50\"\n                    />\n                    <div className=\"absolute inset-0 bg-black/40 rounded-md opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center\">\n                      <Image className=\"w-3 h-3 text-white\" />\n                    </div>\n                  </button>\n                  {!readOnly && (\n                    <button\n                      onClick={() => handleDeletePhoto(photo.id)}\n                      className=\"absolute -top-1 -right-1 w-4 h-4 bg-destructive text-white rounded-full flex items-center justify-center invisible group-hover:visible\"\n                      data-testid={`button-delete-photo-${record.productId}-${photo.id}`}\n                    >\n                      <X className=\"w-2.5 h-2.5\" />\n                    </button>\n                  )}\n                </div>\n              ))\n            ) : record.photoUrl ? (\n              <button\n                onClick={() => { setLightboxIndex(0); setLightboxOpen(true); }}\n                className=\"relative group cursor-pointer\"\n                data-testid={`button-view-photo-${record.productId}`}\n              >\n                <img\n                  src={record.photoUrl}\n                  alt={`Foto ${record.product.name}`}\n                  className=\"w-9 h-9 rounded-md object-cover border border-border/50\"\n                />\n                <div className=\"absolute inset-0 bg-black/40 rounded-md opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center\">\n                  <Image className=\"w-3 h-3 text-white\" />\n                </div>\n              </button>\n            ) : (\n              <div className=\"w-9 h-9 rounded-md border border-dashed border-border/50 flex items-center justify-center text-muted-foreground/30\">\n                <Camera className=\"w-4 h-4\" />\n              </div>\n            )}\n            {!readOnly && (\n              <Button\n                variant=\"outline\"\n                size=\"icon\"\n                onClick={() => setBatchPhotoOpen(true)}\n                data-testid={`button-batch-photo-${record.productId}`}\n              >\n                <Camera className=\"w-4 h-4\" />\n              </Button>\n            )}\n          </div>\n        </td>\n        <td className=\"px-6 py-4\">\n          {record.actualStock !== null ? (\n            <CheckCircle2 className=\"w-5 h-5 text-emerald-500 mx-auto\" />\n          ) : (\n            <div className=\"w-2 h-2 rounded-full bg-muted-foreground/20 mx-auto\" />\n          )}\n        </td>\n      </tr>\n\n      <Dialog open={lightboxOpen} onOpenChange={setLightboxOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Foto Opname - {record.product.name}</DialogTitle>\n          </DialogHeader>\n          {allPhotos.length > 0 ? (\n            <div className=\"space-y-3\">\n              <img\n                src={allPhotos[lightboxIndex]?.url}\n                alt={`Foto ${record.product.name}`}\n                className=\"w-full rounded-lg object-contain max-h-[60vh]\"\n                data-testid={`img-preview-${record.productId}`}\n              />\n              {allPhotos.length > 1 && (\n                <div className=\"flex items-center justify-center gap-2 flex-wrap\">\n                  {allPhotos.map((photo, idx) => (\n                    <button\n                      key={photo.id}\n                      onClick={() => setLightboxIndex(idx)}\n                      className={cn(\n                        \"w-12 h-12 rounded-md object-cover border-2 overflow-hidden cursor-pointer\",\n                        idx === lightboxIndex ? \"border-primary\" : \"border-border/50\"\n                      )}\n                      data-testid={`button-lightbox-thumb-${photo.id}`}\n                    >\n                      <img src={photo.url} alt=\"\" className=\"w-full h-full object-cover\" />\n                    </button>\n                  ))}\n                </div>\n              )}\n            </div>\n          ) : record.photoUrl ? (\n            <img\n              src={record.photoUrl}\n              alt={`Foto ${record.product.name}`}\n              className=\"w-full rounded-lg object-contain max-h-[60vh]\"\n              data-testid={`img-preview-${record.productId}`}\n            />\n          ) : null}\n        </DialogContent>\n      </Dialog>\n\n      <BatchPhotoUpload\n        open={batchPhotoOpen}\n        onOpenChange={setBatchPhotoOpen}\n        onUpload={handleBatchUpload}\n        title={`Foto Opname - ${record.product.name}`}\n      />\n    </>\n  );\n}\n\nfunction SessionCategoryPriorityDialog({ open, onOpenChange, categories }: {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  categories: string[];\n}) {\n  const { data: priorities, isLoading } = useCategoryPriorities();\n  const setCategoryPriorities = useSetCategoryPriorities();\n  const [orderedCategories, setOrderedCategories] = useState<string[]>([]);\n\n  useEffect(() => {\n    if (!open || categories.length === 0) return;\n    if (priorities && priorities.length > 0) {\n      const priorityMap = new Map(priorities.map((p: any) => [p.categoryName, p.sortOrder]));\n      const sorted = [...categories].sort((a, b) => {\n        const aPriority = priorityMap.get(a) ?? 999;\n        const bPriority = priorityMap.get(b) ?? 999;\n        return aPriority - bPriority;\n      });\n      setOrderedCategories(sorted);\n    } else if (!isLoading) {\n      setOrderedCategories([...categories]);\n    }\n  }, [open, categories, priorities, isLoading]);\n\n  const moveUp = (index: number) => {\n    if (index === 0) return;\n    const newOrder = [...orderedCategories];\n    [newOrder[index - 1], newOrder[index]] = [newOrder[index], newOrder[index - 1]];\n    setOrderedCategories(newOrder);\n  };\n\n  const moveDown = (index: number) => {\n    if (index === orderedCategories.length - 1) return;\n    const newOrder = [...orderedCategories];\n    [newOrder[index], newOrder[index + 1]] = [newOrder[index + 1], newOrder[index]];\n    setOrderedCategories(newOrder);\n  };\n\n  const handleSave = () => {\n    const priorityData = orderedCategories.map((cat, i) => ({\n      categoryName: cat,\n      sortOrder: i,\n    }));\n    setCategoryPriorities.mutate(priorityData, {\n      onSuccess: () => onOpenChange(false),\n    });\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-md\">\n        <DialogHeader>\n          <DialogTitle>Urutan Prioritas Kategori</DialogTitle>\n        </DialogHeader>\n        <div className=\"space-y-2 py-2\">\n          <p className=\"text-sm text-muted-foreground\">Atur urutan prioritas kategori. Kategori di atas akan ditampilkan lebih dulu saat stock opname.</p>\n          {isLoading ? (\n            <div className=\"flex justify-center py-4\">\n              <Loader2 className=\"w-5 h-5 animate-spin text-muted-foreground\" />\n            </div>\n          ) : orderedCategories.length === 0 ? (\n            <p className=\"text-sm text-muted-foreground text-center py-4\">Tidak ada kategori</p>\n          ) : (\n            <div className=\"space-y-1 max-h-80 overflow-y-auto\">\n              {orderedCategories.map((cat, index) => (\n                <div\n                  key={cat}\n                  className=\"flex items-center gap-2 p-2 rounded-md border border-border/50\"\n                  data-testid={`session-category-priority-${index}`}\n                >\n                  <GripVertical className=\"w-4 h-4 text-muted-foreground/50 shrink-0\" />\n                  <span className=\"text-sm font-medium flex-1\">{cat}</span>\n                  <Badge variant=\"secondary\" className=\"no-default-hover-elevate no-default-active-elevate text-xs\">\n                    #{index + 1}\n                  </Badge>\n                  <Button variant=\"ghost\" size=\"icon\" onClick={() => moveUp(index)} disabled={index === 0} data-testid={`button-session-move-up-${index}`}>\n                    <ArrowUp className=\"w-3 h-3\" />\n                  </Button>\n                  <Button variant=\"ghost\" size=\"icon\" onClick={() => moveDown(index)} disabled={index === orderedCategories.length - 1} data-testid={`button-session-move-down-${index}`}>\n                    <ArrowDown className=\"w-3 h-3\" />\n                  </Button>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={() => onOpenChange(false)}>Batal</Button>\n          <Button onClick={handleSave} disabled={setCategoryPriorities.isPending}>\n            {setCategoryPriorities.isPending && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n            Simpan Urutan\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":41458,"size_tokens":null},"client/src/hooks/use-role.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { api } from \"@shared/routes\";\n\nexport type Role = \"admin\" | \"sku_manager\" | \"stock_counter\" | \"stock_counter_toko\" | \"stock_counter_gudang\";\n\nexport function useRole() {\n  const { data, isLoading } = useQuery({\n    queryKey: [api.roles.me.path],\n    queryFn: async () => {\n      const res = await fetch(api.roles.me.path, { credentials: \"include\" });\n      if (!res.ok) return null;\n      return res.json();\n    },\n  });\n\n  const role = (data?.role || \"stock_counter\") as Role;\n\n  const isAdmin = role === \"admin\";\n  const isSKUManager = role === \"sku_manager\";\n  const canManageSku = isAdmin || isSKUManager;\n  const canCountToko = isAdmin || role === \"stock_counter\" || role === \"stock_counter_toko\";\n  const canCountGudang = isAdmin || role === \"stock_counter\" || role === \"stock_counter_gudang\";\n  const canCount = isAdmin || role === \"stock_counter\" || role === \"stock_counter_toko\" || role === \"stock_counter_gudang\";\n\n  const canCountLocation = (locationType: string) => {\n    if (isAdmin || role === \"stock_counter\") return true;\n    if (locationType === \"toko\" && role === \"stock_counter_toko\") return true;\n    if (locationType === \"gudang\" && role === \"stock_counter_gudang\") return true;\n    return false;\n  };\n\n  return {\n    role,\n    isLoading,\n    isAdmin,\n    isSKUManager,\n    canManageSku,\n    canCount,\n    canCountToko,\n    canCountGudang,\n    canCountLocation,\n  };\n}\n","path":null,"size_bytes":1448,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/pages/Announcements.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { useAnnouncements, useCreateAnnouncement, useUpdateAnnouncement, useDeleteAnnouncement, useUploadAnnouncementImage } from \"@/hooks/use-announcements\";\nimport { useRole } from \"@/hooks/use-role\";\nimport { Megaphone, Plus, Pencil, Trash2, Calendar, Loader2, ImagePlus, X } from \"lucide-react\";\nimport { compressImage } from \"@/lib/utils\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useForm } from \"react-hook-form\";\nimport { z } from \"zod\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertAnnouncementSchema } from \"@shared/schema\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport { format } from \"date-fns\";\n\nconst createFormSchema = insertAnnouncementSchema.omit({ userId: true }).extend({\n  expiresAt: z.string().optional().nullable(),\n});\n\nexport default function Announcements() {\n  const { data: announcements, isLoading } = useAnnouncements();\n  const { role } = useRole();\n  const [isCreateOpen, setIsCreateOpen] = useState(false);\n  const [editingId, setEditingId] = useState<number | null>(null);\n\n  const isAdmin = role === \"admin\";\n  \n  const sortedAnnouncements = announcements ? [...announcements].sort((a, b) => {\n    return new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime();\n  }) : [];\n\n  return (\n    <div className=\"space-y-8 animate-enter\">\n      <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-3xl font-display font-bold text-foreground flex items-center gap-3\">\n            <Megaphone className=\"w-8 h-8 text-primary\" />\n            Pengumuman\n          </h1>\n          <p className=\"text-muted-foreground mt-2\">Kelola pengumuman untuk tim.</p>\n        </div>\n        {isAdmin && (\n          <CreateAnnouncementDialog open={isCreateOpen} onOpenChange={setIsCreateOpen} />\n        )}\n      </div>\n\n      {isLoading ? (\n        <div className=\"flex justify-center py-12\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n        </div>\n      ) : sortedAnnouncements.length === 0 ? (\n        <div className=\"text-center py-16\">\n          <Megaphone className=\"w-16 h-16 mx-auto text-muted-foreground/30 mb-4\" />\n          <h3 className=\"text-lg font-semibold text-foreground\">Belum ada pengumuman</h3>\n          <p className=\"text-muted-foreground mt-1\">Mulai membuat pengumuman untuk tim Anda.</p>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {sortedAnnouncements.map((announcement) =>\n            editingId === announcement.id ? (\n              <EditAnnouncementCard\n                key={announcement.id}\n                announcement={announcement}\n                onCancel={() => setEditingId(null)}\n                onSaved={() => setEditingId(null)}\n              />\n            ) : (\n              <AnnouncementCard\n                key={announcement.id}\n                announcement={announcement}\n                onEdit={() => setEditingId(announcement.id)}\n              />\n            )\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction AnnouncementCard({ announcement, onEdit }: { announcement: any; onEdit: () => void }) {\n  const isExpired = announcement.expiresAt && new Date(announcement.expiresAt) < new Date();\n  const { role } = useRole();\n  const isAdmin = role === \"admin\";\n\n  return (\n    <Card className=\"flex flex-col overflow-visible hover-elevate\" data-testid={`card-announcement-${announcement.id}`}>\n      {announcement.imageUrl && (\n        <div className=\"w-full aspect-video overflow-hidden rounded-t-md\">\n          <img\n            src={announcement.imageUrl}\n            alt={announcement.title}\n            className=\"w-full h-full object-cover\"\n            data-testid={`img-announcement-${announcement.id}`}\n          />\n        </div>\n      )}\n      <div className=\"p-6 flex flex-col flex-1\">\n        <div className=\"flex items-start justify-between gap-3 mb-3\">\n          <h3 className=\"font-display font-bold text-lg text-foreground flex-1 break-words\">{announcement.title}</h3>\n          {isAdmin && (\n            <div className=\"flex items-center gap-1 shrink-0\">\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"text-muted-foreground\"\n                onClick={onEdit}\n                data-testid={`button-edit-announcement-${announcement.id}`}\n              >\n                <Pencil className=\"w-4 h-4\" />\n              </Button>\n              <DeleteAnnouncementButton id={announcement.id} title={announcement.title} />\n            </div>\n          )}\n        </div>\n\n        <p className=\"text-foreground whitespace-pre-wrap break-words mb-4 flex-1\">{announcement.content}</p>\n\n        <div className=\"space-y-2 pt-4 border-t border-border/50\">\n          <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n            <Calendar className=\"w-4 h-4\" />\n            <span>Dibuat: {format(new Date(announcement.createdAt), \"dd MMM yyyy HH:mm\")}</span>\n          </div>\n          {announcement.expiresAt && (\n            <div className=\"flex items-center gap-2\">\n              <Calendar className=\"w-4 h-4 text-muted-foreground\" />\n              <span className={`text-sm ${isExpired ? \"text-destructive\" : \"text-muted-foreground\"}`}>\n                Berlaku sampai: {format(new Date(announcement.expiresAt), \"dd MMM yyyy\")}\n              </span>\n              {isExpired && (\n                <Badge variant=\"destructive\" className=\"text-xs ml-auto\">\n                  Expired\n                </Badge>\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n    </Card>\n  );\n}\n\nfunction EditAnnouncementCard({ announcement, onCancel, onSaved }: { announcement: any; onCancel: () => void; onSaved: () => void }) {\n  const [title, setTitle] = useState(announcement.title);\n  const [content, setContent] = useState(announcement.content);\n  const [expiresAt, setExpiresAt] = useState(announcement.expiresAt ? new Date(announcement.expiresAt).toISOString().split('T')[0] : \"\");\n  const updateAnnouncement = useUpdateAnnouncement();\n  const uploadImage = useUploadAnnouncementImage();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const handleSave = () => {\n    updateAnnouncement.mutate(\n      { id: announcement.id, title, content, expiresAt: expiresAt ? expiresAt : undefined },\n      { onSuccess: onSaved }\n    );\n  };\n\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n    try {\n      const compressed = await compressImage(file);\n      uploadImage.mutate({ id: announcement.id, file: compressed });\n    } catch {\n      uploadImage.mutate({ id: announcement.id, file });\n    }\n    if (fileInputRef.current) fileInputRef.current.value = \"\";\n  };\n\n  const handleRemoveImage = () => {\n    updateAnnouncement.mutate({ id: announcement.id, imageUrl: null } as any);\n  };\n\n  return (\n    <Card className=\"flex flex-col p-6 bg-primary/5 border-primary/20\" data-testid={`card-edit-announcement-${announcement.id}`}>\n      <div className=\"space-y-4 flex-1\">\n        <div>\n          <label className=\"text-sm font-medium text-foreground\">Judul</label>\n          <Input\n            value={title}\n            onChange={(e) => setTitle(e.target.value)}\n            className=\"bg-white dark:bg-background mt-1\"\n            data-testid={`input-edit-title-${announcement.id}`}\n          />\n        </div>\n\n        <div>\n          <label className=\"text-sm font-medium text-foreground\">Isi Pengumuman</label>\n          <Textarea\n            value={content}\n            onChange={(e) => setContent(e.target.value)}\n            className=\"bg-white dark:bg-background mt-1 min-h-[120px]\"\n            data-testid={`input-edit-content-${announcement.id}`}\n          />\n        </div>\n\n        <div>\n          <label className=\"text-sm font-medium text-foreground\">Gambar (Opsional)</label>\n          <div className=\"mt-1 space-y-2\">\n            {announcement.imageUrl && (\n              <div className=\"relative inline-block\">\n                <img src={announcement.imageUrl} alt=\"Preview\" className=\"w-full max-h-40 object-cover rounded-md\" />\n                <Button\n                  variant=\"secondary\"\n                  size=\"icon\"\n                  className=\"absolute top-1 right-1\"\n                  onClick={handleRemoveImage}\n                  data-testid={`button-remove-image-${announcement.id}`}\n                >\n                  <X className=\"w-3 h-3\" />\n                </Button>\n              </div>\n            )}\n            <div className=\"flex items-center gap-2\">\n              <input\n                type=\"file\"\n                accept=\"image/*\"\n                className=\"hidden\"\n                ref={fileInputRef}\n                onChange={handleImageUpload}\n                data-testid={`input-edit-image-${announcement.id}`}\n              />\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                type=\"button\"\n                onClick={() => fileInputRef.current?.click()}\n                disabled={uploadImage.isPending}\n              >\n                {uploadImage.isPending ? <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" /> : <ImagePlus className=\"w-4 h-4 mr-2\" />}\n                {announcement.imageUrl ? \"Ganti Gambar\" : \"Tambah Gambar\"}\n              </Button>\n            </div>\n          </div>\n        </div>\n\n        <div>\n          <label className=\"text-sm font-medium text-foreground\">Berlaku Sampai (Opsional)</label>\n          <Input\n            type=\"date\"\n            value={expiresAt}\n            onChange={(e) => setExpiresAt(e.target.value)}\n            className=\"bg-white dark:bg-background mt-1\"\n            data-testid={`input-edit-expires-${announcement.id}`}\n          />\n        </div>\n      </div>\n\n      <div className=\"flex items-center gap-2 pt-4 border-t border-border/50 justify-end\">\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={onCancel}\n          data-testid={`button-cancel-edit-${announcement.id}`}\n        >\n          Batal\n        </Button>\n        <Button\n          size=\"sm\"\n          onClick={handleSave}\n          disabled={updateAnnouncement.isPending}\n          data-testid={`button-save-edit-${announcement.id}`}\n        >\n          {updateAnnouncement.isPending && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n          Simpan\n        </Button>\n      </div>\n    </Card>\n  );\n}\n\nfunction CreateAnnouncementDialog({ open, onOpenChange }: { open: boolean; onOpenChange: (open: boolean) => void }) {\n  const createAnnouncement = useCreateAnnouncement();\n  const uploadImage = useUploadAnnouncementImage();\n  const [selectedImage, setSelectedImage] = useState<File | null>(null);\n  const [imagePreview, setImagePreview] = useState<string | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const form = useForm<z.infer<typeof createFormSchema>>({\n    resolver: zodResolver(createFormSchema),\n    defaultValues: {\n      title: \"\",\n      content: \"\",\n      expiresAt: \"\",\n    },\n  });\n\n  const handleImageSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n    setSelectedImage(file);\n    const reader = new FileReader();\n    reader.onload = (ev) => setImagePreview(ev.target?.result as string);\n    reader.readAsDataURL(file);\n    if (fileInputRef.current) fileInputRef.current.value = \"\";\n  };\n\n  const onSubmit = async (data: z.infer<typeof createFormSchema>) => {\n    createAnnouncement.mutate(\n      {\n        title: data.title,\n        content: data.content,\n        expiresAt: data.expiresAt || undefined,\n      },\n      {\n        onSuccess: async (result: any) => {\n          if (selectedImage && result?.id) {\n            try {\n              const compressed = await compressImage(selectedImage);\n              uploadImage.mutate({ id: result.id, file: compressed });\n            } catch {\n              uploadImage.mutate({ id: result.id, file: selectedImage });\n            }\n          }\n          onOpenChange(false);\n          form.reset();\n          setSelectedImage(null);\n          setImagePreview(null);\n        },\n      }\n    );\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={(v) => {\n      onOpenChange(v);\n      if (!v) { setSelectedImage(null); setImagePreview(null); }\n    }}>\n      <DialogTrigger asChild>\n        <Button data-testid=\"button-create-announcement\">\n          <Plus className=\"w-4 h-4 mr-2\" />\n          Buat Pengumuman\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"sm:max-w-[500px]\">\n        <DialogHeader>\n          <DialogTitle>Buat Pengumuman Baru</DialogTitle>\n        </DialogHeader>\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4 pt-4\">\n            <FormField\n              control={form.control}\n              name=\"title\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Judul</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"Judul pengumuman...\" {...field} data-testid=\"input-title\" />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"content\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Isi Pengumuman</FormLabel>\n                  <FormControl>\n                    <Textarea placeholder=\"Konten pengumuman...\" {...field} value={field.value || \"\"} data-testid=\"input-content\" className=\"min-h-[120px]\" />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div>\n              <label className=\"text-sm font-medium text-foreground\">Gambar (Opsional)</label>\n              <div className=\"mt-1 space-y-2\">\n                {imagePreview && (\n                  <div className=\"relative inline-block w-full\">\n                    <img src={imagePreview} alt=\"Preview\" className=\"w-full max-h-40 object-cover rounded-md\" />\n                    <Button\n                      variant=\"secondary\"\n                      size=\"icon\"\n                      type=\"button\"\n                      className=\"absolute top-1 right-1\"\n                      onClick={() => { setSelectedImage(null); setImagePreview(null); }}\n                      data-testid=\"button-remove-preview\"\n                    >\n                      <X className=\"w-3 h-3\" />\n                    </Button>\n                  </div>\n                )}\n                <input\n                  type=\"file\"\n                  accept=\"image/*\"\n                  className=\"hidden\"\n                  ref={fileInputRef}\n                  onChange={handleImageSelect}\n                  data-testid=\"input-announcement-image\"\n                />\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  type=\"button\"\n                  onClick={() => fileInputRef.current?.click()}\n                >\n                  <ImagePlus className=\"w-4 h-4 mr-2\" />\n                  {imagePreview ? \"Ganti Gambar\" : \"Pilih Gambar\"}\n                </Button>\n              </div>\n            </div>\n\n            <FormField\n              control={form.control}\n              name=\"expiresAt\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Berlaku Sampai (Opsional)</FormLabel>\n                  <FormControl>\n                    <Input type=\"date\" {...field} value={field.value || \"\"} data-testid=\"input-expires-at\" />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"flex justify-end gap-3 pt-2\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => onOpenChange(false)}>\n                Batal\n              </Button>\n              <Button type=\"submit\" disabled={createAnnouncement.isPending} data-testid=\"button-submit-announcement\">\n                {createAnnouncement.isPending && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n                Buat Pengumuman\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nfunction DeleteAnnouncementButton({ id, title }: { id: number; title: string }) {\n  const deleteAnnouncement = useDeleteAnnouncement();\n\n  return (\n    <AlertDialog>\n      <AlertDialogTrigger asChild>\n        <Button variant=\"ghost\" size=\"icon\" className=\"text-muted-foreground\" data-testid={`button-delete-announcement-${id}`}>\n          <Trash2 className=\"w-4 h-4\" />\n        </Button>\n      </AlertDialogTrigger>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle>Hapus Pengumuman?</AlertDialogTitle>\n          <AlertDialogDescription>\n            Apakah Anda yakin ingin menghapus pengumuman <strong>{title}</strong>? Tindakan ini tidak dapat dibatalkan.\n          </AlertDialogDescription>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel>Batal</AlertDialogCancel>\n          <AlertDialogAction\n            className=\"bg-destructive\"\n            onClick={() => deleteAnnouncement.mutate(id)}\n            data-testid=\"button-confirm-delete-announcement\"\n          >\n            Hapus\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n","path":null,"size_bytes":18292,"size_tokens":null},"client/src/hooks/use-staff.ts":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { api, buildUrl } from \"@shared/routes\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport function useStaff() {\n  return useQuery({\n    queryKey: [api.staff.list.path],\n    queryFn: async () => {\n      const res = await fetch(api.staff.list.path, { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch staff\");\n      return res.json();\n    },\n  });\n}\n\nexport function useCreateStaff() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async (data: { name: string; locationType: string }) => {\n      const res = await apiRequest(\"POST\", api.staff.create.path, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [api.staff.list.path] });\n      toast({ title: \"Staff Created\", description: \"New staff member has been added.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n\nexport function useUpdateStaff() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async ({ id, ...data }: { id: number; name?: string; locationType?: string }) => {\n      const url = buildUrl(api.staff.update.path, { id });\n      const res = await apiRequest(\"PUT\", url, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [api.staff.list.path] });\n      toast({ title: \"Staff Updated\", description: \"Staff details have been saved.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n\nexport function useDeleteStaff() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async (id: number) => {\n      const url = buildUrl(api.staff.delete.path, { id });\n      await apiRequest(\"DELETE\", url);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [api.staff.list.path] });\n      toast({ title: \"Staff Deleted\", description: \"Staff member has been removed.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n","path":null,"size_bytes":2436,"size_tokens":null},"server/replit_integrations/object_storage/routes.ts":{"content":"import type { Express } from \"express\";\nimport { ObjectStorageService, ObjectNotFoundError } from \"./objectStorage\";\n\n/**\n * Register object storage routes for file uploads.\n *\n * This provides example routes for the presigned URL upload flow:\n * 1. POST /api/uploads/request-url - Get a presigned URL for uploading\n * 2. The client then uploads directly to the presigned URL\n *\n * IMPORTANT: These are example routes. Customize based on your use case:\n * - Add authentication middleware for protected uploads\n * - Add file metadata storage (save to database after upload)\n * - Add ACL policies for access control\n */\nexport function registerObjectStorageRoutes(app: Express): void {\n  const objectStorageService = new ObjectStorageService();\n\n  /**\n   * Request a presigned URL for file upload.\n   *\n   * Request body (JSON):\n   * {\n   *   \"name\": \"filename.jpg\",\n   *   \"size\": 12345,\n   *   \"contentType\": \"image/jpeg\"\n   * }\n   *\n   * Response:\n   * {\n   *   \"uploadURL\": \"https://storage.googleapis.com/...\",\n   *   \"objectPath\": \"/objects/uploads/uuid\"\n   * }\n   *\n   * IMPORTANT: The client should NOT send the file to this endpoint.\n   * Send JSON metadata only, then upload the file directly to uploadURL.\n   */\n  app.post(\"/api/uploads/request-url\", async (req, res) => {\n    try {\n      const { name, size, contentType } = req.body;\n\n      if (!name) {\n        return res.status(400).json({\n          error: \"Missing required field: name\",\n        });\n      }\n\n      const uploadURL = await objectStorageService.getObjectEntityUploadURL();\n\n      // Extract object path from the presigned URL for later reference\n      const objectPath = objectStorageService.normalizeObjectEntityPath(uploadURL);\n\n      res.json({\n        uploadURL,\n        objectPath,\n        // Echo back the metadata for client convenience\n        metadata: { name, size, contentType },\n      });\n    } catch (error) {\n      console.error(\"Error generating upload URL:\", error);\n      res.status(500).json({ error: \"Failed to generate upload URL\" });\n    }\n  });\n\n  /**\n   * Serve uploaded objects.\n   *\n   * GET /objects/:objectPath(*)\n   *\n   * This serves files from object storage. For public files, no auth needed.\n   * For protected files, add authentication middleware and ACL checks.\n   */\n  app.get(/^\\/objects\\/(.+)/, async (req, res) => {\n    try {\n      const objectFile = await objectStorageService.getObjectEntityFile(req.path);\n      await objectStorageService.downloadObject(objectFile, res);\n    } catch (error) {\n      console.error(\"Error serving object:\", error);\n      if (error instanceof ObjectNotFoundError) {\n        return res.status(404).json({ error: \"Object not found\" });\n      }\n      return res.status(500).json({ error: \"Failed to serve object\" });\n    }\n  });\n}\n\n","path":null,"size_bytes":2779,"size_tokens":null},"client/src/hooks/use-auth.ts":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport type { User } from \"@shared/models/auth\";\n\ntype SafeUser = Omit<User, \"password\">;\n\nasync function fetchUser(): Promise<SafeUser | null> {\n  const response = await fetch(\"/api/auth/user\", {\n    credentials: \"include\",\n  });\n\n  if (response.status === 401) {\n    return null;\n  }\n\n  if (!response.ok) {\n    throw new Error(`${response.status}: ${response.statusText}`);\n  }\n\n  return response.json();\n}\n\nexport function useAuth() {\n  const queryClient = useQueryClient();\n  const { data: user, isLoading } = useQuery<SafeUser | null>({\n    queryKey: [\"/api/auth/user\"],\n    queryFn: fetchUser,\n    retry: false,\n    staleTime: 1000 * 60 * 5,\n  });\n\n  const loginMutation = useMutation({\n    mutationFn: async (data: { username: string; password: string }) => {\n      const res = await fetch(\"/api/auth/login\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n        credentials: \"include\",\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.message || \"Login gagal\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n    },\n  });\n\n  const registerMutation = useMutation({\n    mutationFn: async (data: { username: string; password: string; firstName?: string; lastName?: string }) => {\n      const res = await fetch(\"/api/auth/register\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n        credentials: \"include\",\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.message || \"Registrasi gagal\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n    },\n  });\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      const res = await fetch(\"/api/auth/logout\", {\n        method: \"POST\",\n        credentials: \"include\",\n      });\n      if (!res.ok) throw new Error(\"Logout gagal\");\n    },\n    onSuccess: () => {\n      queryClient.clear();\n      window.location.href = \"/\";\n    },\n  });\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n    login: loginMutation.mutateAsync,\n    loginError: loginMutation.error,\n    isLoggingIn: loginMutation.isPending,\n    register: registerMutation.mutateAsync,\n    registerError: registerMutation.error,\n    isRegistering: registerMutation.isPending,\n    logout: logoutMutation.mutate,\n    isLoggingOut: logoutMutation.isPending,\n  };\n}\n","path":null,"size_bytes":2706,"size_tokens":null},"server/db.ts":{"content":"\nimport { drizzle } from \"drizzle-orm/node-postgres\";\nimport pg from \"pg\";\nimport * as schema from \"@shared/schema\";\n\nconst { Pool } = pg;\n\nconst databaseUrl = process.env.SUPABASE_DATABASE_URL || process.env.DATABASE_URL;\nif (!databaseUrl) {\n  throw new Error(\n    \"SUPABASE_DATABASE_URL or DATABASE_URL must be set.\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: databaseUrl });\nexport const db = drizzle(pool, { schema });\n","path":null,"size_bytes":438,"size_tokens":null},"client/src/hooks/use-products.ts":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { api, buildUrl } from \"@shared/routes\";\nimport { type Product, type CategoryPriority } from \"@shared/schema\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport type ExcelImportResult = {\n  imported: number;\n  skipped: number;\n  errors: { row: number; message: string }[];\n};\n\nexport function useProducts(locationType?: string) {\n  const path = locationType\n    ? `${api.products.list.path}?locationType=${encodeURIComponent(locationType)}`\n    : api.products.list.path;\n\n  return useQuery<Product[]>({\n    queryKey: [api.products.list.path, locationType],\n    queryFn: async () => {\n      const res = await fetch(path, { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch products\");\n      return res.json();\n    },\n  });\n}\n\nexport function useProductsWithDetails() {\n  return useQuery({\n    queryKey: [api.products.withDetails.path],\n    queryFn: async () => {\n      const res = await fetch(api.products.withDetails.path, { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch products with details\");\n      return res.json();\n    },\n  });\n}\n\nexport function useProductPhotos(productId: number) {\n  return useQuery({\n    queryKey: [api.productPhotos.list.path, productId],\n    queryFn: async () => {\n      const url = buildUrl(api.productPhotos.list.path, { productId });\n      const res = await fetch(url, { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch product photos\");\n      return res.json();\n    },\n    enabled: !!productId,\n  });\n}\n\nexport function useUploadProductPhoto() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async ({ productId, file }: { productId: number; file: File }) => {\n      const formData = new FormData();\n      formData.append(\"photo\", file);\n      const url = buildUrl(api.productPhotos.upload.path, { productId });\n      const res = await fetch(url, {\n        method: \"POST\",\n        body: formData,\n        credentials: \"include\",\n      });\n      if (!res.ok) throw new Error(\"Failed to upload photo\");\n      return res.json();\n    },\n    onSuccess: (_, { productId }) => {\n      queryClient.invalidateQueries({ queryKey: [api.productPhotos.list.path, productId] });\n      queryClient.invalidateQueries({ queryKey: [api.products.list.path] });\n      queryClient.invalidateQueries({ queryKey: [api.products.withDetails.path] });\n      toast({ title: \"Photo Uploaded\", description: \"Product photo has been saved.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n\nexport function useDeleteProductPhoto() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async ({ productId, photoId }: { productId: number; photoId: number }) => {\n      const url = buildUrl(api.productPhotos.delete.path, { productId, photoId });\n      const res = await fetch(url, { method: \"DELETE\", credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to delete photo\");\n    },\n    onSuccess: (_, { productId }) => {\n      queryClient.invalidateQueries({ queryKey: [api.productPhotos.list.path, productId] });\n      queryClient.invalidateQueries({ queryKey: [api.products.list.path] });\n      queryClient.invalidateQueries({ queryKey: [api.products.withDetails.path] });\n      toast({ title: \"Photo Deleted\", description: \"Product photo has been removed.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n\nexport function useProductUnits(productId: number) {\n  return useQuery({\n    queryKey: [api.productUnits.list.path, productId],\n    queryFn: async () => {\n      const url = buildUrl(api.productUnits.list.path, { productId });\n      const res = await fetch(url, { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch product units\");\n      return res.json();\n    },\n    enabled: !!productId,\n  });\n}\n\nexport function useCreateProductUnit() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async ({ productId, ...data }: { productId: number; unitName: string; conversionToBase: number; baseUnit: string; sortOrder?: number }) => {\n      const url = buildUrl(api.productUnits.create.path, { productId });\n      const res = await apiRequest(\"POST\", url, data);\n      return res.json();\n    },\n    onSuccess: (_, { productId }) => {\n      queryClient.invalidateQueries({ queryKey: [api.productUnits.list.path, productId] });\n      queryClient.invalidateQueries({ queryKey: [api.products.withDetails.path] });\n      toast({ title: \"Unit Created\", description: \"Product unit has been added.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n\nexport function useUpdateProductUnit() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async ({ productId, unitId, ...data }: { productId: number; unitId: number; unitName?: string; conversionToBase?: number; baseUnit?: string; sortOrder?: number }) => {\n      const url = buildUrl(api.productUnits.update.path, { productId, unitId });\n      const res = await apiRequest(\"PUT\", url, data);\n      return res.json();\n    },\n    onSuccess: (_, { productId }) => {\n      queryClient.invalidateQueries({ queryKey: [api.productUnits.list.path, productId] });\n      queryClient.invalidateQueries({ queryKey: [api.products.withDetails.path] });\n      toast({ title: \"Unit Updated\", description: \"Product unit has been updated.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n\nexport function useDeleteProductUnit() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async ({ productId, unitId }: { productId: number; unitId: number }) => {\n      const url = buildUrl(api.productUnits.delete.path, { productId, unitId });\n      const res = await fetch(url, { method: \"DELETE\", credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to delete unit\");\n    },\n    onSuccess: (_, { productId }) => {\n      queryClient.invalidateQueries({ queryKey: [api.productUnits.list.path, productId] });\n      queryClient.invalidateQueries({ queryKey: [api.products.withDetails.path] });\n      toast({ title: \"Unit Deleted\", description: \"Product unit has been removed.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n\nexport function useCategories() {\n  return useQuery<string[]>({\n    queryKey: [api.products.categories.path],\n    queryFn: async () => {\n      const res = await fetch(api.products.categories.path, { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch categories\");\n      return res.json();\n    },\n  });\n}\n\nexport function useCreateProduct() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async (data: Partial<Omit<Product, \"id\" | \"updatedAt\" | \"userId\">>) => {\n      const res = await fetch(api.products.create.path, {\n        method: api.products.create.method,\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n        credentials: \"include\",\n      });\n\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.message || \"Failed to create product\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [api.products.list.path] });\n      queryClient.invalidateQueries({ queryKey: [api.products.categories.path] });\n      queryClient.invalidateQueries({ queryKey: [api.products.withDetails.path] });\n      toast({ title: \"Product Created\", description: \"Successfully added new SKU to inventory.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n\nexport function useUpdateProduct() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async ({ id, ...updates }: { id: number } & Partial<Omit<Product, \"id\" | \"updatedAt\" | \"userId\">>) => {\n      const url = buildUrl(api.products.update.path, { id });\n      const res = await fetch(url, {\n        method: api.products.update.method,\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(updates),\n        credentials: \"include\",\n      });\n\n      if (!res.ok) throw new Error(\"Failed to update product\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [api.products.list.path] });\n      queryClient.invalidateQueries({ queryKey: [api.products.categories.path] });\n      queryClient.invalidateQueries({ queryKey: [api.products.withDetails.path] });\n      toast({ title: \"Product Updated\", description: \"Inventory details have been saved.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n\nexport function useDeleteProduct() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async (id: number) => {\n      const url = buildUrl(api.products.delete.path, { id });\n      const res = await fetch(url, { method: api.products.delete.method, credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to delete product\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [api.products.list.path] });\n      queryClient.invalidateQueries({ queryKey: [api.products.categories.path] });\n      queryClient.invalidateQueries({ queryKey: [api.products.withDetails.path] });\n      toast({ title: \"Product Deleted\", description: \"The SKU has been removed from the system.\" });\n    },\n  });\n}\n\nexport function useBulkDeleteProducts() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async (ids: number[]) => {\n      const res = await fetch(api.products.bulkDelete.path, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ ids }),\n        credentials: \"include\",\n      });\n      if (!res.ok) throw new Error(\"Failed to delete products\");\n      return res.json() as Promise<{ deleted: number }>;\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [api.products.list.path] });\n      queryClient.invalidateQueries({ queryKey: [api.products.categories.path] });\n      queryClient.invalidateQueries({ queryKey: [api.products.withDetails.path] });\n      toast({ title: \"Produk Dihapus\", description: `${data.deleted} produk berhasil dihapus.` });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n\nexport function useUploadPhoto() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async ({ productId, file }: { productId: number; file: File }) => {\n      const formData = new FormData();\n      formData.append(\"photo\", file);\n      const url = buildUrl(api.upload.photo.path, { productId });\n      const res = await fetch(url, {\n        method: \"POST\",\n        body: formData,\n        credentials: \"include\",\n      });\n      if (!res.ok) throw new Error(\"Failed to upload photo\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [api.products.list.path] });\n      toast({ title: \"Photo Uploaded\", description: \"Product photo has been saved.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n\nexport function useImportExcel() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation<ExcelImportResult, Error, File>({\n    mutationFn: async (file: File) => {\n      const formData = new FormData();\n      formData.append(\"file\", file);\n      const res = await fetch(api.excel.import.path, {\n        method: \"POST\",\n        body: formData,\n        credentials: \"include\",\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.message || \"Gagal import Excel\");\n      }\n      return res.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [api.products.list.path] });\n      queryClient.invalidateQueries({ queryKey: [api.products.categories.path] });\n      if (data.imported > 0) {\n        toast({\n          title: \"Import Berhasil\",\n          description: `${data.imported} produk berhasil diimport${data.skipped > 0 ? `, ${data.skipped} dilewati` : \"\"}.`,\n        });\n      }\n    },\n    onError: (error) => {\n      toast({ title: \"Import Gagal\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n\nexport function useCategoryPriorities() {\n  return useQuery<CategoryPriority[]>({\n    queryKey: [api.categoryPriorities.list.path],\n    queryFn: async () => {\n      const res = await fetch(api.categoryPriorities.list.path, { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch category priorities\");\n      return res.json();\n    },\n  });\n}\n\nexport function useSetCategoryPriorities() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async (priorities: { categoryName: string; sortOrder: number }[]) => {\n      const res = await fetch(api.categoryPriorities.set.path, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ priorities }),\n        credentials: \"include\",\n      });\n      if (!res.ok) throw new Error(\"Failed to save category priorities\");\n      return res.json() as Promise<CategoryPriority[]>;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [api.categoryPriorities.list.path] });\n      toast({ title: \"Urutan Kategori Disimpan\", description: \"Prioritas kategori berhasil diperbarui.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n","path":null,"size_bytes":14670,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/hooks/use-sessions.ts":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { api, buildUrl } from \"@shared/routes\";\nimport { type OpnameSession, type OpnameSessionWithRecords } from \"@shared/schema\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport function useSessions(locationType?: string) {\n  const path = locationType\n    ? `${api.sessions.list.path}?locationType=${encodeURIComponent(locationType)}`\n    : api.sessions.list.path;\n\n  return useQuery<OpnameSession[]>({\n    queryKey: [api.sessions.list.path, locationType],\n    queryFn: async () => {\n      const res = await fetch(path, { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch sessions\");\n      return res.json();\n    },\n  });\n}\n\nexport function useSession(id: number) {\n  return useQuery<OpnameSessionWithRecords>({\n    queryKey: [api.sessions.get.path, id],\n    queryFn: async () => {\n      const url = buildUrl(api.sessions.get.path, { id });\n      const res = await fetch(url, { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch session details\");\n      return res.json();\n    },\n    enabled: !!id,\n  });\n}\n\nexport function useCreateSession() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async (data: { title: string; notes?: string | null; status?: string; locationType?: string; startedByName?: string; assignedTo?: string }) => {\n      const res = await fetch(api.sessions.create.path, {\n        method: api.sessions.create.method,\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n        credentials: \"include\",\n      });\n\n      if (!res.ok) throw new Error(\"Failed to start session\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [api.sessions.list.path] });\n      toast({ title: \"Session Started\", description: \"New stock opname session initialized.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n\nexport function useCompleteSession() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async (id: number) => {\n      const url = buildUrl(api.sessions.complete.path, { id });\n      const res = await fetch(url, { method: api.sessions.complete.method, credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to complete session\");\n      return res.json();\n    },\n    onSuccess: (_, id) => {\n      queryClient.invalidateQueries({ queryKey: [api.sessions.list.path] });\n      queryClient.invalidateQueries({ queryKey: [api.sessions.get.path, id] });\n      toast({ title: \"Session Completed\", description: \"Stock counts have been finalized.\" });\n    },\n  });\n}\n\nexport function useUpdateRecord() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async ({ sessionId, productId, actualStock, notes, unitValues }: { sessionId: number; productId: number; actualStock: number; notes?: string; unitValues?: string }) => {\n      const url = buildUrl(api.records.update.path, { sessionId });\n      const res = await fetch(url, {\n        method: api.records.update.method,\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ productId, actualStock, notes, unitValues }),\n        credentials: \"include\",\n      });\n\n      if (!res.ok) throw new Error(\"Failed to update count\");\n      return res.json();\n    },\n    onSuccess: (_, { sessionId }) => {\n      queryClient.invalidateQueries({ queryKey: [api.sessions.get.path, sessionId] });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n\nexport function useUploadOpnamePhoto() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async ({ sessionId, productId, file }: { sessionId: number; productId: number; file: File }) => {\n      const url = buildUrl(api.upload.opnamePhoto.path, { sessionId, productId });\n      const formData = new FormData();\n      formData.append(\"photo\", file);\n      const res = await fetch(url, {\n        method: \"POST\",\n        body: formData,\n        credentials: \"include\",\n      });\n      if (!res.ok) {\n        const err = await res.json();\n        throw new Error(err.message || \"Upload failed\");\n      }\n      return res.json();\n    },\n    onSuccess: (_, { sessionId }) => {\n      queryClient.invalidateQueries({ queryKey: [api.sessions.get.path, sessionId] });\n      toast({ title: \"Foto Berhasil Diupload\", description: \"Foto opname sudah tersimpan.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n\nexport function useUploadRecordPhoto() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async ({ sessionId, productId, file }: { sessionId: number; productId: number; file: File }) => {\n      const url = buildUrl(api.recordPhotos.upload.path, { sessionId, productId });\n      const formData = new FormData();\n      formData.append(\"photo\", file);\n      const res = await fetch(url, {\n        method: \"POST\",\n        body: formData,\n        credentials: \"include\",\n      });\n      if (!res.ok) {\n        const err = await res.json();\n        throw new Error(err.message || \"Upload failed\");\n      }\n      return res.json();\n    },\n    onSuccess: (_, { sessionId }) => {\n      queryClient.invalidateQueries({ queryKey: [api.sessions.get.path, sessionId] });\n      toast({ title: \"Foto Berhasil Diupload\", description: \"Foto record sudah tersimpan.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n\nexport function useDeleteRecordPhoto() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async ({ sessionId, productId, photoId }: { sessionId: number; productId: number; photoId: number }) => {\n      const url = buildUrl(api.recordPhotos.delete.path, { sessionId, productId, photoId });\n      const res = await fetch(url, { method: \"DELETE\", credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to delete photo\");\n    },\n    onSuccess: (_, { sessionId }) => {\n      queryClient.invalidateQueries({ queryKey: [api.sessions.get.path, sessionId] });\n      toast({ title: \"Foto Dihapus\", description: \"Foto record sudah dihapus.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n}\n","path":null,"size_bytes":6834,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"server/replit_integrations/auth/replitAuth.ts":{"content":"import session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport connectPg from \"connect-pg-simple\";\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000;\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.SUPABASE_DATABASE_URL || process.env.DATABASE_URL,\n    createTableIfMissing: true,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: false,\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n}\n\nexport const isAuthenticated: RequestHandler = (req, res, next) => {\n  if ((req.session as any).userId) {\n    return next();\n  }\n  return res.status(401).json({ message: \"Unauthorized\" });\n};\n","path":null,"size_bytes":985,"size_tokens":null},"server/storage.ts":{"content":"import { db } from \"./db\";\nimport {\n  products, opnameSessions, opnameRecords, userRoles,\n  productPhotos, productUnits, staffMembers, announcements,\n  feedback, motivationMessages, opnameRecordPhotos, categoryPriorities,\n  type Product, type InsertProduct,\n  type OpnameSession, type InsertOpnameSession,\n  type OpnameRecord,\n  type OpnameSessionWithRecords,\n  type UserRole, type InsertUserRole,\n  type ProductPhoto, type InsertProductPhoto,\n  type ProductUnit, type InsertProductUnit,\n  type StaffMember, type InsertStaffMember,\n  type Announcement, type InsertAnnouncement,\n  type Feedback, type InsertFeedback,\n  type MotivationMessage, type InsertMotivationMessage,\n  type OpnameRecordPhoto,\n  type ProductWithPhotosAndUnits,\n  type CategoryPriority,\n} from \"@shared/schema\";\nimport { eq, desc, and } from \"drizzle-orm\";\n\nexport interface IStorage {\n  getProducts(userId: string, locationType?: string): Promise<Product[]>;\n  getProduct(id: number): Promise<Product | undefined>;\n  createProduct(product: InsertProduct): Promise<Product>;\n  updateProduct(id: number, product: Partial<InsertProduct>): Promise<Product>;\n  deleteProduct(id: number): Promise<void>;\n  getProductsWithPhotosAndUnits(userId: string): Promise<ProductWithPhotosAndUnits[]>;\n\n  getProductPhotos(productId: number): Promise<ProductPhoto[]>;\n  addProductPhoto(data: InsertProductPhoto): Promise<ProductPhoto>;\n  deleteProductPhoto(id: number): Promise<void>;\n\n  getProductUnits(productId: number): Promise<ProductUnit[]>;\n  addProductUnit(data: InsertProductUnit): Promise<ProductUnit>;\n  updateProductUnit(id: number, data: Partial<InsertProductUnit>): Promise<ProductUnit>;\n  deleteProductUnit(id: number): Promise<void>;\n\n  getSessions(userId: string, locationType?: string): Promise<OpnameSession[]>;\n  getSession(id: number): Promise<OpnameSessionWithRecords | undefined>;\n  createSession(session: InsertOpnameSession): Promise<OpnameSession>;\n  completeSession(id: number): Promise<OpnameSession>;\n\n  updateRecord(sessionId: number, productId: number, actualStock: number, notes?: string, unitValues?: string): Promise<OpnameRecord>;\n  updateRecordPhoto(sessionId: number, productId: number, photoUrl: string): Promise<OpnameRecord>;\n\n  getRecordPhotos(recordId: number): Promise<OpnameRecordPhoto[]>;\n  addRecordPhoto(data: { recordId: number; url: string }): Promise<OpnameRecordPhoto>;\n  deleteRecordPhoto(id: number): Promise<void>;\n\n  getUserRole(userId: string): Promise<UserRole | undefined>;\n  setUserRole(data: InsertUserRole): Promise<UserRole>;\n  getAllUserRoles(): Promise<UserRole[]>;\n\n  getStaffMembers(userId: string): Promise<StaffMember[]>;\n  createStaffMember(data: InsertStaffMember): Promise<StaffMember>;\n  updateStaffMember(id: number, data: Partial<InsertStaffMember>): Promise<StaffMember>;\n  deleteStaffMember(id: number): Promise<void>;\n\n  getAnnouncements(userId: string): Promise<Announcement[]>;\n  createAnnouncement(data: InsertAnnouncement): Promise<Announcement>;\n  updateAnnouncement(id: number, data: Partial<InsertAnnouncement>): Promise<Announcement>;\n  deleteAnnouncement(id: number): Promise<void>;\n\n  getFeedback(userId: string): Promise<Feedback[]>;\n  createFeedback(data: InsertFeedback): Promise<Feedback>;\n  deleteFeedback(id: number): Promise<void>;\n  getAllFeedback(): Promise<Feedback[]>;\n\n  getMotivationMessages(userId: string): Promise<MotivationMessage[]>;\n  createMotivationMessage(data: InsertMotivationMessage): Promise<MotivationMessage>;\n  updateMotivationMessage(id: number, data: Partial<InsertMotivationMessage>): Promise<MotivationMessage>;\n  deleteMotivationMessage(id: number): Promise<void>;\n\n  getCategoryPriorities(userId: string): Promise<CategoryPriority[]>;\n  setCategoryPriorities(userId: string, priorities: { categoryName: string; sortOrder: number }[]): Promise<CategoryPriority[]>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async getProducts(userId: string, locationType?: string): Promise<Product[]> {\n    if (locationType) {\n      return await db.select().from(products).where(and(eq(products.userId, userId), eq(products.locationType, locationType as \"toko\" | \"gudang\"))).orderBy(products.sku);\n    }\n    return await db.select().from(products).where(eq(products.userId, userId)).orderBy(products.sku);\n  }\n\n  async getProduct(id: number): Promise<Product | undefined> {\n    const [product] = await db.select().from(products).where(eq(products.id, id));\n    return product;\n  }\n\n  async createProduct(insertProduct: InsertProduct): Promise<Product> {\n    const [product] = await db.insert(products).values(insertProduct).returning();\n    return product;\n  }\n\n  async updateProduct(id: number, updates: Partial<InsertProduct>): Promise<Product> {\n    const [product] = await db.update(products).set(updates).where(eq(products.id, id)).returning();\n    return product;\n  }\n\n  async deleteProduct(id: number): Promise<void> {\n    await db.delete(products).where(eq(products.id, id));\n  }\n\n  async getProductsWithPhotosAndUnits(userId: string): Promise<ProductWithPhotosAndUnits[]> {\n    const result = await db.query.products.findMany({\n      where: eq(products.userId, userId),\n      with: {\n        photos: true,\n        units: true,\n      },\n      orderBy: products.sku,\n    });\n    return result;\n  }\n\n  async getProductPhotos(productId: number): Promise<ProductPhoto[]> {\n    return await db.select().from(productPhotos).where(eq(productPhotos.productId, productId));\n  }\n\n  async addProductPhoto(data: InsertProductPhoto): Promise<ProductPhoto> {\n    const [photo] = await db.insert(productPhotos).values(data).returning();\n    return photo;\n  }\n\n  async deleteProductPhoto(id: number): Promise<void> {\n    await db.delete(productPhotos).where(eq(productPhotos.id, id));\n  }\n\n  async getProductUnits(productId: number): Promise<ProductUnit[]> {\n    return await db.select().from(productUnits).where(eq(productUnits.productId, productId)).orderBy(productUnits.sortOrder);\n  }\n\n  async addProductUnit(data: InsertProductUnit): Promise<ProductUnit> {\n    const [unit] = await db.insert(productUnits).values(data).returning();\n    return unit;\n  }\n\n  async updateProductUnit(id: number, data: Partial<InsertProductUnit>): Promise<ProductUnit> {\n    const [unit] = await db.update(productUnits).set(data).where(eq(productUnits.id, id)).returning();\n    return unit;\n  }\n\n  async deleteProductUnit(id: number): Promise<void> {\n    await db.delete(productUnits).where(eq(productUnits.id, id));\n  }\n\n  async getSessions(userId: string, locationType?: string): Promise<OpnameSession[]> {\n    if (locationType) {\n      return await db.select().from(opnameSessions).where(and(eq(opnameSessions.userId, userId), eq(opnameSessions.locationType, locationType as \"toko\" | \"gudang\"))).orderBy(desc(opnameSessions.startedAt));\n    }\n    return await db.select().from(opnameSessions).where(eq(opnameSessions.userId, userId)).orderBy(desc(opnameSessions.startedAt));\n  }\n\n  async getSession(id: number): Promise<OpnameSessionWithRecords | undefined> {\n    const [session] = await db.select().from(opnameSessions).where(eq(opnameSessions.id, id));\n    if (!session) return undefined;\n\n    const records = await db.query.opnameRecords.findMany({\n      where: eq(opnameRecords.sessionId, id),\n      with: {\n        product: {\n          with: {\n            photos: true,\n            units: true,\n          },\n        },\n        photos: true,\n      },\n      orderBy: desc(opnameRecords.id)\n    });\n\n    return { ...session, records };\n  }\n\n  async createSession(insertSession: InsertOpnameSession): Promise<OpnameSession> {\n    const [session] = await db.insert(opnameSessions).values(insertSession).returning();\n\n    const sessionLocationType = insertSession.locationType;\n    const allProducts = await this.getProducts(insertSession.userId, sessionLocationType ?? undefined);\n    if (allProducts.length > 0) {\n      const recordsToInsert = allProducts.map(p => ({\n        sessionId: session.id,\n        productId: p.id,\n        actualStock: null as number | null,\n      }));\n      await db.insert(opnameRecords).values(recordsToInsert);\n    }\n\n    return session;\n  }\n\n  async completeSession(id: number): Promise<OpnameSession> {\n    const [session] = await db.update(opnameSessions)\n      .set({ status: \"completed\", completedAt: new Date() })\n      .where(eq(opnameSessions.id, id))\n      .returning();\n\n    const records = await db.select().from(opnameRecords).where(eq(opnameRecords.sessionId, id));\n    for (const record of records) {\n      if (record.actualStock !== null) {\n        await db.update(products)\n          .set({ currentStock: record.actualStock })\n          .where(eq(products.id, record.productId));\n      }\n    }\n\n    return session;\n  }\n\n  async updateRecord(sessionId: number, productId: number, actualStock: number, notes?: string, unitValues?: string): Promise<OpnameRecord> {\n    const [existing] = await db.select().from(opnameRecords).where(\n      and(eq(opnameRecords.sessionId, sessionId), eq(opnameRecords.productId, productId))\n    );\n\n    const updateData: Record<string, unknown> = { actualStock, notes };\n    if (unitValues !== undefined) {\n      updateData.unitValues = unitValues;\n    }\n\n    if (existing) {\n      const [updated] = await db.update(opnameRecords)\n        .set(updateData)\n        .where(eq(opnameRecords.id, existing.id))\n        .returning();\n      return updated;\n    } else {\n      const [created] = await db.insert(opnameRecords).values({\n        sessionId,\n        productId,\n        actualStock,\n        notes,\n        unitValues\n      }).returning();\n      return created;\n    }\n  }\n\n  async updateRecordPhoto(sessionId: number, productId: number, photoUrl: string): Promise<OpnameRecord> {\n    const [existing] = await db.select().from(opnameRecords).where(\n      and(eq(opnameRecords.sessionId, sessionId), eq(opnameRecords.productId, productId))\n    );\n\n    if (existing) {\n      const [updated] = await db.update(opnameRecords)\n        .set({ photoUrl })\n        .where(eq(opnameRecords.id, existing.id))\n        .returning();\n      return updated;\n    } else {\n      const [created] = await db.insert(opnameRecords).values({\n        sessionId,\n        productId,\n        photoUrl\n      }).returning();\n      return created;\n    }\n  }\n\n  async getRecordPhotos(recordId: number): Promise<OpnameRecordPhoto[]> {\n    return await db.select().from(opnameRecordPhotos).where(eq(opnameRecordPhotos.recordId, recordId));\n  }\n\n  async addRecordPhoto(data: { recordId: number; url: string }): Promise<OpnameRecordPhoto> {\n    const [photo] = await db.insert(opnameRecordPhotos).values(data).returning();\n    return photo;\n  }\n\n  async deleteRecordPhoto(id: number): Promise<void> {\n    await db.delete(opnameRecordPhotos).where(eq(opnameRecordPhotos.id, id));\n  }\n\n  async getUserRole(userId: string): Promise<UserRole | undefined> {\n    const [role] = await db.select().from(userRoles).where(eq(userRoles.userId, userId));\n    return role;\n  }\n\n  async setUserRole(data: InsertUserRole): Promise<UserRole> {\n    const [existing] = await db.select().from(userRoles).where(eq(userRoles.userId, data.userId));\n    if (existing) {\n      const [updated] = await db.update(userRoles)\n        .set({ role: data.role })\n        .where(eq(userRoles.userId, data.userId))\n        .returning();\n      return updated;\n    }\n    const [created] = await db.insert(userRoles).values(data).returning();\n    return created;\n  }\n\n  async getAllUserRoles(): Promise<UserRole[]> {\n    return await db.select().from(userRoles);\n  }\n\n  async getStaffMembers(userId: string): Promise<StaffMember[]> {\n    return await db.select().from(staffMembers).where(eq(staffMembers.userId, userId));\n  }\n\n  async createStaffMember(data: InsertStaffMember): Promise<StaffMember> {\n    const [member] = await db.insert(staffMembers).values(data).returning();\n    return member;\n  }\n\n  async updateStaffMember(id: number, data: Partial<InsertStaffMember>): Promise<StaffMember> {\n    const [member] = await db.update(staffMembers).set(data).where(eq(staffMembers.id, id)).returning();\n    return member;\n  }\n\n  async deleteStaffMember(id: number): Promise<void> {\n    await db.delete(staffMembers).where(eq(staffMembers.id, id));\n  }\n\n  async getAnnouncements(userId: string): Promise<Announcement[]> {\n    return await db.select().from(announcements).where(eq(announcements.userId, userId)).orderBy(desc(announcements.createdAt));\n  }\n\n  async createAnnouncement(data: InsertAnnouncement): Promise<Announcement> {\n    const [announcement] = await db.insert(announcements).values(data).returning();\n    return announcement;\n  }\n\n  async updateAnnouncement(id: number, data: Partial<InsertAnnouncement>): Promise<Announcement> {\n    const [announcement] = await db.update(announcements).set(data).where(eq(announcements.id, id)).returning();\n    return announcement;\n  }\n\n  async deleteAnnouncement(id: number): Promise<void> {\n    await db.delete(announcements).where(eq(announcements.id, id));\n  }\n\n  async getFeedback(userId: string): Promise<Feedback[]> {\n    return await db.select().from(feedback).where(eq(feedback.userId, userId)).orderBy(desc(feedback.createdAt));\n  }\n\n  async createFeedback(data: InsertFeedback): Promise<Feedback> {\n    const [fb] = await db.insert(feedback).values(data).returning();\n    return fb;\n  }\n\n  async deleteFeedback(id: number): Promise<void> {\n    await db.delete(feedback).where(eq(feedback.id, id));\n  }\n\n  async getAllFeedback(): Promise<Feedback[]> {\n    return await db.select().from(feedback).orderBy(desc(feedback.createdAt));\n  }\n\n  async getMotivationMessages(userId: string): Promise<MotivationMessage[]> {\n    return await db.select().from(motivationMessages).where(eq(motivationMessages.userId, userId));\n  }\n\n  async createMotivationMessage(data: InsertMotivationMessage): Promise<MotivationMessage> {\n    const [msg] = await db.insert(motivationMessages).values(data).returning();\n    return msg;\n  }\n\n  async updateMotivationMessage(id: number, data: Partial<InsertMotivationMessage>): Promise<MotivationMessage> {\n    const [msg] = await db.update(motivationMessages).set(data).where(eq(motivationMessages.id, id)).returning();\n    return msg;\n  }\n\n  async deleteMotivationMessage(id: number): Promise<void> {\n    await db.delete(motivationMessages).where(eq(motivationMessages.id, id));\n  }\n\n  async getCategoryPriorities(userId: string): Promise<CategoryPriority[]> {\n    return await db.select().from(categoryPriorities).where(eq(categoryPriorities.userId, userId)).orderBy(categoryPriorities.sortOrder);\n  }\n\n  async setCategoryPriorities(userId: string, priorities: { categoryName: string; sortOrder: number }[]): Promise<CategoryPriority[]> {\n    await db.delete(categoryPriorities).where(eq(categoryPriorities.userId, userId));\n    if (priorities.length === 0) return [];\n    const values = priorities.map(p => ({ categoryName: p.categoryName, sortOrder: p.sortOrder, userId }));\n    return await db.insert(categoryPriorities).values(values).returning();\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":15048,"size_tokens":null},"client/src/components/StatusBadge.tsx":{"content":"import { cn } from \"@/lib/utils\";\n\ntype Status = \"in_progress\" | \"completed\" | \"active\" | \"inactive\";\n\ninterface StatusBadgeProps {\n  status: Status | string;\n  className?: string;\n}\n\nexport function StatusBadge({ status, className }: StatusBadgeProps) {\n  const getStyles = (s: string) => {\n    switch (s.toLowerCase()) {\n      case \"in_progress\":\n        return \"bg-amber-50 text-amber-700 border-amber-200\";\n      case \"completed\":\n        return \"bg-emerald-50 text-emerald-700 border-emerald-200\";\n      case \"active\":\n        return \"bg-blue-50 text-blue-700 border-blue-200\";\n      default:\n        return \"bg-slate-50 text-slate-700 border-slate-200\";\n    }\n  };\n\n  const getLabel = (s: string) => {\n    return s.replace(\"_\", \" \").toUpperCase();\n  };\n\n  return (\n    <span className={cn(\n      \"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border shadow-sm\",\n      getStyles(status),\n      className\n    )}>\n      {getLabel(status)}\n    </span>\n  );\n}\n","path":null,"size_bytes":987,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"shared/routes.ts":{"content":"import { z } from 'zod';\nimport { insertProductSchema, insertSessionSchema, products, opnameSessions, opnameRecords, userRoles } from './schema';\n\nexport const errorSchemas = {\n  validation: z.object({\n    message: z.string(),\n    field: z.string().optional(),\n  }),\n  notFound: z.object({\n    message: z.string(),\n  }),\n  internal: z.object({\n    message: z.string(),\n  }),\n};\n\nexport const api = {\n  products: {\n    list: {\n      method: 'GET' as const,\n      path: '/api/products' as const,\n    },\n    create: {\n      method: 'POST' as const,\n      path: '/api/products' as const,\n      input: insertProductSchema.omit({ userId: true }),\n    },\n    update: {\n      method: 'PUT' as const,\n      path: '/api/products/:id' as const,\n      input: insertProductSchema.omit({ userId: true }).partial(),\n    },\n    delete: {\n      method: 'DELETE' as const,\n      path: '/api/products/:id' as const,\n    },\n    bulkDelete: {\n      method: 'POST' as const,\n      path: '/api/products/bulk-delete' as const,\n    },\n    categories: {\n      method: 'GET' as const,\n      path: '/api/products/categories' as const,\n    },\n    withDetails: {\n      method: 'GET' as const,\n      path: '/api/products/with-details' as const,\n    },\n  },\n  productPhotos: {\n    list: {\n      method: 'GET' as const,\n      path: '/api/products/:productId/photos' as const,\n    },\n    upload: {\n      method: 'POST' as const,\n      path: '/api/products/:productId/photos' as const,\n    },\n    delete: {\n      method: 'DELETE' as const,\n      path: '/api/products/:productId/photos/:photoId' as const,\n    },\n  },\n  productUnits: {\n    list: {\n      method: 'GET' as const,\n      path: '/api/products/:productId/units' as const,\n    },\n    create: {\n      method: 'POST' as const,\n      path: '/api/products/:productId/units' as const,\n    },\n    update: {\n      method: 'PUT' as const,\n      path: '/api/products/:productId/units/:unitId' as const,\n    },\n    delete: {\n      method: 'DELETE' as const,\n      path: '/api/products/:productId/units/:unitId' as const,\n    },\n  },\n  sessions: {\n    list: {\n      method: 'GET' as const,\n      path: '/api/sessions' as const,\n    },\n    create: {\n      method: 'POST' as const,\n      path: '/api/sessions' as const,\n      input: insertSessionSchema.omit({ userId: true }),\n    },\n    get: {\n      method: 'GET' as const,\n      path: '/api/sessions/:id' as const,\n    },\n    complete: {\n      method: 'POST' as const,\n      path: '/api/sessions/:id/complete' as const,\n    },\n  },\n  records: {\n    update: {\n      method: 'POST' as const,\n      path: '/api/sessions/:sessionId/records' as const,\n      input: z.object({\n        productId: z.number(),\n        actualStock: z.number(),\n        notes: z.string().optional(),\n        unitValues: z.string().optional(),\n      }),\n    },\n  },\n  recordPhotos: {\n    upload: {\n      method: 'POST' as const,\n      path: '/api/sessions/:sessionId/records/:productId/photos' as const,\n    },\n    delete: {\n      method: 'DELETE' as const,\n      path: '/api/sessions/:sessionId/records/:productId/photos/:photoId' as const,\n    },\n  },\n  roles: {\n    me: {\n      method: 'GET' as const,\n      path: '/api/roles/me' as const,\n    },\n    list: {\n      method: 'GET' as const,\n      path: '/api/roles' as const,\n    },\n    set: {\n      method: 'POST' as const,\n      path: '/api/roles' as const,\n      input: z.object({\n        userId: z.string(),\n        role: z.enum([\"admin\", \"sku_manager\", \"stock_counter\", \"stock_counter_toko\", \"stock_counter_gudang\"]),\n      }),\n    },\n  },\n  upload: {\n    photo: {\n      method: 'POST' as const,\n      path: '/api/upload/photo/:productId' as const,\n    },\n    opnamePhoto: {\n      method: 'POST' as const,\n      path: '/api/upload/opname-photo/:sessionId/:productId' as const,\n    },\n    downloadZip: {\n      method: 'POST' as const,\n      path: '/api/sessions/:id/download-photos' as const,\n    },\n  },\n  excel: {\n    template: {\n      method: 'GET' as const,\n      path: '/api/excel/template' as const,\n    },\n    import: {\n      method: 'POST' as const,\n      path: '/api/excel/import' as const,\n    },\n    export: {\n      method: 'GET' as const,\n      path: '/api/excel/export' as const,\n    },\n  },\n  staff: {\n    list: {\n      method: 'GET' as const,\n      path: '/api/staff' as const,\n    },\n    create: {\n      method: 'POST' as const,\n      path: '/api/staff' as const,\n    },\n    update: {\n      method: 'PUT' as const,\n      path: '/api/staff/:id' as const,\n    },\n    delete: {\n      method: 'DELETE' as const,\n      path: '/api/staff/:id' as const,\n    },\n  },\n  announcements: {\n    list: {\n      method: 'GET' as const,\n      path: '/api/announcements' as const,\n    },\n    create: {\n      method: 'POST' as const,\n      path: '/api/announcements' as const,\n    },\n    update: {\n      method: 'PUT' as const,\n      path: '/api/announcements/:id' as const,\n    },\n    delete: {\n      method: 'DELETE' as const,\n      path: '/api/announcements/:id' as const,\n    },\n    uploadImage: {\n      method: 'POST' as const,\n      path: '/api/announcements/:id/image' as const,\n    },\n  },\n  feedback: {\n    list: {\n      method: 'GET' as const,\n      path: '/api/feedback' as const,\n    },\n    create: {\n      method: 'POST' as const,\n      path: '/api/feedback' as const,\n    },\n    delete: {\n      method: 'DELETE' as const,\n      path: '/api/feedback/:id' as const,\n    },\n  },\n  motivation: {\n    list: {\n      method: 'GET' as const,\n      path: '/api/motivation' as const,\n    },\n    create: {\n      method: 'POST' as const,\n      path: '/api/motivation' as const,\n    },\n    update: {\n      method: 'PUT' as const,\n      path: '/api/motivation/:id' as const,\n    },\n    delete: {\n      method: 'DELETE' as const,\n      path: '/api/motivation/:id' as const,\n    },\n  },\n  categoryPriorities: {\n    list: {\n      method: 'GET' as const,\n      path: '/api/category-priorities' as const,\n    },\n    set: {\n      method: 'POST' as const,\n      path: '/api/category-priorities' as const,\n    },\n  },\n};\n\nexport function buildUrl(path: string, params?: Record<string, string | number>): string {\n  let url = path;\n  if (params) {\n    Object.entries(params).forEach(([key, value]) => {\n      if (url.includes(`:${key}`)) {\n        url = url.replace(`:${key}`, String(value));\n      }\n    });\n  }\n  return url;\n}\n","path":null,"size_bytes":6307,"size_tokens":null},"client/src/components/ObjectUploader.tsx":{"content":"import { useState } from \"react\";\nimport type { ReactNode } from \"react\";\nimport Uppy from \"@uppy/core\";\nimport type { UppyFile, UploadResult } from \"@uppy/core\";\nimport DashboardModal from \"@uppy/react/dashboard-modal\";\nimport \"@uppy/core/css/style.min.css\";\nimport \"@uppy/dashboard/css/style.min.css\";\nimport AwsS3 from \"@uppy/aws-s3\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface ObjectUploaderProps {\n  maxNumberOfFiles?: number;\n  maxFileSize?: number;\n  /**\n   * Function to get upload parameters for each file.\n   * IMPORTANT: This receives the file object - use file.name, file.size, file.type\n   * to request per-file presigned URLs from your backend.\n   */\n  onGetUploadParameters: (\n    file: UppyFile<Record<string, unknown>, Record<string, unknown>>\n  ) => Promise<{\n    method: \"PUT\";\n    url: string;\n    headers?: Record<string, string>;\n  }>;\n  onComplete?: (\n    result: UploadResult<Record<string, unknown>, Record<string, unknown>>\n  ) => void;\n  buttonClassName?: string;\n  children: ReactNode;\n}\n\n/**\n * A file upload component that renders as a button and provides a modal interface for\n * file management.\n *\n * Features:\n * - Renders as a customizable button that opens a file upload modal\n * - Provides a modal interface for:\n *   - File selection\n *   - File preview\n *   - Upload progress tracking\n *   - Upload status display\n *\n * The component uses Uppy v5 under the hood to handle all file upload functionality.\n * All file management features are automatically handled by the Uppy dashboard modal.\n *\n * @param props - Component props\n * @param props.maxNumberOfFiles - Maximum number of files allowed to be uploaded\n *   (default: 1)\n * @param props.maxFileSize - Maximum file size in bytes (default: 10MB)\n * @param props.onGetUploadParameters - Function to get upload parameters for each file.\n *   Receives the UppyFile object with file.name, file.size, file.type properties.\n *   Use these to request per-file presigned URLs from your backend. Returns method,\n *   url, and optional headers for the upload request.\n * @param props.onComplete - Callback function called when upload is complete. Typically\n *   used to make post-upload API calls to update server state and set object ACL\n *   policies.\n * @param props.buttonClassName - Optional CSS class name for the button\n * @param props.children - Content to be rendered inside the button\n */\nexport function ObjectUploader({\n  maxNumberOfFiles = 1,\n  maxFileSize = 10485760, // 10MB default\n  onGetUploadParameters,\n  onComplete,\n  buttonClassName,\n  children,\n}: ObjectUploaderProps) {\n  const [showModal, setShowModal] = useState(false);\n  const [uppy] = useState(() =>\n    new Uppy({\n      restrictions: {\n        maxNumberOfFiles,\n        maxFileSize,\n      },\n      autoProceed: false,\n    })\n      .use(AwsS3, {\n        shouldUseMultipart: false,\n        getUploadParameters: onGetUploadParameters,\n      })\n      .on(\"complete\", (result) => {\n        onComplete?.(result);\n      })\n  );\n\n  return (\n    <div>\n      <Button onClick={() => setShowModal(true)} className={buttonClassName}>\n        {children}\n      </Button>\n\n      <DashboardModal\n        uppy={uppy}\n        open={showModal}\n        onRequestClose={() => setShowModal(false)}\n        proudlyDisplayPoweredByUppy={false}\n      />\n    </div>\n  );\n}\n\n","path":null,"size_bytes":3327,"size_tokens":null},"shared/schema.ts":{"content":"import { pgTable, text, serial, integer, timestamp, real } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\nimport { relations } from \"drizzle-orm\";\n\nexport * from \"./models/auth\";\n\nexport const userRoles = pgTable(\"user_roles\", {\n  id: serial(\"id\").primaryKey(),\n  userId: text(\"user_id\").notNull().unique(),\n  role: text(\"role\", { enum: [\"admin\", \"sku_manager\", \"stock_counter\", \"stock_counter_toko\", \"stock_counter_gudang\"] }).default(\"stock_counter\").notNull(),\n});\n\nexport const products = pgTable(\"products\", {\n  id: serial(\"id\").primaryKey(),\n  sku: text(\"sku\").notNull(),\n  name: text(\"name\").notNull(),\n  category: text(\"category\"),\n  subCategory: text(\"sub_category\"),\n  productCode: text(\"product_code\"),\n  description: text(\"description\"),\n  currentStock: integer(\"current_stock\").default(0).notNull(),\n  photoUrl: text(\"photo_url\"),\n  userId: text(\"user_id\").notNull(),\n  locationType: text(\"location_type\", { enum: [\"toko\", \"gudang\"] }).default(\"toko\"),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const productPhotos = pgTable(\"product_photos\", {\n  id: serial(\"id\").primaryKey(),\n  productId: integer(\"product_id\").references(() => products.id, { onDelete: \"cascade\" }).notNull(),\n  url: text(\"url\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const productUnits = pgTable(\"product_units\", {\n  id: serial(\"id\").primaryKey(),\n  productId: integer(\"product_id\").references(() => products.id, { onDelete: \"cascade\" }).notNull(),\n  unitName: text(\"unit_name\").notNull(),\n  conversionToBase: real(\"conversion_to_base\").default(1).notNull(),\n  baseUnit: text(\"base_unit\").notNull(),\n  sortOrder: integer(\"sort_order\").default(0).notNull(),\n});\n\nexport const opnameSessions = pgTable(\"opname_sessions\", {\n  id: serial(\"id\").primaryKey(),\n  title: text(\"title\").notNull(),\n  status: text(\"status\", { enum: [\"in_progress\", \"completed\"] }).default(\"in_progress\").notNull(),\n  startedAt: timestamp(\"started_at\").defaultNow().notNull(),\n  completedAt: timestamp(\"completed_at\"),\n  notes: text(\"notes\"),\n  userId: text(\"user_id\").notNull(),\n  locationType: text(\"location_type\", { enum: [\"toko\", \"gudang\"] }).default(\"toko\"),\n  startedByName: text(\"started_by_name\"),\n  assignedTo: text(\"assigned_to\"),\n});\n\nexport const opnameRecords = pgTable(\"opname_records\", {\n  id: serial(\"id\").primaryKey(),\n  sessionId: integer(\"session_id\").references(() => opnameSessions.id).notNull(),\n  productId: integer(\"product_id\").references(() => products.id).notNull(),\n  actualStock: integer(\"actual_stock\"),\n  notes: text(\"notes\"),\n  photoUrl: text(\"photo_url\"),\n  unitValues: text(\"unit_values\"),\n});\n\nexport const opnameRecordPhotos = pgTable(\"opname_record_photos\", {\n  id: serial(\"id\").primaryKey(),\n  recordId: integer(\"record_id\").references(() => opnameRecords.id, { onDelete: \"cascade\" }).notNull(),\n  url: text(\"url\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const staffMembers = pgTable(\"staff_members\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  locationType: text(\"location_type\", { enum: [\"toko\", \"gudang\"] }).default(\"toko\"),\n  userId: text(\"user_id\").notNull(),\n  active: integer(\"active\").default(1).notNull(),\n});\n\nexport const announcements = pgTable(\"announcements\", {\n  id: serial(\"id\").primaryKey(),\n  title: text(\"title\").notNull(),\n  content: text(\"content\").notNull(),\n  imageUrl: text(\"image_url\"),\n  userId: text(\"user_id\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  expiresAt: timestamp(\"expires_at\"),\n});\n\nexport const feedback = pgTable(\"feedback\", {\n  id: serial(\"id\").primaryKey(),\n  userId: text(\"user_id\").notNull(),\n  userName: text(\"user_name\"),\n  type: text(\"type\", { enum: [\"kritik\", \"saran\"] }).default(\"saran\").notNull(),\n  content: text(\"content\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const motivationMessages = pgTable(\"motivation_messages\", {\n  id: serial(\"id\").primaryKey(),\n  message: text(\"message\").notNull(),\n  userId: text(\"user_id\").notNull(),\n  active: integer(\"active\").default(1).notNull(),\n});\n\nexport const categoryPriorities = pgTable(\"category_priorities\", {\n  id: serial(\"id\").primaryKey(),\n  categoryName: text(\"category_name\").notNull(),\n  sortOrder: integer(\"sort_order\").default(0).notNull(),\n  userId: text(\"user_id\").notNull(),\n});\n\n// === Relations ===\n\nexport const productPhotosRelations = relations(productPhotos, ({ one }) => ({\n  product: one(products, {\n    fields: [productPhotos.productId],\n    references: [products.id],\n  }),\n}));\n\nexport const productUnitsRelations = relations(productUnits, ({ one }) => ({\n  product: one(products, {\n    fields: [productUnits.productId],\n    references: [products.id],\n  }),\n}));\n\nexport const productsRelations = relations(products, ({ many }) => ({\n  photos: many(productPhotos),\n  units: many(productUnits),\n}));\n\nexport const opnameRecordsRelations = relations(opnameRecords, ({ one, many }) => ({\n  session: one(opnameSessions, {\n    fields: [opnameRecords.sessionId],\n    references: [opnameSessions.id],\n  }),\n  product: one(products, {\n    fields: [opnameRecords.productId],\n    references: [products.id],\n  }),\n  photos: many(opnameRecordPhotos),\n}));\n\nexport const opnameRecordPhotosRelations = relations(opnameRecordPhotos, ({ one }) => ({\n  record: one(opnameRecords, {\n    fields: [opnameRecordPhotos.recordId],\n    references: [opnameRecords.id],\n  }),\n}));\n\nexport const opnameSessionsRelations = relations(opnameSessions, ({ many }) => ({\n  records: many(opnameRecords),\n}));\n\nexport const staffMembersRelations = relations(staffMembers, ({}) => ({}));\n\n// === Insert Schemas ===\n\nexport const insertProductSchema = createInsertSchema(products).omit({ id: true, updatedAt: true });\nexport const insertSessionSchema = createInsertSchema(opnameSessions).omit({ id: true, startedAt: true, completedAt: true });\nexport const insertRecordSchema = createInsertSchema(opnameRecords).omit({ id: true });\nexport const insertUserRoleSchema = createInsertSchema(userRoles).omit({ id: true });\nexport const insertProductPhotoSchema = createInsertSchema(productPhotos).omit({ id: true, createdAt: true });\nexport const insertProductUnitSchema = createInsertSchema(productUnits).omit({ id: true });\nexport const insertStaffMemberSchema = createInsertSchema(staffMembers).omit({ id: true });\nexport const insertAnnouncementSchema = createInsertSchema(announcements).omit({ id: true, createdAt: true });\nexport const insertFeedbackSchema = createInsertSchema(feedback).omit({ id: true, createdAt: true });\nexport const insertMotivationMessageSchema = createInsertSchema(motivationMessages).omit({ id: true });\nexport const insertCategoryPrioritySchema = createInsertSchema(categoryPriorities).omit({ id: true });\n\n// === Types ===\n\nexport type Product = typeof products.$inferSelect;\nexport type InsertProduct = z.infer<typeof insertProductSchema>;\n\nexport type ProductPhoto = typeof productPhotos.$inferSelect;\nexport type InsertProductPhoto = z.infer<typeof insertProductPhotoSchema>;\n\nexport type ProductUnit = typeof productUnits.$inferSelect;\nexport type InsertProductUnit = z.infer<typeof insertProductUnitSchema>;\n\nexport type OpnameSession = typeof opnameSessions.$inferSelect;\nexport type InsertOpnameSession = z.infer<typeof insertSessionSchema>;\n\nexport type OpnameRecord = typeof opnameRecords.$inferSelect;\nexport type InsertOpnameRecord = z.infer<typeof insertRecordSchema>;\n\nexport type OpnameRecordPhoto = typeof opnameRecordPhotos.$inferSelect;\n\nexport type UserRole = typeof userRoles.$inferSelect;\nexport type InsertUserRole = z.infer<typeof insertUserRoleSchema>;\n\nexport type StaffMember = typeof staffMembers.$inferSelect;\nexport type InsertStaffMember = z.infer<typeof insertStaffMemberSchema>;\n\nexport type Announcement = typeof announcements.$inferSelect;\nexport type InsertAnnouncement = z.infer<typeof insertAnnouncementSchema>;\n\nexport type Feedback = typeof feedback.$inferSelect;\nexport type InsertFeedback = z.infer<typeof insertFeedbackSchema>;\n\nexport type MotivationMessage = typeof motivationMessages.$inferSelect;\nexport type InsertMotivationMessage = z.infer<typeof insertMotivationMessageSchema>;\n\nexport type CategoryPriority = typeof categoryPriorities.$inferSelect;\nexport type InsertCategoryPriority = z.infer<typeof insertCategoryPrioritySchema>;\n\nexport type ProductWithPhotosAndUnits = Product & { photos: ProductPhoto[]; units: ProductUnit[] };\nexport type OpnameRecordWithProduct = OpnameRecord & { product: Product & { photos: ProductPhoto[]; units: ProductUnit[] }; photos: OpnameRecordPhoto[] };\nexport type OpnameSessionWithRecords = OpnameSession & { records: OpnameRecordWithProduct[] };\n","path":null,"size_bytes":8801,"size_tokens":null},"client/src/components/BackgroundUpload.tsx":{"content":"import { createContext, useContext, useState, useCallback, useRef, useEffect } from \"react\";\nimport { Loader2, CheckCircle2, X, Upload, AlertTriangle } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface UploadJob {\n  id: string;\n  label: string;\n  total: number;\n  status: \"pending\" | \"uploading\" | \"done\" | \"error\";\n  progress: number;\n}\n\ntype SingleFileUploadFn = (file: File) => Promise<void>;\n\ninterface BackgroundUploadContextType {\n  addUploadJob: (label: string, files: File[], uploadFn: SingleFileUploadFn) => void;\n  activeCount: number;\n}\n\nconst BackgroundUploadContext = createContext<BackgroundUploadContextType>({\n  addUploadJob: () => {},\n  activeCount: 0,\n});\n\nexport function useBackgroundUpload() {\n  return useContext(BackgroundUploadContext);\n}\n\ninterface QueueItem {\n  job: UploadJob;\n  files: File[];\n  uploadFn: SingleFileUploadFn;\n}\n\nexport function BackgroundUploadProvider({ children }: { children: React.ReactNode }) {\n  const [jobs, setJobs] = useState<UploadJob[]>([]);\n  const [minimized, setMinimized] = useState(false);\n  const processingRef = useRef(false);\n  const queueRef = useRef<QueueItem[]>([]);\n  const cleanupTimersRef = useRef<Set<ReturnType<typeof setTimeout>>>(new Set());\n  const { toast } = useToast();\n\n  useEffect(() => {\n    return () => {\n      cleanupTimersRef.current.forEach(t => clearTimeout(t));\n    };\n  }, []);\n\n  const processQueue = useCallback(async () => {\n    if (processingRef.current) return;\n    processingRef.current = true;\n\n    while (queueRef.current.length > 0) {\n      const item = queueRef.current[0];\n      const { job, files, uploadFn } = item;\n\n      setJobs(prev => prev.map(j => j.id === job.id ? { ...j, status: \"uploading\" } : j));\n\n      try {\n        for (let i = 0; i < files.length; i++) {\n          await uploadFn(files[i]);\n          setJobs(prev => prev.map(j => j.id === job.id ? { ...j, progress: i + 1 } : j));\n        }\n        setJobs(prev => prev.map(j => j.id === job.id ? { ...j, status: \"done\" } : j));\n      } catch (err) {\n        setJobs(prev => prev.map(j => j.id === job.id ? { ...j, status: \"error\" } : j));\n        toast({ title: \"Upload Gagal\", description: `Gagal mengupload foto untuk ${job.label}`, variant: \"destructive\" });\n      }\n\n      queueRef.current = queueRef.current.slice(1);\n    }\n\n    processingRef.current = false;\n\n    const timer = setTimeout(() => {\n      setJobs(prev => prev.filter(j => j.status !== \"done\"));\n    }, 3000);\n    cleanupTimersRef.current.add(timer);\n  }, [toast]);\n\n  const addUploadJob = useCallback((label: string, files: File[], uploadFn: SingleFileUploadFn) => {\n    const job: UploadJob = {\n      id: crypto.randomUUID(),\n      label,\n      total: files.length,\n      status: \"pending\",\n      progress: 0,\n    };\n    setJobs(prev => [...prev, job]);\n    setMinimized(false);\n    queueRef.current.push({ job, files, uploadFn });\n    processQueue();\n  }, [processQueue]);\n\n  const activeCount = jobs.filter(j => j.status === \"uploading\" || j.status === \"pending\").length;\n\n  const dismissJob = useCallback((id: string) => {\n    setJobs(prev => prev.filter(j => j.id !== id));\n  }, []);\n\n  return (\n    <BackgroundUploadContext.Provider value={{ addUploadJob, activeCount }}>\n      {children}\n      {jobs.length > 0 && (\n        <div className=\"fixed bottom-4 right-4 z-50 flex flex-col gap-2 max-w-[320px]\" data-testid=\"upload-progress-container\">\n          {minimized ? (\n            <button\n              onClick={() => setMinimized(false)}\n              className=\"flex items-center gap-2 bg-primary text-primary-foreground px-3 py-2 rounded-full shadow-lg text-sm font-medium\"\n              data-testid=\"button-expand-uploads\"\n            >\n              <Upload className=\"w-4 h-4\" />\n              {activeCount > 0 ? (\n                <>\n                  <Loader2 className=\"w-3.5 h-3.5 animate-spin\" />\n                  <span>Mengupload ({activeCount})</span>\n                </>\n              ) : (\n                <span>Upload selesai</span>\n              )}\n            </button>\n          ) : (\n            <div className=\"bg-card border border-border rounded-lg shadow-lg overflow-hidden\">\n              <div className=\"flex items-center justify-between gap-2 px-3 py-2 border-b border-border bg-muted/30\">\n                <span className=\"text-sm font-medium text-foreground flex items-center gap-2\">\n                  <Upload className=\"w-4 h-4\" />\n                  Upload Foto\n                </span>\n                <div className=\"flex items-center gap-1\">\n                  <button onClick={() => setMinimized(true)} className=\"text-muted-foreground p-0.5\" data-testid=\"button-minimize-uploads\">\n                    <div className=\"w-3 h-0.5 bg-current rounded\" />\n                  </button>\n                  {activeCount === 0 && (\n                    <button onClick={() => setJobs([])} className=\"text-muted-foreground p-0.5\" data-testid=\"button-close-uploads\">\n                      <X className=\"w-3.5 h-3.5\" />\n                    </button>\n                  )}\n                </div>\n              </div>\n              <div className=\"max-h-[200px] overflow-y-auto\">\n                {jobs.map(job => (\n                  <div key={job.id} className=\"flex items-center gap-2 px-3 py-2 border-b border-border/50 last:border-0\" data-testid={`upload-job-${job.id}`}>\n                    {job.status === \"uploading\" && <Loader2 className=\"w-4 h-4 animate-spin text-primary flex-shrink-0\" />}\n                    {job.status === \"pending\" && <Upload className=\"w-4 h-4 text-muted-foreground flex-shrink-0\" />}\n                    {job.status === \"done\" && <CheckCircle2 className=\"w-4 h-4 text-emerald-500 flex-shrink-0\" />}\n                    {job.status === \"error\" && <AlertTriangle className=\"w-4 h-4 text-destructive flex-shrink-0\" />}\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"text-xs font-medium text-foreground truncate\">{job.label}</p>\n                      <p className=\"text-[10px] text-muted-foreground\">\n                        {job.status === \"uploading\" && `${job.progress}/${job.total} foto`}\n                        {job.status === \"pending\" && `${job.total} foto menunggu`}\n                        {job.status === \"done\" && \"Selesai\"}\n                        {job.status === \"error\" && \"Gagal\"}\n                      </p>\n                    </div>\n                    {(job.status === \"done\" || job.status === \"error\") && (\n                      <button onClick={() => dismissJob(job.id)} className=\"text-muted-foreground flex-shrink-0\" data-testid={`button-dismiss-job-${job.id}`}>\n                        <X className=\"w-3.5 h-3.5\" />\n                      </button>\n                    )}\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n    </BackgroundUploadContext.Provider>\n  );\n}\n","path":null,"size_bytes":6920,"size_tokens":null},"client/src/pages/RoleManagement.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { api } from \"@shared/routes\";\nimport { useRole } from \"@/hooks/use-role\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Shield, Loader2, Plus, AlertCircle, KeyRound } from \"lucide-react\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { useLocation } from \"wouter\";\n\ntype UserWithRole = {\n  id: number;\n  userId: string;\n  role: string;\n  username?: string | null;\n  email?: string | null;\n  firstName?: string | null;\n  lastName?: string | null;\n  adminId?: string | null;\n};\n\nconst roleLabels: Record<string, string> = {\n  admin: \"Admin\",\n  sku_manager: \"SKU Manager\",\n  stock_counter: \"Stock Counter\",\n  stock_counter_toko: \"Stock Counter Toko\",\n  stock_counter_gudang: \"Stock Counter Gudang\",\n};\n\nconst roleBadgeColors: Record<string, string> = {\n  admin: \"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\",\n  sku_manager: \"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400\",\n  stock_counter: \"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\",\n  stock_counter_toko: \"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400\",\n  stock_counter_gudang: \"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400\",\n};\n\nexport default function RoleManagement() {\n  const { isAdmin, isLoading: roleLoading } = useRole();\n  const [, setLocation] = useLocation();\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n  const [isCreateOpen, setIsCreateOpen] = useState(false);\n\n  const { data: users, isLoading } = useQuery<UserWithRole[]>({\n    queryKey: [api.roles.list.path],\n    queryFn: async () => {\n      const res = await fetch(api.roles.list.path, { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch users\");\n      return res.json();\n    },\n    enabled: isAdmin,\n  });\n\n  const updateRole = useMutation({\n    mutationFn: async ({ userId, role }: { userId: string; role: string }) => {\n      const res = await fetch(api.roles.set.path, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ userId, role }),\n        credentials: \"include\",\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.message || \"Failed to update role\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [api.roles.list.path] });\n      toast({ title: \"Role Diperbarui\", description: \"Role user berhasil diubah.\" });\n    },\n    onError: (error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  if (roleLoading || isLoading) {\n    return (\n      <div className=\"p-12 flex justify-center\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (!isAdmin) {\n    setLocation(\"/\");\n    return null;\n  }\n\n  const subUsers = users?.filter(u => u.adminId !== null) || [];\n  const adminUser = users?.find(u => u.adminId === null);\n\n  return (\n    <div className=\"space-y-8 animate-enter\">\n      <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-3xl font-display font-bold text-foreground flex items-center gap-3\">\n            <Shield className=\"w-8 h-8 text-primary\" />\n            User Roles\n          </h1>\n          <p className=\"text-muted-foreground mt-2\">Kelola user dan akses tim Anda.</p>\n        </div>\n        <CreateUserDialog open={isCreateOpen} onOpenChange={setIsCreateOpen} />\n      </div>\n\n      <div className=\"bg-card border border-border/50 rounded-2xl shadow-sm overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full text-left text-sm\">\n            <thead>\n              <tr className=\"bg-muted/30 border-b border-border/50\">\n                <th className=\"px-6 py-4 font-medium text-muted-foreground\">User</th>\n                <th className=\"px-6 py-4 font-medium text-muted-foreground\">Tipe</th>\n                <th className=\"px-6 py-4 font-medium text-muted-foreground\">Role Saat Ini</th>\n                <th className=\"px-6 py-4 font-medium text-muted-foreground\">Ubah Role</th>\n                <th className=\"px-6 py-4 font-medium text-muted-foreground\">Aksi</th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-border/50\">\n              {adminUser && (\n                <tr className=\"bg-muted/10\" data-testid={`row-user-${adminUser.userId}`}>\n                  <td className=\"px-6 py-4\">\n                    <div className=\"flex items-center gap-3\">\n                      <Avatar className=\"w-8 h-8\">\n                        <AvatarFallback className=\"bg-gradient-to-br from-indigo-400 to-purple-400 text-white text-xs font-bold\">\n                          {getInitials(adminUser)}\n                        </AvatarFallback>\n                      </Avatar>\n                      <div>\n                        <span className=\"font-medium text-foreground block\">\n                          {adminUser.firstName && adminUser.lastName ? `${adminUser.firstName} ${adminUser.lastName}` : adminUser.username || \"-\"}\n                        </span>\n                        {adminUser.username && (\n                          <span className=\"text-xs text-muted-foreground\">@{adminUser.username}</span>\n                        )}\n                      </div>\n                    </div>\n                  </td>\n                  <td className=\"px-6 py-4\">\n                    <Badge variant=\"secondary\">Owner</Badge>\n                  </td>\n                  <td className=\"px-6 py-4\">\n                    <Badge className={roleBadgeColors[adminUser.role] || \"\"} data-testid={`badge-role-${adminUser.userId}`}>\n                      {roleLabels[adminUser.role] || adminUser.role}\n                    </Badge>\n                  </td>\n                  <td className=\"px-6 py-4 text-muted-foreground text-sm\">-</td>\n                  <td className=\"px-6 py-4 text-muted-foreground text-sm\">-</td>\n                </tr>\n              )}\n              {subUsers.map((user) => (\n                <tr key={user.userId} className=\"hover:bg-muted/20 transition-colors\" data-testid={`row-user-${user.userId}`}>\n                  <td className=\"px-6 py-4\">\n                    <div className=\"flex items-center gap-3\">\n                      <Avatar className=\"w-8 h-8\">\n                        <AvatarFallback className=\"bg-gradient-to-br from-teal-400 to-cyan-400 text-white text-xs font-bold\">\n                          {getInitials(user)}\n                        </AvatarFallback>\n                      </Avatar>\n                      <div>\n                        <span className=\"font-medium text-foreground block\">\n                          {user.firstName && user.lastName ? `${user.firstName} ${user.lastName}` : user.username || \"-\"}\n                        </span>\n                        {user.username && (\n                          <span className=\"text-xs text-muted-foreground\">@{user.username}</span>\n                        )}\n                      </div>\n                    </div>\n                  </td>\n                  <td className=\"px-6 py-4\">\n                    <Badge variant=\"outline\">Anggota</Badge>\n                  </td>\n                  <td className=\"px-6 py-4\">\n                    <Badge className={roleBadgeColors[user.role] || \"\"} data-testid={`badge-role-${user.userId}`}>\n                      {roleLabels[user.role] || user.role}\n                    </Badge>\n                  </td>\n                  <td className=\"px-6 py-4\">\n                    <Select\n                      value={user.role}\n                      onValueChange={(value) => updateRole.mutate({ userId: user.userId, role: value })}\n                    >\n                      <SelectTrigger className=\"w-40\" data-testid={`select-role-${user.userId}`}>\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent className=\"bg-card border border-border\">\n                        <SelectItem value=\"sku_manager\">SKU Manager</SelectItem>\n                        <SelectItem value=\"stock_counter\">Stock Counter</SelectItem>\n                        <SelectItem value=\"stock_counter_toko\">Stock Counter Toko</SelectItem>\n                        <SelectItem value=\"stock_counter_gudang\">Stock Counter Gudang</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </td>\n                  <td className=\"px-6 py-4\">\n                    <ResetPasswordButton userId={user.userId} userName={user.firstName && user.lastName ? `${user.firstName} ${user.lastName}` : user.username || \"User\"} />\n                  </td>\n                </tr>\n              ))}\n              {subUsers.length === 0 && (\n                <tr>\n                  <td colSpan={5} className=\"px-6 py-8 text-center text-muted-foreground\">\n                    Belum ada anggota tim. Klik \"Tambah User\" untuk membuat user baru.\n                  </td>\n                </tr>\n              )}\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      <div className=\"bg-muted/30 border border-border/50 rounded-xl p-6 space-y-3\">\n        <h3 className=\"font-semibold text-foreground\">Keterangan Role</h3>\n        <div className=\"space-y-2 text-sm text-muted-foreground\">\n          <p><strong className=\"text-foreground\">Admin (Owner)</strong> - Akses penuh: kelola produk, sesi, dan user tim</p>\n          <p><strong className=\"text-foreground\">SKU Manager</strong> - Bisa membuat, edit, dan hapus produk/SKU. Tidak bisa kelola sesi atau role</p>\n          <p><strong className=\"text-foreground\">Stock Counter</strong> - Bisa membuat dan mengisi sesi stock opname untuk Toko dan Gudang</p>\n          <p><strong className=\"text-foreground\">Stock Counter Toko</strong> - Hanya bisa stock opname untuk lokasi Toko</p>\n          <p><strong className=\"text-foreground\">Stock Counter Gudang</strong> - Hanya bisa stock opname untuk lokasi Gudang</p>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction getInitials(user: UserWithRole): string {\n  if (user.firstName && user.lastName) {\n    return `${user.firstName[0]}${user.lastName[0]}`.toUpperCase();\n  }\n  return (user.username || \"U\").substring(0, 2).toUpperCase();\n}\n\nfunction ResetPasswordButton({ userId, userName }: { userId: string; userName: string }) {\n  const { toast } = useToast();\n  const [open, setOpen] = useState(false);\n  const [newPassword, setNewPassword] = useState(\"\");\n  const [error, setError] = useState(\"\");\n\n  const resetPassword = useMutation({\n    mutationFn: async (data: { userId: string; newPassword: string }) => {\n      const res = await fetch(\"/api/auth/reset-password\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n        credentials: \"include\",\n      });\n      if (!res.ok) {\n        const err = await res.json();\n        throw new Error(err.message || \"Gagal reset password\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Password Direset\", description: `Password ${userName} berhasil diubah.` });\n      setOpen(false);\n      setNewPassword(\"\");\n      setError(\"\");\n    },\n    onError: (err) => {\n      setError(err.message);\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(\"\");\n    resetPassword.mutate({ userId, newPassword });\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={(v) => { setOpen(v); if (!v) { setNewPassword(\"\"); setError(\"\"); } }}>\n      <DialogTrigger asChild>\n        <Button variant=\"outline\" size=\"sm\" data-testid={`button-reset-password-${userId}`}>\n          <KeyRound className=\"w-4 h-4 mr-1.5\" />\n          Reset Password\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"sm:max-w-[400px]\">\n        <DialogHeader>\n          <DialogTitle>Reset Password - {userName}</DialogTitle>\n        </DialogHeader>\n        <form onSubmit={handleSubmit} className=\"space-y-4 pt-2\">\n          {error && (\n            <div className=\"flex items-center gap-2 p-3 rounded-md bg-destructive/10 text-destructive text-sm\" data-testid=\"text-reset-error\">\n              <AlertCircle className=\"w-4 h-4 shrink-0\" />\n              {error}\n            </div>\n          )}\n          <div>\n            <label className=\"text-sm font-medium text-foreground mb-1.5 block\">Password Baru</label>\n            <Input\n              type=\"password\"\n              value={newPassword}\n              onChange={(e) => setNewPassword(e.target.value)}\n              placeholder=\"Minimal 6 karakter\"\n              required\n              data-testid=\"input-reset-password\"\n            />\n          </div>\n          <div className=\"flex justify-end gap-3 pt-2\">\n            <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)}>Batal</Button>\n            <Button type=\"submit\" disabled={resetPassword.isPending} data-testid=\"button-submit-reset\">\n              {resetPassword.isPending && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n              Reset Password\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nfunction CreateUserDialog({ open, onOpenChange }: { open: boolean; onOpenChange: (open: boolean) => void }) {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n  const [username, setUsername] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [firstName, setFirstName] = useState(\"\");\n  const [lastName, setLastName] = useState(\"\");\n  const [role, setRole] = useState(\"stock_counter\");\n  const [error, setError] = useState(\"\");\n\n  const createUser = useMutation({\n    mutationFn: async (data: { username: string; password: string; firstName: string; lastName: string; role: string }) => {\n      const res = await fetch(\"/api/auth/create-user\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n        credentials: \"include\",\n      });\n      if (!res.ok) {\n        const err = await res.json();\n        throw new Error(err.message || \"Gagal membuat user\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [api.roles.list.path] });\n      toast({ title: \"User Dibuat\", description: \"User baru berhasil ditambahkan ke tim.\" });\n      onOpenChange(false);\n      setUsername(\"\");\n      setPassword(\"\");\n      setFirstName(\"\");\n      setLastName(\"\");\n      setRole(\"stock_counter\");\n      setError(\"\");\n    },\n    onError: (err) => {\n      setError(err.message);\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(\"\");\n    createUser.mutate({ username, password, firstName, lastName, role });\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogTrigger asChild>\n        <Button data-testid=\"button-add-user\">\n          <Plus className=\"w-4 h-4 mr-2\" />\n          Tambah User\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"sm:max-w-[450px]\">\n        <DialogHeader>\n          <DialogTitle>Tambah User Baru</DialogTitle>\n        </DialogHeader>\n        <form onSubmit={handleSubmit} className=\"space-y-4 pt-2\">\n          {error && (\n            <div className=\"flex items-center gap-2 p-3 rounded-md bg-destructive/10 text-destructive text-sm\" data-testid=\"text-create-user-error\">\n              <AlertCircle className=\"w-4 h-4 shrink-0\" />\n              {error}\n            </div>\n          )}\n\n          <div className=\"grid grid-cols-2 gap-3\">\n            <div>\n              <label className=\"text-sm font-medium text-foreground mb-1.5 block\">Nama Depan</label>\n              <Input\n                value={firstName}\n                onChange={(e) => setFirstName(e.target.value)}\n                placeholder=\"Nama depan\"\n                data-testid=\"input-new-first-name\"\n              />\n            </div>\n            <div>\n              <label className=\"text-sm font-medium text-foreground mb-1.5 block\">Nama Belakang</label>\n              <Input\n                value={lastName}\n                onChange={(e) => setLastName(e.target.value)}\n                placeholder=\"Nama belakang\"\n                data-testid=\"input-new-last-name\"\n              />\n            </div>\n          </div>\n\n          <div>\n            <label className=\"text-sm font-medium text-foreground mb-1.5 block\">Username</label>\n            <Input\n              value={username}\n              onChange={(e) => setUsername(e.target.value)}\n              placeholder=\"username\"\n              required\n              data-testid=\"input-new-username\"\n            />\n          </div>\n\n          <div>\n            <label className=\"text-sm font-medium text-foreground mb-1.5 block\">Password</label>\n            <Input\n              type=\"password\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              placeholder=\"Minimal 6 karakter\"\n              required\n              data-testid=\"input-new-password\"\n            />\n          </div>\n\n          <div>\n            <label className=\"text-sm font-medium text-foreground mb-1.5 block\">Role</label>\n            <Select value={role} onValueChange={setRole}>\n              <SelectTrigger data-testid=\"select-new-role\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent className=\"bg-card border border-border\">\n                <SelectItem value=\"sku_manager\">SKU Manager</SelectItem>\n                <SelectItem value=\"stock_counter\">Stock Counter</SelectItem>\n                <SelectItem value=\"stock_counter_toko\">Stock Counter Toko</SelectItem>\n                <SelectItem value=\"stock_counter_gudang\">Stock Counter Gudang</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"flex justify-end gap-3 pt-2\">\n            <Button type=\"button\" variant=\"outline\" onClick={() => onOpenChange(false)}>Batal</Button>\n            <Button type=\"submit\" disabled={createUser.isPending} data-testid=\"button-submit-new-user\">\n              {createUser.isPending && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n              Buat User\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":18938,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\nexport function compressImage(file: File, maxWidth = 800, quality = 0.5): Promise<File> {\n  return new Promise((resolve, reject) => {\n    if (!file.type.startsWith(\"image/\")) {\n      resolve(file);\n      return;\n    }\n\n    const img = new window.Image();\n    const url = URL.createObjectURL(file);\n\n    img.onload = () => {\n      URL.revokeObjectURL(url);\n\n      let width = img.width;\n      let height = img.height;\n\n      if (width <= maxWidth) {\n        resolve(file);\n        return;\n      }\n\n      const ratio = maxWidth / width;\n      width = maxWidth;\n      height = Math.round(height * ratio);\n\n      const canvas = document.createElement(\"canvas\");\n      canvas.width = width;\n      canvas.height = height;\n\n      const ctx = canvas.getContext(\"2d\");\n      if (!ctx) {\n        resolve(file);\n        return;\n      }\n\n      ctx.drawImage(img, 0, 0, width, height);\n\n      canvas.toBlob(\n        (blob) => {\n          if (!blob) {\n            resolve(file);\n            return;\n          }\n          const compressed = new File([blob], file.name.replace(/\\.[^.]+$/, \".jpg\"), {\n            type: \"image/jpeg\",\n            lastModified: Date.now(),\n          });\n          resolve(compressed);\n        },\n        \"image/jpeg\",\n        quality\n      );\n    };\n\n    img.onerror = () => {\n      URL.revokeObjectURL(url);\n      reject(new Error(\"Failed to load image for compression\"));\n    };\n\n    img.src = url;\n  });\n}\n","path":null,"size_bytes":1590,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/hooks/use-upload.ts":{"content":"import { useState, useCallback } from \"react\";\nimport type { UppyFile } from \"@uppy/core\";\n\ninterface UploadMetadata {\n  name: string;\n  size: number;\n  contentType: string;\n}\n\ninterface UploadResponse {\n  uploadURL: string;\n  objectPath: string;\n  metadata: UploadMetadata;\n}\n\ninterface UseUploadOptions {\n  onSuccess?: (response: UploadResponse) => void;\n  onError?: (error: Error) => void;\n}\n\n/**\n * React hook for handling file uploads with presigned URLs.\n *\n * This hook implements the two-step presigned URL upload flow:\n * 1. Request a presigned URL from your backend (sends JSON metadata, NOT the file)\n * 2. Upload the file directly to the presigned URL\n *\n * @example\n * ```tsx\n * function FileUploader() {\n *   const { uploadFile, isUploading, error } = useUpload({\n *     onSuccess: (response) => {\n *       console.log(\"Uploaded to:\", response.objectPath);\n *     },\n *   });\n *\n *   const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\n *     const file = e.target.files?.[0];\n *     if (file) {\n *       await uploadFile(file);\n *     }\n *   };\n *\n *   return (\n *     <div>\n *       <input type=\"file\" onChange={handleFileChange} disabled={isUploading} />\n *       {isUploading && <p>Uploading...</p>}\n *       {error && <p>Error: {error.message}</p>}\n *     </div>\n *   );\n * }\n * ```\n */\nexport function useUpload(options: UseUploadOptions = {}) {\n  const [isUploading, setIsUploading] = useState(false);\n  const [error, setError] = useState<Error | null>(null);\n  const [progress, setProgress] = useState(0);\n\n  /**\n   * Request a presigned URL from the backend.\n   * IMPORTANT: Send JSON metadata, NOT the file itself.\n   */\n  const requestUploadUrl = useCallback(\n    async (file: File): Promise<UploadResponse> => {\n      const response = await fetch(\"/api/uploads/request-url\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          name: file.name,\n          size: file.size,\n          contentType: file.type || \"application/octet-stream\",\n        }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.error || \"Failed to get upload URL\");\n      }\n\n      return response.json();\n    },\n    []\n  );\n\n  /**\n   * Upload a file directly to the presigned URL.\n   */\n  const uploadToPresignedUrl = useCallback(\n    async (file: File, uploadURL: string): Promise<void> => {\n      const response = await fetch(uploadURL, {\n        method: \"PUT\",\n        body: file,\n        headers: {\n          \"Content-Type\": file.type || \"application/octet-stream\",\n        },\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to upload file to storage\");\n      }\n    },\n    []\n  );\n\n  /**\n   * Upload a file using the presigned URL flow.\n   *\n   * @param file - The file to upload\n   * @returns The upload response containing the object path\n   */\n  const uploadFile = useCallback(\n    async (file: File): Promise<UploadResponse | null> => {\n      setIsUploading(true);\n      setError(null);\n      setProgress(0);\n\n      try {\n        // Step 1: Request presigned URL (send metadata as JSON)\n        setProgress(10);\n        const uploadResponse = await requestUploadUrl(file);\n\n        // Step 2: Upload file directly to presigned URL\n        setProgress(30);\n        await uploadToPresignedUrl(file, uploadResponse.uploadURL);\n\n        setProgress(100);\n        options.onSuccess?.(uploadResponse);\n        return uploadResponse;\n      } catch (err) {\n        const error = err instanceof Error ? err : new Error(\"Upload failed\");\n        setError(error);\n        options.onError?.(error);\n        return null;\n      } finally {\n        setIsUploading(false);\n      }\n    },\n    [requestUploadUrl, uploadToPresignedUrl, options]\n  );\n\n  /**\n   * Get upload parameters for Uppy's AWS S3 plugin.\n   *\n   * IMPORTANT: This function receives the UppyFile object from Uppy.\n   * Use file.name, file.size, file.type to request per-file presigned URLs.\n   *\n   * Use this with the ObjectUploader component:\n   * ```tsx\n   * <ObjectUploader onGetUploadParameters={getUploadParameters}>\n   *   Upload\n   * </ObjectUploader>\n   * ```\n   */\n  const getUploadParameters = useCallback(\n    async (\n      file: UppyFile<Record<string, unknown>, Record<string, unknown>>\n    ): Promise<{\n      method: \"PUT\";\n      url: string;\n      headers?: Record<string, string>;\n    }> => {\n      // Use the actual file properties to request a per-file presigned URL\n      const response = await fetch(\"/api/uploads/request-url\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          name: file.name,\n          size: file.size,\n          contentType: file.type || \"application/octet-stream\",\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to get upload URL\");\n      }\n\n      const data = await response.json();\n      return {\n        method: \"PUT\",\n        url: data.uploadURL,\n        headers: { \"Content-Type\": file.type || \"application/octet-stream\" },\n      };\n    },\n    []\n  );\n\n  return {\n    uploadFile,\n    getUploadParameters,\n    isUploading,\n    error,\n    progress,\n  };\n}\n\n","path":null,"size_bytes":5309,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null}},"version":2}